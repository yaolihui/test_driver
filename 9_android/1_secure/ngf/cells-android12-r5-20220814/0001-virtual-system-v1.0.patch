From 356357f0278ca24690d8759549966e78d395343a Mon Sep 17 00:00:00 2001
From: jianglin <pppaass@163.com>
Date: Sun, 14 Aug 2022 17:28:21 +0800
Subject: [PATCH] virtual-system-v1.0

---
 core/fs_mgr/fs_mgr_fstab.cpp                  |   25 +-
 core/gatekeeperd/gatekeeperd.cpp              |   25 +-
 core/init/init.cpp                            |   48 +-
 core/init/property_service.cpp                |   20 +
 core/init/switch_root.cpp                     |   26 +-
 core/libprocessgroup/processgroup.cpp         |   37 +-
 core/rootdir/Android.mk                       |    1 +
 core/rootdir/cells/fstab.persist              |    5 +
 core/rootdir/cells/fstab.postinstall          |   23 +
 core/rootdir/cells/fstab.ppostinstall         |   18 +
 core/rootdir/cells/fstab.sm7250               |    4 +
 .../android.hidl.allocator@1.0-service.rc     |    4 +
 .../android.system.suspend@1.0-service.rc     |    5 +
 core/rootdir/cells/system/apexd.rc            |   21 +
 core/rootdir/cells/system/atrace.rc           |  379 +++++
 core/rootdir/cells/system/atrace_userdebug.rc |   20 +
 core/rootdir/cells/system/audioserver.rc      |   63 +
 core/rootdir/cells/system/blank_screen.rc     |    5 +
 core/rootdir/cells/system/bootanim.rc         |    8 +
 core/rootdir/cells/system/bootstat-debug.rc   |    7 +
 core/rootdir/cells/system/bootstat.rc         |   83 ++
 core/rootdir/cells/system/bpfloader.rc        |   59 +
 core/rootdir/cells/system/cameraserver.rc     |    7 +
 .../cells/system/clean_scratch_files.rc       |    2 +
 core/rootdir/cells/system/cppreopts.rc        |   40 +
 core/rootdir/cells/system/credstore.rc        |    4 +
 core/rootdir/cells/system/drmserver.rc        |   12 +
 core/rootdir/cells/system/dumpstate.rc        |   24 +
 .../cells/system/flags_health_check.rc        |   11 +
 core/rootdir/cells/system/gatekeeperd.rc      |    4 +
 core/rootdir/cells/system/gpuservice.rc       |    4 +
 core/rootdir/cells/system/gsid.rc             |   26 +
 core/rootdir/cells/system/heapprofd.rc        |   53 +
 core/rootdir/cells/system/hw/init.environ.rc  |   16 +
 core/rootdir/cells/system/hw/init.rc          | 1289 +++++++++++++++++
 .../cells/system/hw/init.usb.configfs.rc      |  140 ++
 core/rootdir/cells/system/hw/init.usb.rc      |  144 ++
 core/rootdir/cells/system/hw/init.zygote32.rc |   16 +
 core/rootdir/cells/system/hw/init.zygote64.rc |   16 +
 .../cells/system/hw/init.zygote64_32.rc       |   26 +
 core/rootdir/cells/system/hwservicemanager.rc |   12 +
 core/rootdir/cells/system/idmap2d.rc          |    4 +
 core/rootdir/cells/system/incidentd.rc        |   23 +
 core/rootdir/cells/system/init-debug.rc       |   16 +
 core/rootdir/cells/system/installd.rc         |  103 ++
 core/rootdir/cells/system/iorapd.rc           |   38 +
 core/rootdir/cells/system/keystore2.rc        |   13 +
 core/rootdir/cells/system/llkd-debuggable.rc  |   19 +
 core/rootdir/cells/system/llkd.rc             |   45 +
 core/rootdir/cells/system/lmkd.rc             |   51 +
 core/rootdir/cells/system/logcatd.rc          |   62 +
 core/rootdir/cells/system/logd.rc             |   35 +
 core/rootdir/cells/system/logtagd.rc          |    9 +
 core/rootdir/cells/system/lpdumpd.rc          |   35 +
 core/rootdir/cells/system/mdnsd.rc            |    7 +
 core/rootdir/cells/system/mediaextractor.rc   |    6 +
 core/rootdir/cells/system/mediametrics.rc     |    6 +
 core/rootdir/cells/system/mediaserver.rc      |    9 +
 core/rootdir/cells/system/mtpd.rc             |    8 +
 core/rootdir/cells/system/netd.rc             |   12 +
 core/rootdir/cells/system/odsign.rc           |    9 +
 core/rootdir/cells/system/otapreopt.rc        |    8 +
 core/rootdir/cells/system/perfetto.rc         |   92 ++
 core/rootdir/cells/system/profcollectd.rc     |   20 +
 core/rootdir/cells/system/racoon.rc           |    9 +
 core/rootdir/cells/system/recovery-persist.rc |    3 +
 core/rootdir/cells/system/recovery-refresh.rc |    2 +
 core/rootdir/cells/system/rss_hwm_reset.rc    |   26 +
 core/rootdir/cells/system/servicemanager.rc   |   13 +
 core/rootdir/cells/system/snapuserd.rc        |    7 +
 core/rootdir/cells/system/storaged.rc         |    8 +
 core/rootdir/cells/system/surfaceflinger.rc   |   10 +
 core/rootdir/cells/system/tombstoned.rc       |    8 +
 core/rootdir/cells/system/traced_perf.rc      |   47 +
 core/rootdir/cells/system/uncrypt.rc          |   17 +
 core/rootdir/cells/system/update_engine.rc    |    9 +
 core/rootdir/cells/system/update_verifier.rc  |   11 +
 core/rootdir/cells/system/usbd.rc             |    5 +
 core/rootdir/cells/system/vdc.rc              |   12 +
 core/rootdir/cells/system/vendor-464xlat.rc   |   15 +
 core/rootdir/cells/system/vold.rc             |    9 +
 .../cells/system/wait_for_keymaster.rc        |    5 +
 core/rootdir/cells/system/wifi.rc             |  101 ++
 core/rootdir/cells/system/wificond.rc         |    5 +
 ...droid.hardware.atrace@1.0-service.pixel.rc |   46 +
 .../vendor/android.hardware.audio.service.rc  |   10 +
 ....biometrics.fingerprint@2.2-service.fpc.rc |    8 +
 ...roid.hardware.bluetooth@1.0-service-qti.rc |    7 +
 .../android.hardware.boot@1.2-service.rc      |    7 +
 ...ware.camera.provider@2.7-service-google.rc |    8 +
 .../android.hardware.cas@1.2-service.rc       |    6 +
 ...dware.confirmationui@1.0-service-google.rc |    4 +
 ...hardware.contexthub@1.2-service-generic.rc |    7 +
 ...droid.hardware.drm@1.4-service.clearkey.rc |   16 +
 ...droid.hardware.drm@1.4-service.widevine.rc |   28 +
 ...d.hardware.dumpstate@1.1-service.redfin.rc |   11 +
 ...oid.hardware.gatekeeper@1.0-service-qti.rc |    4 +
 .../android.hardware.gnss@2.1-service-qti.rc  |    4 +
 ...oid.hardware.health.storage@1.0-service.rc |    7 +
 .../android.hardware.health@2.1-service.rc    |    6 +
 ...d.hardware.identity@1.0-service.citadel.rc |    3 +
 ...d.hardware.input.classifier@1.0-service.rc |    9 +
 ...roid.hardware.keymaster@4.0-service-qti.rc |    8 +
 ....hardware.keymaster@4.1-service.citadel.rc |    5 +
 .../android.hardware.media.omx@1.0-service.rc |    6 +
 .../android.hardware.memtrack@1.0-service.rc  |    5 +
 ...hardware.neuralnetworks@1.3-service-qti.rc |   14 +
 .../android.hardware.nfc@1.2-service.st.rc    |    4 +
 ...hardware.power-service.pixel-libperfmgr.rc |   29 +
 ....hardware.power.stats@1.0-service.pixel.rc |    4 +
 ....hardware.secure_element@1.2-service.st.rc |    4 +
 ...d.hardware.sensors@2.0-service-multihal.rc |    8 +
 ...roid.hardware.thermal@2.0-service.pixel.rc |   17 +
 ...android.hardware.usb@1.3-service.redfin.rc |   26 +
 ...ndroid.hardware.vibrator-service.redfin.rc |   15 +
 ...oid.hardware.weaver@1.0-service.citadel.rc |    5 +
 ...ndroid.hardware.wifi.supplicant-service.rc |   16 +
 .../cells/vendor/boringssl_self_test.rc       |   15 +
 core/rootdir/cells/vendor/chre_daemon.rc      |   24 +
 core/rootdir/cells/vendor/citadeld.rc         |    8 +
 core/rootdir/cells/vendor/cnd-generic.rc      |    4 +
 core/rootdir/cells/vendor/cnss-daemon.rc      |    2 +
 core/rootdir/cells/vendor/dataadpl.rc         |   13 +
 core/rootdir/cells/vendor/dataqti.rc          |   19 +
 .../cells/vendor/feature_enabler_client.rc    |   19 +
 core/rootdir/cells/vendor/hostapd.android.rc  |   24 +
 core/rootdir/cells/vendor/hw/init.redfin.rc   |   63 +
 .../cells/vendor/hw/init.sm7250.diag.rc       |  117 ++
 .../cells/vendor/hw/init.sm7250.logging.rc    |    4 +
 .../cells/vendor/hw/init.sm7250.mpssrfs.rc    |   11 +
 .../cells/vendor/hw/init.sm7250.power.rc      |  150 ++
 core/rootdir/cells/vendor/hw/init.sm7250.rc   |  832 +++++++++++
 .../cells/vendor/hw/init.sm7250.usb.rc        |  112 ++
 core/rootdir/cells/vendor/ims_rtp_daemon.rc   |   13 +
 core/rootdir/cells/vendor/imsdatadaemon.rc    |   15 +
 core/rootdir/cells/vendor/imsqmidaemon.rc     |   10 +
 core/rootdir/cells/vendor/imsrcsd.rc          |    8 +
 core/rootdir/cells/vendor/init-ramdump.rc     |   16 +
 core/rootdir/cells/vendor/init-ramoops.rc     |   29 +
 core/rootdir/cells/vendor/init.pixel.rc       |   26 +
 core/rootdir/cells/vendor/init.sm7250.ipa.rc  |   19 +
 core/rootdir/cells/vendor/init.sm7250.wlc.rc  |   24 +
 core/rootdir/cells/vendor/init.time_daemon.rc |   14 +
 .../cells/vendor/init.vendor.sensors.rc       |   52 +
 core/rootdir/cells/vendor/init_citadel.rc     |   10 +
 core/rootdir/cells/vendor/init_dp.rc          |    8 +
 core/rootdir/cells/vendor/ipacm.rc            |   34 +
 core/rootdir/cells/vendor/netmgrd.rc          |   77 +
 core/rootdir/cells/vendor/pixel-mm-logd.rc    |   19 +
 core/rootdir/cells/vendor/pixel-mm.rc         |   49 +
 .../cells/vendor/pixel-thermal-logd.rc        |  136 ++
 .../cells/vendor/pixel-thermal-symlinks.rc    |   11 +
 .../cells/vendor/pixelstats-vendor.redbull.rc |    4 +
 core/rootdir/cells/vendor/port-bridge.rc      |   20 +
 core/rootdir/cells/vendor/poweropt-service.rc |   17 +
 core/rootdir/cells/vendor/qcrild.rc           |   20 +
 .../cells/vendor/rebootescrow-citadel.rc      |    7 +
 core/rootdir/cells/vendor/rlsservice.rc       |    7 +
 core/rootdir/cells/vendor/shsusrd.rc          |   40 +
 core/rootdir/cells/vendor/ssgtzd.rc           |   21 +
 core/rootdir/cells/vendor/twoshay.rc          |    5 +
 .../vendor.display.color@1.0-service.rc       |    4 +
 .../vendor.google.wifi_ext@1.0-service.rc     |    9 +
 .../vendor/vendor.qti.adsprpc-service.rc      |   42 +
 .../vendor/vendor.qti.cdsprpc-service.rc      |   40 +
 ...ti.hardware.charger_monitor@1.0-service.rc |   43 +
 ....qti.hardware.cryptfshw@1.0-service-qti.rc |    4 +
 ....qti.hardware.display.allocator-service.rc |    6 +
 ...r.qti.hardware.display.composer-service.rc |    8 +
 .../vendor.qti.hardware.dsp@1.0-service.rc    |   13 +
 ...vendor.qti.hardware.qseecom@1.0-service.rc |   14 +
 ....qti.hardware.qteeconnector@1.0-service.rc |    4 +
 ...r.qti.hardware.tui_comm@1.0-service-qti.rc |    4 +
 .../vendor/vendor.qti.media.c2@1.0-service.rc |    7 +
 .../vendor/vendor.qti.qspmhal@1.0-service.rc  |   15 +
 .../cells/vendor/vendor.qti.rmt_storage.rc    |   12 +
 core/rootdir/cells/vendor/vendor.qti.tftp.rc  |   13 +
 .../cells/vendor/vendor.sensors.qti.rc        |   40 +
 .../cells/vendor/vendor.sensors.sscrpcd.rc    |   38 +
 .../cells/vendor/vendor_flash_recovery.rc     |    3 +
 .../rootdir/cells/vendor/vndservicemanager.rc |    9 +
 core/rootdir/init.rc                          |   18 +
 libhidl/transport/ServiceManagement.cpp       |   71 +-
 libhwbinder/ProcessState.cpp                  |   20 +
 libhwbinder/include/hwbinder/IBinder.h        |    4 +
 libhwbinder/include/hwbinder/ProcessState.h   |    2 +
 netd/server/RouteController.cpp               |    3 +
 netd/server/TrafficController.cpp             |   10 +
 .../prebuilts/api/26.0/private/file_contexts  |    1 +
 .../prebuilts/api/27.0/private/file_contexts  |    1 +
 .../prebuilts/api/28.0/private/file_contexts  |    1 +
 .../prebuilts/api/29.0/private/file_contexts  |    1 +
 .../prebuilts/api/30.0/private/file_contexts  |    1 +
 .../prebuilts/api/31.0/private/file_contexts  |    1 +
 .../prebuilts/api/32.0/private/file_contexts  |    1 +
 sepolicy/private/file_contexts                |    1 +
 update_engine/common/cpu_limiter.cc           |   24 +-
 197 files changed, 6611 insertions(+), 46 deletions(-)
 create mode 100644 core/rootdir/cells/fstab.persist
 create mode 100644 core/rootdir/cells/fstab.postinstall
 create mode 100644 core/rootdir/cells/fstab.ppostinstall
 create mode 100644 core/rootdir/cells/fstab.sm7250
 create mode 100644 core/rootdir/cells/system/android.hidl.allocator@1.0-service.rc
 create mode 100644 core/rootdir/cells/system/android.system.suspend@1.0-service.rc
 create mode 100644 core/rootdir/cells/system/apexd.rc
 create mode 100644 core/rootdir/cells/system/atrace.rc
 create mode 100644 core/rootdir/cells/system/atrace_userdebug.rc
 create mode 100644 core/rootdir/cells/system/audioserver.rc
 create mode 100644 core/rootdir/cells/system/blank_screen.rc
 create mode 100644 core/rootdir/cells/system/bootanim.rc
 create mode 100644 core/rootdir/cells/system/bootstat-debug.rc
 create mode 100644 core/rootdir/cells/system/bootstat.rc
 create mode 100644 core/rootdir/cells/system/bpfloader.rc
 create mode 100644 core/rootdir/cells/system/cameraserver.rc
 create mode 100644 core/rootdir/cells/system/clean_scratch_files.rc
 create mode 100644 core/rootdir/cells/system/cppreopts.rc
 create mode 100644 core/rootdir/cells/system/credstore.rc
 create mode 100644 core/rootdir/cells/system/drmserver.rc
 create mode 100644 core/rootdir/cells/system/dumpstate.rc
 create mode 100644 core/rootdir/cells/system/flags_health_check.rc
 create mode 100644 core/rootdir/cells/system/gatekeeperd.rc
 create mode 100644 core/rootdir/cells/system/gpuservice.rc
 create mode 100644 core/rootdir/cells/system/gsid.rc
 create mode 100644 core/rootdir/cells/system/heapprofd.rc
 create mode 100644 core/rootdir/cells/system/hw/init.environ.rc
 create mode 100644 core/rootdir/cells/system/hw/init.rc
 create mode 100644 core/rootdir/cells/system/hw/init.usb.configfs.rc
 create mode 100644 core/rootdir/cells/system/hw/init.usb.rc
 create mode 100644 core/rootdir/cells/system/hw/init.zygote32.rc
 create mode 100644 core/rootdir/cells/system/hw/init.zygote64.rc
 create mode 100644 core/rootdir/cells/system/hw/init.zygote64_32.rc
 create mode 100644 core/rootdir/cells/system/hwservicemanager.rc
 create mode 100644 core/rootdir/cells/system/idmap2d.rc
 create mode 100644 core/rootdir/cells/system/incidentd.rc
 create mode 100644 core/rootdir/cells/system/init-debug.rc
 create mode 100644 core/rootdir/cells/system/installd.rc
 create mode 100644 core/rootdir/cells/system/iorapd.rc
 create mode 100644 core/rootdir/cells/system/keystore2.rc
 create mode 100644 core/rootdir/cells/system/llkd-debuggable.rc
 create mode 100644 core/rootdir/cells/system/llkd.rc
 create mode 100644 core/rootdir/cells/system/lmkd.rc
 create mode 100644 core/rootdir/cells/system/logcatd.rc
 create mode 100644 core/rootdir/cells/system/logd.rc
 create mode 100644 core/rootdir/cells/system/logtagd.rc
 create mode 100644 core/rootdir/cells/system/lpdumpd.rc
 create mode 100644 core/rootdir/cells/system/mdnsd.rc
 create mode 100644 core/rootdir/cells/system/mediaextractor.rc
 create mode 100644 core/rootdir/cells/system/mediametrics.rc
 create mode 100644 core/rootdir/cells/system/mediaserver.rc
 create mode 100644 core/rootdir/cells/system/mtpd.rc
 create mode 100644 core/rootdir/cells/system/netd.rc
 create mode 100644 core/rootdir/cells/system/odsign.rc
 create mode 100644 core/rootdir/cells/system/otapreopt.rc
 create mode 100644 core/rootdir/cells/system/perfetto.rc
 create mode 100644 core/rootdir/cells/system/profcollectd.rc
 create mode 100644 core/rootdir/cells/system/racoon.rc
 create mode 100644 core/rootdir/cells/system/recovery-persist.rc
 create mode 100644 core/rootdir/cells/system/recovery-refresh.rc
 create mode 100644 core/rootdir/cells/system/rss_hwm_reset.rc
 create mode 100644 core/rootdir/cells/system/servicemanager.rc
 create mode 100644 core/rootdir/cells/system/snapuserd.rc
 create mode 100644 core/rootdir/cells/system/storaged.rc
 create mode 100644 core/rootdir/cells/system/surfaceflinger.rc
 create mode 100644 core/rootdir/cells/system/tombstoned.rc
 create mode 100644 core/rootdir/cells/system/traced_perf.rc
 create mode 100644 core/rootdir/cells/system/uncrypt.rc
 create mode 100644 core/rootdir/cells/system/update_engine.rc
 create mode 100644 core/rootdir/cells/system/update_verifier.rc
 create mode 100644 core/rootdir/cells/system/usbd.rc
 create mode 100644 core/rootdir/cells/system/vdc.rc
 create mode 100644 core/rootdir/cells/system/vendor-464xlat.rc
 create mode 100644 core/rootdir/cells/system/vold.rc
 create mode 100644 core/rootdir/cells/system/wait_for_keymaster.rc
 create mode 100644 core/rootdir/cells/system/wifi.rc
 create mode 100644 core/rootdir/cells/system/wificond.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.atrace@1.0-service.pixel.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.audio.service.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.biometrics.fingerprint@2.2-service.fpc.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.bluetooth@1.0-service-qti.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.boot@1.2-service.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.camera.provider@2.7-service-google.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.cas@1.2-service.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.confirmationui@1.0-service-google.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.contexthub@1.2-service-generic.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.drm@1.4-service.clearkey.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.drm@1.4-service.widevine.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.dumpstate@1.1-service.redfin.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.gatekeeper@1.0-service-qti.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.gnss@2.1-service-qti.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.health.storage@1.0-service.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.health@2.1-service.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.identity@1.0-service.citadel.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.input.classifier@1.0-service.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.keymaster@4.0-service-qti.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.keymaster@4.1-service.citadel.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.media.omx@1.0-service.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.memtrack@1.0-service.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.neuralnetworks@1.3-service-qti.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.nfc@1.2-service.st.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.power-service.pixel-libperfmgr.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.power.stats@1.0-service.pixel.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.secure_element@1.2-service.st.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.sensors@2.0-service-multihal.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.thermal@2.0-service.pixel.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.usb@1.3-service.redfin.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.vibrator-service.redfin.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.weaver@1.0-service.citadel.rc
 create mode 100644 core/rootdir/cells/vendor/android.hardware.wifi.supplicant-service.rc
 create mode 100644 core/rootdir/cells/vendor/boringssl_self_test.rc
 create mode 100644 core/rootdir/cells/vendor/chre_daemon.rc
 create mode 100644 core/rootdir/cells/vendor/citadeld.rc
 create mode 100644 core/rootdir/cells/vendor/cnd-generic.rc
 create mode 100644 core/rootdir/cells/vendor/cnss-daemon.rc
 create mode 100644 core/rootdir/cells/vendor/dataadpl.rc
 create mode 100644 core/rootdir/cells/vendor/dataqti.rc
 create mode 100644 core/rootdir/cells/vendor/feature_enabler_client.rc
 create mode 100644 core/rootdir/cells/vendor/hostapd.android.rc
 create mode 100644 core/rootdir/cells/vendor/hw/init.redfin.rc
 create mode 100644 core/rootdir/cells/vendor/hw/init.sm7250.diag.rc
 create mode 100644 core/rootdir/cells/vendor/hw/init.sm7250.logging.rc
 create mode 100644 core/rootdir/cells/vendor/hw/init.sm7250.mpssrfs.rc
 create mode 100644 core/rootdir/cells/vendor/hw/init.sm7250.power.rc
 create mode 100644 core/rootdir/cells/vendor/hw/init.sm7250.rc
 create mode 100644 core/rootdir/cells/vendor/hw/init.sm7250.usb.rc
 create mode 100644 core/rootdir/cells/vendor/ims_rtp_daemon.rc
 create mode 100644 core/rootdir/cells/vendor/imsdatadaemon.rc
 create mode 100644 core/rootdir/cells/vendor/imsqmidaemon.rc
 create mode 100644 core/rootdir/cells/vendor/imsrcsd.rc
 create mode 100644 core/rootdir/cells/vendor/init-ramdump.rc
 create mode 100644 core/rootdir/cells/vendor/init-ramoops.rc
 create mode 100644 core/rootdir/cells/vendor/init.pixel.rc
 create mode 100644 core/rootdir/cells/vendor/init.sm7250.ipa.rc
 create mode 100644 core/rootdir/cells/vendor/init.sm7250.wlc.rc
 create mode 100644 core/rootdir/cells/vendor/init.time_daemon.rc
 create mode 100644 core/rootdir/cells/vendor/init.vendor.sensors.rc
 create mode 100644 core/rootdir/cells/vendor/init_citadel.rc
 create mode 100644 core/rootdir/cells/vendor/init_dp.rc
 create mode 100644 core/rootdir/cells/vendor/ipacm.rc
 create mode 100644 core/rootdir/cells/vendor/netmgrd.rc
 create mode 100644 core/rootdir/cells/vendor/pixel-mm-logd.rc
 create mode 100644 core/rootdir/cells/vendor/pixel-mm.rc
 create mode 100644 core/rootdir/cells/vendor/pixel-thermal-logd.rc
 create mode 100644 core/rootdir/cells/vendor/pixel-thermal-symlinks.rc
 create mode 100644 core/rootdir/cells/vendor/pixelstats-vendor.redbull.rc
 create mode 100644 core/rootdir/cells/vendor/port-bridge.rc
 create mode 100644 core/rootdir/cells/vendor/poweropt-service.rc
 create mode 100644 core/rootdir/cells/vendor/qcrild.rc
 create mode 100644 core/rootdir/cells/vendor/rebootescrow-citadel.rc
 create mode 100644 core/rootdir/cells/vendor/rlsservice.rc
 create mode 100644 core/rootdir/cells/vendor/shsusrd.rc
 create mode 100644 core/rootdir/cells/vendor/ssgtzd.rc
 create mode 100644 core/rootdir/cells/vendor/twoshay.rc
 create mode 100644 core/rootdir/cells/vendor/vendor.display.color@1.0-service.rc
 create mode 100644 core/rootdir/cells/vendor/vendor.google.wifi_ext@1.0-service.rc
 create mode 100644 core/rootdir/cells/vendor/vendor.qti.adsprpc-service.rc
 create mode 100644 core/rootdir/cells/vendor/vendor.qti.cdsprpc-service.rc
 create mode 100644 core/rootdir/cells/vendor/vendor.qti.hardware.charger_monitor@1.0-service.rc
 create mode 100644 core/rootdir/cells/vendor/vendor.qti.hardware.cryptfshw@1.0-service-qti.rc
 create mode 100644 core/rootdir/cells/vendor/vendor.qti.hardware.display.allocator-service.rc
 create mode 100644 core/rootdir/cells/vendor/vendor.qti.hardware.display.composer-service.rc
 create mode 100644 core/rootdir/cells/vendor/vendor.qti.hardware.dsp@1.0-service.rc
 create mode 100644 core/rootdir/cells/vendor/vendor.qti.hardware.qseecom@1.0-service.rc
 create mode 100644 core/rootdir/cells/vendor/vendor.qti.hardware.qteeconnector@1.0-service.rc
 create mode 100644 core/rootdir/cells/vendor/vendor.qti.hardware.tui_comm@1.0-service-qti.rc
 create mode 100644 core/rootdir/cells/vendor/vendor.qti.media.c2@1.0-service.rc
 create mode 100644 core/rootdir/cells/vendor/vendor.qti.qspmhal@1.0-service.rc
 create mode 100644 core/rootdir/cells/vendor/vendor.qti.rmt_storage.rc
 create mode 100644 core/rootdir/cells/vendor/vendor.qti.tftp.rc
 create mode 100644 core/rootdir/cells/vendor/vendor.sensors.qti.rc
 create mode 100644 core/rootdir/cells/vendor/vendor.sensors.sscrpcd.rc
 create mode 100644 core/rootdir/cells/vendor/vendor_flash_recovery.rc
 create mode 100644 core/rootdir/cells/vendor/vndservicemanager.rc

diff --git a/core/fs_mgr/fs_mgr_fstab.cpp b/core/fs_mgr/fs_mgr_fstab.cpp
index f5ab557..105245e 100644
--- a/core/fs_mgr/fs_mgr_fstab.cpp
+++ b/core/fs_mgr/fs_mgr_fstab.cpp
@@ -426,14 +426,23 @@ std::string GetFstabPath() {
 
         if (!fs_mgr_get_boot_config(prop, &suffix)) continue;
 
-        for (const char* prefix : {// late-boot/post-boot locations
-                                   "/odm/etc/fstab.", "/vendor/etc/fstab.",
-                                   // early boot locations
-                                   "/system/etc/fstab.", "/first_stage_ramdisk/system/etc/fstab.",
-                                   "/fstab.", "/first_stage_ramdisk/fstab."}) {
-            std::string fstab_path = prefix + suffix;
-            if (access(fstab_path.c_str(), F_OK) == 0) {
-                return fstab_path;
+        if (access("/.cell", F_OK) == 0) {
+            for (const char *prefix : {"/cells/fstab."}) {
+                std::string fstab_path = prefix + suffix;
+                if (access(fstab_path.c_str(), F_OK) == 0) {
+                    return fstab_path;
+                     }
+                }
+        }else{
+            for (const char* prefix : {// late-boot/post-boot locations
+                                    "/odm/etc/fstab.", "/vendor/etc/fstab.",
+                                    // early boot locations
+                                    "/system/etc/fstab.", "/first_stage_ramdisk/system/etc/fstab.",
+                                    "/fstab.", "/first_stage_ramdisk/fstab."}) {
+                std::string fstab_path = prefix + suffix;
+                if (access(fstab_path.c_str(), F_OK) == 0) {
+                    return fstab_path;
+                }
             }
         }
     }
diff --git a/core/gatekeeperd/gatekeeperd.cpp b/core/gatekeeperd/gatekeeperd.cpp
index 8792c83..d23a830 100644
--- a/core/gatekeeperd/gatekeeperd.cpp
+++ b/core/gatekeeperd/gatekeeperd.cpp
@@ -68,6 +68,7 @@ class GateKeeperProxy : public BnGateKeeperService {
         clear_state_if_needed_done = false;
         hw_device = IGatekeeper::getService();
         is_running_gsi = android::base::GetBoolProperty(android::gsi::kGsiBootedProp, false);
+        ALOGD("%s: is_running_gsi = %d ", __func__, is_running_gsi);
 
         if (!hw_device) {
             LOG(ERROR) << "Could not find Gatekeeper device, which makes me very sad.";
@@ -93,7 +94,7 @@ class GateKeeperProxy : public BnGateKeeperService {
             return;
         }
 
-        if (mark_cold_boot() && !is_running_gsi) {
+        if (mark_cold_boot() && !is_running_gsi && !get_cells_index()) {
             ALOGI("cold boot: clearing state");
             if (hw_device) {
                 hw_device->deleteAllUsers([](const GatekeeperResponse&) {});
@@ -152,9 +153,9 @@ class GateKeeperProxy : public BnGateKeeperService {
         CHECK(userId < kGsiOffset);
         CHECK(hw_device != nullptr);
         if (is_running_gsi) {
-            return userId + kGsiOffset;
+            return userId + kGsiOffset + get_cells_index() * 2000000;
         }
-        return userId;
+        return userId + get_cells_index() * 2000000;
     }
 
 #define GK_ERROR *gkResponse = GKResponse::error(), Status::ok()
@@ -393,6 +394,21 @@ class GateKeeperProxy : public BnGateKeeperService {
         return OK;
     }
 
+    uint32_t get_cells_index(){
+        std::string prop = android::base::GetProperty("ro.boot.vm", "0");
+        if(prop == "1"){
+            prop = android::base::GetProperty("ro.boot.vm.name", "");
+            int index = 0;
+            sscanf(prop.c_str(), "cell%d",&index);
+            if(index > 0 && index < CELLS_MAX_CONTEXT){
+                ALOGD("%s: index = %d", __func__, index);
+                return index;
+            }
+        }
+
+        return 0;
+    }
+
   private:
     sp<IGatekeeper> hw_device;
 
@@ -403,6 +419,9 @@ class GateKeeperProxy : public BnGateKeeperService {
 
 int main(int argc, char* argv[]) {
     ALOGI("Starting gatekeeperd...");
+
+    //android::OtherSystemServiceLoopRun();
+
     if (argc < 2) {
         ALOGE("A directory must be specified!");
         return 1;
diff --git a/core/init/init.cpp b/core/init/init.cpp
index 942feb9..e76a0c2 100644
--- a/core/init/init.cpp
+++ b/core/init/init.cpp
@@ -304,26 +304,37 @@ Parser CreateServiceOnlyParser(ServiceList& service_list, bool from_apex) {
 static void LoadBootScripts(ActionManager& action_manager, ServiceList& service_list) {
     Parser parser = CreateParser(action_manager, service_list);
 
-    std::string bootscript = GetProperty("ro.boot.init_rc", "");
-    if (bootscript.empty()) {
-        parser.ParseConfig("/system/etc/init/hw/init.rc");
-        if (!parser.ParseConfig("/system/etc/init")) {
-            late_import_paths.emplace_back("/system/etc/init");
+    if(access("/.cell", F_OK) == 0){
+        LOG(INFO) << "LOAD VP RC...";
+        parser.ParseConfig("/cells/system/hw/init.rc");
+        if (!parser.ParseConfig("/cells/system")) {
+            late_import_paths.emplace_back("/cells/system");
         }
-        // late_import is available only in Q and earlier release. As we don't
-        // have system_ext in those versions, skip late_import for system_ext.
-        parser.ParseConfig("/system_ext/etc/init");
-        if (!parser.ParseConfig("/vendor/etc/init")) {
-            late_import_paths.emplace_back("/vendor/etc/init");
+        if (!parser.ParseConfig("/cells/vendor")) {
+            late_import_paths.emplace_back("/cells/vendor");
         }
-        if (!parser.ParseConfig("/odm/etc/init")) {
-            late_import_paths.emplace_back("/odm/etc/init");
-        }
-        if (!parser.ParseConfig("/product/etc/init")) {
-            late_import_paths.emplace_back("/product/etc/init");
+    }else{
+        std::string bootscript = GetProperty("ro.boot.init_rc", "");
+        if (bootscript.empty()) {
+            parser.ParseConfig("/system/etc/init/hw/init.rc");
+            if (!parser.ParseConfig("/system/etc/init")) {
+                late_import_paths.emplace_back("/system/etc/init");
+            }
+            // late_import is available only in Q and earlier release. As we don't
+            // have system_ext in those versions, skip late_import for system_ext.
+            parser.ParseConfig("/system_ext/etc/init");
+            if (!parser.ParseConfig("/vendor/etc/init")) {
+                late_import_paths.emplace_back("/vendor/etc/init");
+            }
+            if (!parser.ParseConfig("/odm/etc/init")) {
+                late_import_paths.emplace_back("/odm/etc/init");
+            }
+            if (!parser.ParseConfig("/product/etc/init")) {
+                late_import_paths.emplace_back("/product/etc/init");
+            }
+        } else {
+            parser.ParseConfig(bootscript);
         }
-    } else {
-        parser.ParseConfig(bootscript);
     }
 }
 
@@ -335,6 +346,9 @@ void PropertyChanged(const std::string& name, const std::string& value) {
     // In non-thermal-shutdown case, 'shutdown' trigger will be fired to let device specific
     // commands to be executed.
     if (name == "sys.powerctl") {
+        if (access("/.cell", F_OK) ==0) {
+            return ;
+        }
         trigger_shutdown(value);
     }
 
diff --git a/core/init/property_service.cpp b/core/init/property_service.cpp
index 2d67bf5..7ab60ba 100644
--- a/core/init/property_service.cpp
+++ b/core/init/property_service.cpp
@@ -77,6 +77,7 @@
 using namespace std::literals;
 
 using android::base::GetProperty;
+using android::base::SetProperty;
 using android::base::ParseInt;
 using android::base::ReadFileToString;
 using android::base::Split;
@@ -1247,6 +1248,23 @@ static void ProcessBootconfig() {
     });
 }
 
+static void InitVMName()
+{
+	int vmfd = open("/.name",O_RDONLY);
+	if (vmfd >= 0) {
+		char buf[125] = {0};
+		int len = read(vmfd, buf, 125);
+		if (len > 0) {
+			InitPropertySet("ro.boot.vm.name", buf);
+			LOG(INFO) << "ro.boot.vm.name = "<< buf;
+		}
+		close(vmfd);
+	}else{
+        InitPropertySet("ro.boot.vm.name", "");
+        LOG(INFO) << "ro.boot.vm.name = ";
+    }
+}
+
 void PropertyInit() {
     selinux_callback cb;
     cb.func_audit = PropertyAuditCallback;
@@ -1271,6 +1289,8 @@ void PropertyInit() {
     // used by init as well as the current required properties.
     ExportKernelBootProps();
 
+    InitVMName();
+
     PropertyLoadBootDefaults();
 }
 
diff --git a/core/init/switch_root.cpp b/core/init/switch_root.cpp
index 575b67f..98795bc 100644
--- a/core/init/switch_root.cpp
+++ b/core/init/switch_root.cpp
@@ -74,20 +74,24 @@ void SwitchRoot(const std::string& new_root) {
 
     LOG(INFO) << "Switching root to '" << new_root << "'";
 
-    for (const auto& mount_path : mounts) {
-        auto new_mount_path = new_root + mount_path;
-        mkdir(new_mount_path.c_str(), 0755);
-        if (mount(mount_path.c_str(), new_mount_path.c_str(), nullptr, MS_MOVE, nullptr) != 0) {
-            PLOG(FATAL) << "Unable to move mount at '" << mount_path << "'";
+    if(access("/.cell", F_OK) != 0){
+        for (const auto& mount_path : mounts) {
+            auto new_mount_path = new_root + mount_path;
+            mkdir(new_mount_path.c_str(), 0755);
+            if (mount(mount_path.c_str(), new_mount_path.c_str(), nullptr, MS_MOVE, nullptr) != 0) {
+                PLOG(FATAL) << "Unable to move mount at '" << mount_path << "'";
+            }
         }
-    }
 
-    if (chdir(new_root.c_str()) != 0) {
-        PLOG(FATAL) << "Could not chdir to new_root, '" << new_root << "'";
-    }
+        if (chdir(new_root.c_str()) != 0) {
+            PLOG(FATAL) << "Could not chdir to new_root, '" << new_root << "'";
+        }
 
-    if (mount(new_root.c_str(), "/", nullptr, MS_MOVE, nullptr) != 0) {
-        PLOG(FATAL) << "Unable to move root mount to new_root, '" << new_root << "'";
+        if (mount(new_root.c_str(), "/", nullptr, MS_MOVE, nullptr) != 0) {
+            PLOG(FATAL) << "Unable to move root mount to new_root, '" << new_root << "'";
+        }
+    }else{
+        LOG(INFO) << "No Switch VP root'";
     }
 
     if (chroot(".") != 0) {
diff --git a/core/libprocessgroup/processgroup.cpp b/core/libprocessgroup/processgroup.cpp
index c824376..552ab26 100644
--- a/core/libprocessgroup/processgroup.cpp
+++ b/core/libprocessgroup/processgroup.cpp
@@ -182,7 +182,16 @@ void removeAllProcessGroups() {
     std::vector<std::string> cgroups;
     std::string path;
 
-    if (CgroupGetControllerPath(CGROUPV2_CONTROLLER_NAME, &path)) {
+    if (CgroupGetControllerPath(CGROUPV2_CONTROLLER_NAME, &path))
+    {
+        {
+            std::string vmname = android::base::GetProperty("ro.boot.vm.name","");
+            if(vmname != "" && path.find("/sys/fs/cgroup") == 0){
+                std::string newsubstr = "/sys/fs/cgroup/" + vmname;
+                path.replace(0, strlen("/sys/fs/cgroup"), newsubstr);
+            }
+            LOG(INFO)  << "removeAllProcessGroups path: " << path;
+        }
         cgroups.push_back(path);
     }
     if (CgroupGetControllerPath("memory", &path)) {
@@ -344,6 +353,15 @@ static int KillProcessGroup(uid_t uid, int initialPid, int signal, int retries,
                             int* max_processes) {
     std::string hierarchy_root_path;
     CgroupGetControllerPath(CGROUPV2_CONTROLLER_NAME, &hierarchy_root_path);
+    {
+        std::string vmname = android::base::GetProperty("ro.boot.vm.name","");
+        if(vmname != "" && hierarchy_root_path.find("/sys/fs/cgroup") == 0){
+            std::string newsubstr = "/sys/fs/cgroup/" + vmname;
+            hierarchy_root_path.replace(0, strlen("/sys/fs/cgroup"), newsubstr);
+        }
+        LOG(INFO)  << "KillProcessGroup hierarchy_root_path: " << hierarchy_root_path;
+    }
+
     const char* cgroup = hierarchy_root_path.c_str();
 
     std::chrono::steady_clock::time_point start = std::chrono::steady_clock::now();
@@ -424,6 +442,15 @@ static int createProcessGroupInternal(uid_t uid, int initialPid, std::string cgr
     gid_t cgroup_uid = AID_SYSTEM;
     uid_t cgroup_gid = AID_SYSTEM;
 
+    {
+        std::string vmname = android::base::GetProperty("ro.boot.vm.name","");
+        if(vmname != "" && uid_path.find("/sys/fs/cgroup") == 0){
+            std::string newsubstr = "/sys/fs/cgroup/" + vmname;
+            uid_path.replace(0, strlen("/sys/fs/cgroup"), newsubstr);
+        }
+        LOG(INFO)  << "createProcessGroupInternal uid_path: " << uid_path;
+    }
+
     if (stat(cgroup.c_str(), &cgroup_stat) == 1) {
         PLOG(ERROR) << "Failed to get stats for " << cgroup;
     } else {
@@ -438,6 +465,14 @@ static int createProcessGroupInternal(uid_t uid, int initialPid, std::string cgr
     }
 
     auto uid_pid_path = ConvertUidPidToPath(cgroup.c_str(), uid, initialPid);
+    {
+        std::string vmname = android::base::GetProperty("ro.boot.vm.name","");
+        if(vmname != "" && uid_pid_path.find("/sys/fs/cgroup") == 0){
+            std::string newsubstr = "/sys/fs/cgroup/" + vmname;
+            uid_pid_path.replace(0, strlen("/sys/fs/cgroup"), newsubstr);
+        }
+        LOG(INFO)  << "createProcessGroupInternal uid_pid_path: " << uid_pid_path;
+    }
 
     if (!MkdirAndChown(uid_pid_path, cgroup_mode, cgroup_uid, cgroup_gid)) {
         PLOG(ERROR) << "Failed to make and chown " << uid_pid_path;
diff --git a/core/rootdir/Android.mk b/core/rootdir/Android.mk
index 99d8f9a..5640dcb 100644
--- a/core/rootdir/Android.mk
+++ b/core/rootdir/Android.mk
@@ -10,6 +10,7 @@ LOCAL_LICENSE_CONDITIONS := notice
 LOCAL_SRC_FILES := $(LOCAL_MODULE)
 LOCAL_MODULE_CLASS := ETC
 LOCAL_MODULE_PATH := $(TARGET_OUT_ETC)/init
+LOCAL_POST_INSTALL_CMD := mkdir -p  $(TARGET_ROOT_OUT)/cells; cp -rf $(LOCAL_PATH)/cells/* $(TARGET_ROOT_OUT)/cells/;
 
 include $(BUILD_PREBUILT)
 
diff --git a/core/rootdir/cells/fstab.persist b/core/rootdir/cells/fstab.persist
new file mode 100644
index 0000000..37153d4
--- /dev/null
+++ b/core/rootdir/cells/fstab.persist
@@ -0,0 +1,5 @@
+# Keep persist in an fstab file, since we need to run fsck on it after abnormal shutdown.
+
+# /dev/block/platform/soc/1d84000.ufshc/by-name/persist /mnt/vendor/persist ext4    nosuid,nodev,noatime,barrier=1  wait
+
+#<src>                                                <mnt_point>         <type>  <mnt_flags and options>         <fs_mgr_flags>
diff --git a/core/rootdir/cells/fstab.postinstall b/core/rootdir/cells/fstab.postinstall
new file mode 100644
index 0000000..0728039
--- /dev/null
+++ b/core/rootdir/cells/fstab.postinstall
@@ -0,0 +1,23 @@
+#
+# Copyright (C) 2018 The Android Open Source Project
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+
+# Tries to mount system_other as a logical partition. If that fails, then
+# mount as a physical partition.
+
+# system                    /postinstall ext4   ro,nosuid,nodev,noexec  slotselect_other,logical
+# /dev/block/by-name/system /postinstall ext4   ro,nosuid,nodev,noexec  slotselect_other
+
+#<src>                    <mnt_point>  <type> <mnt_flags and options> <fs_mgr_flags>
+
diff --git a/core/rootdir/cells/fstab.ppostinstall b/core/rootdir/cells/fstab.ppostinstall
new file mode 100644
index 0000000..c1520f4
--- /dev/null
+++ b/core/rootdir/cells/fstab.ppostinstall
@@ -0,0 +1,18 @@
+#
+# Copyright (C) 2018 The Android Open Source Project
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+
+# system                    /postinstall ext4   ro,nosuid,nodev,noexec  slotselect_other,logical,avb_keys=/product/etc/security/avb/system_other.avbpubkey
+
+#<src>                    <mnt_point>  <type> <mnt_flags and options> <fs_mgr_flags>
diff --git a/core/rootdir/cells/fstab.sm7250 b/core/rootdir/cells/fstab.sm7250
new file mode 100644
index 0000000..3036490
--- /dev/null
+++ b/core/rootdir/cells/fstab.sm7250
@@ -0,0 +1,4 @@
+# Android fstab file.
+
+#<src>                                                  <mnt_point>            <type>  <mnt_flags and options>                              <fs_mgr_flags>
+/dev/block/bootdevice/by-name/misc                      /misc                  emmc    defaults                                             defaults
diff --git a/core/rootdir/cells/system/android.hidl.allocator@1.0-service.rc b/core/rootdir/cells/system/android.hidl.allocator@1.0-service.rc
new file mode 100644
index 0000000..4f05523
--- /dev/null
+++ b/core/rootdir/cells/system/android.hidl.allocator@1.0-service.rc
@@ -0,0 +1,4 @@
+service hidl_memory /system/bin/hw/android.hidl.allocator@1.0-service
+    class hal
+    user system
+    group system
diff --git a/core/rootdir/cells/system/android.system.suspend@1.0-service.rc b/core/rootdir/cells/system/android.system.suspend@1.0-service.rc
new file mode 100644
index 0000000..965ca16
--- /dev/null
+++ b/core/rootdir/cells/system/android.system.suspend@1.0-service.rc
@@ -0,0 +1,5 @@
+service system_suspend /system/bin/hw/android.system.suspend@1.0-service
+    class early_hal
+    user system
+    group system wakelock
+    capabilities BLOCK_SUSPEND
diff --git a/core/rootdir/cells/system/apexd.rc b/core/rootdir/cells/system/apexd.rc
new file mode 100644
index 0000000..f64688f
--- /dev/null
+++ b/core/rootdir/cells/system/apexd.rc
@@ -0,0 +1,21 @@
+service apexd /system/bin/apexd
+    interface aidl apexservice
+    class core
+    user root
+    group system
+    oneshot
+    disabled # does not start with the core class
+    reboot_on_failure reboot,apexd-failed
+
+service apexd-bootstrap /system/bin/apexd --bootstrap
+    user root
+    group system
+    oneshot
+    disabled
+    reboot_on_failure reboot,bootloader,bootstrap-apexd-failed
+
+service apexd-snapshotde /system/bin/apexd --snapshotde
+    user root
+    group system
+    oneshot
+    disabled
diff --git a/core/rootdir/cells/system/atrace.rc b/core/rootdir/cells/system/atrace.rc
new file mode 100644
index 0000000..01c4723
--- /dev/null
+++ b/core/rootdir/cells/system/atrace.rc
@@ -0,0 +1,379 @@
+## Permissions to allow system-wide tracing to the kernel trace buffer.
+##
+on late-init
+
+# Allow writing to the kernel trace log.
+    chmod 0222 /sys/kernel/debug/tracing/trace_marker
+    chmod 0222 /sys/kernel/tracing/trace_marker
+
+# Scheduler tracepoints require schedstats=enable
+    write /proc/sys/kernel/sched_schedstats 1
+
+# Grant unix world read/write permissions to kernel tracepoints.
+# Access control to these files is now entirely in selinux policy.
+    chmod 0666 /sys/kernel/debug/tracing/trace_clock
+    chmod 0666 /sys/kernel/tracing/trace_clock
+    chmod 0666 /sys/kernel/debug/tracing/buffer_size_kb
+    chmod 0666 /sys/kernel/tracing/buffer_size_kb
+    chmod 0666 /sys/kernel/debug/tracing/options/overwrite
+    chmod 0666 /sys/kernel/tracing/options/overwrite
+    chmod 0666 /sys/kernel/debug/tracing/options/print-tgid
+    chmod 0666 /sys/kernel/tracing/options/print-tgid
+    chmod 0666 /sys/kernel/debug/tracing/options/record-tgid
+    chmod 0666 /sys/kernel/tracing/options/record-tgid
+    chmod 0666 /sys/kernel/debug/tracing/saved_cmdlines_size
+    chmod 0666 /sys/kernel/tracing/saved_cmdlines_size
+    chmod 0666 /sys/kernel/debug/tracing/events/sched/sched_switch/enable
+    chmod 0666 /sys/kernel/tracing/events/sched/sched_switch/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/sched/sched_wakeup/enable
+    chmod 0666 /sys/kernel/tracing/events/sched/sched_wakeup/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/sched/sched_blocked_reason/enable
+    chmod 0666 /sys/kernel/tracing/events/sched/sched_blocked_reason/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/sched/sched_cpu_hotplug/enable
+    chmod 0666 /sys/kernel/tracing/events/sched/sched_cpu_hotplug/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/sched/sched_pi_setprio/enable
+    chmod 0666 /sys/kernel/tracing/events/sched/sched_pi_setprio/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/sched/sched_process_exit/enable
+    chmod 0666 /sys/kernel/tracing/events/sched/sched_process_exit/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/sched/sched_waking/enable
+    chmod 0666 /sys/kernel/tracing/events/sched/sched_waking/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/sched/sched_wakeup_new/enable
+    chmod 0666 /sys/kernel/tracing/events/sched/sched_wakeup_new/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/cgroup/enable
+    chmod 0666 /sys/kernel/tracing/events/cgroup/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/power/cpu_frequency/enable
+    chmod 0666 /sys/kernel/tracing/events/power/cpu_frequency/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/power/cpu_idle/enable
+    chmod 0666 /sys/kernel/tracing/events/power/cpu_idle/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/power/clock_enable/enable
+    chmod 0666 /sys/kernel/tracing/events/power/clock_enable/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/power/clock_disable/enable
+    chmod 0666 /sys/kernel/tracing/events/power/clock_disable/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/power/clock_set_rate/enable
+    chmod 0666 /sys/kernel/tracing/events/power/clock_set_rate/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/power/cpu_frequency_limits/enable
+    chmod 0666 /sys/kernel/tracing/events/power/cpu_frequency_limits/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/cpuhp/cpuhp_enter/enable
+    chmod 0666 /sys/kernel/tracing/events/cpuhp/cpuhp_enter/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/cpuhp/cpuhp_exit/enable
+    chmod 0666 /sys/kernel/tracing/events/cpuhp/cpuhp_exit/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/cpuhp/cpuhp_pause/enable
+    chmod 0666 /sys/kernel/tracing/events/cpuhp/cpuhp_pause/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/power/gpu_frequency/enable
+    chmod 0666 /sys/kernel/tracing/events/power/gpu_frequency/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/power/suspend_resume/enable
+    chmod 0666 /sys/kernel/tracing/events/power/suspend_resume/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/cpufreq_interactive/enable
+    chmod 0666 /sys/kernel/tracing/events/cpufreq_interactive/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/vmscan/mm_vmscan_direct_reclaim_begin/enable
+    chmod 0666 /sys/kernel/tracing/events/vmscan/mm_vmscan_direct_reclaim_begin/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/vmscan/mm_vmscan_direct_reclaim_end/enable
+    chmod 0666 /sys/kernel/tracing/events/vmscan/mm_vmscan_direct_reclaim_end/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/vmscan/mm_vmscan_kswapd_wake/enable
+    chmod 0666 /sys/kernel/tracing/events/vmscan/mm_vmscan_kswapd_wake/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/vmscan/mm_vmscan_kswapd_sleep/enable
+    chmod 0666 /sys/kernel/tracing/events/vmscan/mm_vmscan_kswapd_sleep/enable
+    chmod 0666 /sys/kernel/debug/tracing/tracing_on
+    chmod 0666 /sys/kernel/tracing/tracing_on
+    chmod 0666 /sys/kernel/debug/tracing/events/binder/binder_transaction/enable
+    chmod 0666 /sys/kernel/tracing/events/binder/binder_transaction/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/binder/binder_transaction_received/enable
+    chmod 0666 /sys/kernel/tracing/events/binder/binder_transaction_received/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/binder/binder_transaction_alloc_buf/enable
+    chmod 0666 /sys/kernel/tracing/events/binder/binder_transaction_alloc_buf/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/binder/binder_lock/enable
+    chmod 0666 /sys/kernel/tracing/events/binder/binder_lock/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/binder/binder_locked/enable
+    chmod 0666 /sys/kernel/tracing/events/binder/binder_locked/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/binder/binder_unlock/enable
+    chmod 0666 /sys/kernel/tracing/events/binder/binder_unlock/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/binder/binder_set_priority/enable
+    chmod 0666 /sys/kernel/tracing/events/binder/binder_set_priority/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/i2c/enable
+    chmod 0666 /sys/kernel/tracing/events/i2c/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/i2c/i2c_read/enable
+    chmod 0666 /sys/kernel/tracing/events/i2c/i2c_read/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/i2c/i2c_write/enable
+    chmod 0666 /sys/kernel/tracing/events/i2c/i2c_write/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/i2c/i2c_result/enable
+    chmod 0666 /sys/kernel/tracing/events/i2c/i2c_result/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/i2c/i2c_reply/enable
+    chmod 0666 /sys/kernel/tracing/events/i2c/i2c_reply/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/i2c/smbus_read/enable
+    chmod 0666 /sys/kernel/tracing/events/i2c/smbus_read/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/i2c/smbus_write/enable
+    chmod 0666 /sys/kernel/tracing/events/i2c/smbus_write/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/i2c/smbus_result/enable
+    chmod 0666 /sys/kernel/tracing/events/i2c/smbus_result/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/i2c/smbus_reply/enable
+    chmod 0666 /sys/kernel/tracing/events/i2c/smbus_reply/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/lowmemorykiller/enable
+    chmod 0666 /sys/kernel/tracing/events/lowmemorykiller/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/sync/enable
+    chmod 0666 /sys/kernel/tracing/events/sync/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/fence/enable
+    chmod 0666 /sys/kernel/tracing/events/fence/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/dma_fence/enable
+    chmod 0666 /sys/kernel/tracing/events/dma_fence/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/kmem/rss_stat/enable
+    chmod 0666 /sys/kernel/tracing/events/kmem/rss_stat/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/kmem/ion_heap_grow/enable
+    chmod 0666 /sys/kernel/tracing/events/kmem/ion_heap_grow/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/kmem/ion_heap_shrink/enable
+    chmod 0666 /sys/kernel/tracing/events/kmem/ion_heap_shrink/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/ion/ion_stat/enable
+    chmod 0666 /sys/kernel/tracing/events/ion/ion_stat/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/mm_event/mm_event_record/enable
+    chmod 0666 /sys/kernel/tracing/events/mm_event/mm_event_record/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/signal/signal_generate/enable
+    chmod 0666 /sys/kernel/tracing/events/signal/signal_generate/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/signal/signal_deliver/enable
+    chmod 0666 /sys/kernel/tracing/events/signal/signal_deliver/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/mm_event/mm_event_record/enable
+    chmod 0666 /sys/kernel/tracing/events/mm_event/mm_event_record/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/lowmemorykiller/lowmemory_kill/enable
+    chmod 0666 /sys/kernel/tracing/events/lowmemorykiller/lowmemory_kill/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/oom/oom_score_adj_update/enable
+    chmod 0666 /sys/kernel/tracing/events/oom/oom_score_adj_update/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/oom/mark_victim/enable
+    chmod 0666 /sys/kernel/tracing/events/oom/mark_victim/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/task/task_rename/enable
+    chmod 0666 /sys/kernel/tracing/events/task/task_rename/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/task/task_newtask/enable
+    chmod 0666 /sys/kernel/tracing/events/task/task_newtask/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/gpu_mem/gpu_mem_total/enable
+    chmod 0666 /sys/kernel/tracing/events/gpu_mem/gpu_mem_total/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/irq/enable
+    chmod 0666 /sys/kernel/tracing/events/irq/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/irq/irq_handler_entry/enable
+    chmod 0666 /sys/kernel/tracing/events/irq/irq_handler_entry/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/irq/irq_handler_exit/enable
+    chmod 0666 /sys/kernel/tracing/events/irq/irq_handler_exit/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/irq/softirq_entry/enable
+    chmod 0666 /sys/kernel/tracing/events/irq/softirq_entry/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/irq/softirq_exit/enable
+    chmod 0666 /sys/kernel/tracing/events/irq/softirq_exit/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/irq/softirq_raise/enable
+    chmod 0666 /sys/kernel/tracing/events/irq/softirq_raise/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/irq/tasklet_entry/enable
+    chmod 0666 /sys/kernel/tracing/events/irq/tasklet_entry/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/irq/tasklet_exit/enable
+    chmod 0666 /sys/kernel/tracing/events/irq/tasklet_exit/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/irq/tasklet_hi_entry/enable
+    chmod 0666 /sys/kernel/tracing/events/irq/tasklet_hi_entry/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/irq/tasklet_hi_exit/enable
+    chmod 0666 /sys/kernel/tracing/events/irq/tasklet_hi_exit/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/ipi/enable
+    chmod 0666 /sys/kernel/tracing/events/ipi/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/ipi/ipi_entry/enable
+    chmod 0666 /sys/kernel/tracing/events/ipi/ipi_entry/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/ipi/ipi_exit/enable
+    chmod 0666 /sys/kernel/tracing/events/ipi/ipi_exit/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/ipi/ipi_raise/enable
+    chmod 0666 /sys/kernel/tracing/events/ipi/ipi_raise/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/clk/clk_enable/enable
+    chmod 0666 /sys/kernel/tracing/events/clk/clk_disable/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/clk/clk_disable/enable
+    chmod 0666 /sys/kernel/tracing/events/clk/clk_enable/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/clk/clk_set_rate/enable
+    chmod 0666 /sys/kernel/tracing/events/clk/clk_set_rate/enable
+
+    # disk
+    chmod 0666 /sys/kernel/tracing/events/f2fs/f2fs_get_data_block/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/f2fs/f2fs_get_data_block/enable
+    chmod 0666 /sys/kernel/tracing/events/f2fs/f2fs_iget/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/f2fs/f2fs_iget/enable
+    chmod 0666 /sys/kernel/tracing/events/f2fs/f2fs_sync_file_enter/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/f2fs/f2fs_sync_file_enter/enable
+    chmod 0666 /sys/kernel/tracing/events/f2fs/f2fs_sync_file_exit/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/f2fs/f2fs_sync_file_exit/enable
+    chmod 0666 /sys/kernel/tracing/events/f2fs/f2fs_write_begin/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/f2fs/f2fs_write_begin/enable
+    chmod 0666 /sys/kernel/tracing/events/f2fs/f2fs_write_end/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/f2fs/f2fs_write_end/enable
+    chmod 0666 /sys/kernel/tracing/events/ext4/ext4_da_write_begin/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/ext4/ext4_da_write_begin/enable
+    chmod 0666 /sys/kernel/tracing/events/ext4/ext4_da_write_end/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/ext4/ext4_da_write_end/enable
+    chmod 0666 /sys/kernel/tracing/events/ext4/ext4_es_lookup_extent_enter/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/ext4/ext4_es_lookup_extent_enter/enable
+    chmod 0666 /sys/kernel/tracing/events/ext4/ext4_es_lookup_extent_exit/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/ext4/ext4_es_lookup_extent_exit/enable
+    chmod 0666 /sys/kernel/tracing/events/ext4/ext4_load_inode/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/ext4/ext4_load_inode/enable
+    chmod 0666 /sys/kernel/tracing/events/ext4/ext4_sync_file_enter/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/ext4/ext4_sync_file_enter/enable
+    chmod 0666 /sys/kernel/tracing/events/ext4/ext4_sync_file_exit/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/ext4/ext4_sync_file_exit/enable
+    chmod 0666 /sys/kernel/tracing/events/block/block_rq_issue/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/block/block_rq_issue/enable
+    chmod 0666 /sys/kernel/tracing/events/block/block_rq_complete/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/block/block_rq_complete/enable
+
+    # filemap events for iorapd
+    chmod 0666 /sys/kernel/tracing/events/filemap/mm_filemap_add_to_page_cache/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/filemap/mm_filemap_add_to_page_cache/enable
+    chmod 0666 /sys/kernel/tracing/events/filemap/mm_filemap_delete_from_page_cache/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/filemap/mm_filemap_delete_from_page_cache/enable
+
+    # thermal
+    chmod 0666 /sys/kernel/debug/tracing/events/thermal/thermal_temperature/enable
+    chmod 0666 /sys/kernel/tracing/events/thermal/thermal_temperature/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/thermal/cdev_update/enable
+    chmod 0666 /sys/kernel/tracing/events/thermal/cdev_update/enable
+
+# Tracing disabled by default
+    write /sys/kernel/debug/tracing/tracing_on 0
+    write /sys/kernel/tracing/tracing_on 0
+
+# Read and truncate the kernel trace.
+    chmod 0666 /sys/kernel/debug/tracing/trace
+    chmod 0666 /sys/kernel/tracing/trace
+
+# Read and truncate the per-CPU kernel trace.
+# Cannot use wildcards in .rc files. Update this if there is a phone with
+# more CPUs.
+    chmod 0666 /sys/kernel/debug/tracing/per_cpu/cpu0/trace
+    chmod 0666 /sys/kernel/tracing/per_cpu/cpu0/trace
+    chmod 0666 /sys/kernel/debug/tracing/per_cpu/cpu1/trace
+    chmod 0666 /sys/kernel/tracing/per_cpu/cpu1/trace
+    chmod 0666 /sys/kernel/debug/tracing/per_cpu/cpu2/trace
+    chmod 0666 /sys/kernel/tracing/per_cpu/cpu2/trace
+    chmod 0666 /sys/kernel/debug/tracing/per_cpu/cpu3/trace
+    chmod 0666 /sys/kernel/tracing/per_cpu/cpu3/trace
+    chmod 0666 /sys/kernel/debug/tracing/per_cpu/cpu4/trace
+    chmod 0666 /sys/kernel/tracing/per_cpu/cpu4/trace
+    chmod 0666 /sys/kernel/debug/tracing/per_cpu/cpu5/trace
+    chmod 0666 /sys/kernel/tracing/per_cpu/cpu5/trace
+    chmod 0666 /sys/kernel/debug/tracing/per_cpu/cpu6/trace
+    chmod 0666 /sys/kernel/tracing/per_cpu/cpu6/trace
+    chmod 0666 /sys/kernel/debug/tracing/per_cpu/cpu7/trace
+    chmod 0666 /sys/kernel/tracing/per_cpu/cpu7/trace
+    chmod 0666 /sys/kernel/debug/tracing/per_cpu/cpu8/trace
+    chmod 0666 /sys/kernel/tracing/per_cpu/cpu8/trace
+    chmod 0666 /sys/kernel/debug/tracing/per_cpu/cpu9/trace
+    chmod 0666 /sys/kernel/tracing/per_cpu/cpu9/trace
+    chmod 0666 /sys/kernel/debug/tracing/per_cpu/cpu10/trace
+    chmod 0666 /sys/kernel/tracing/per_cpu/cpu10/trace
+    chmod 0666 /sys/kernel/debug/tracing/per_cpu/cpu11/trace
+    chmod 0666 /sys/kernel/tracing/per_cpu/cpu11/trace
+    chmod 0666 /sys/kernel/debug/tracing/per_cpu/cpu12/trace
+    chmod 0666 /sys/kernel/tracing/per_cpu/cpu12/trace
+    chmod 0666 /sys/kernel/debug/tracing/per_cpu/cpu13/trace
+    chmod 0666 /sys/kernel/tracing/per_cpu/cpu13/trace
+    chmod 0666 /sys/kernel/debug/tracing/per_cpu/cpu14/trace
+    chmod 0666 /sys/kernel/tracing/per_cpu/cpu14/trace
+    chmod 0666 /sys/kernel/debug/tracing/per_cpu/cpu15/trace
+    chmod 0666 /sys/kernel/tracing/per_cpu/cpu15/trace
+    chmod 0666 /sys/kernel/debug/tracing/per_cpu/cpu16/trace
+    chmod 0666 /sys/kernel/tracing/per_cpu/cpu16/trace
+    chmod 0666 /sys/kernel/debug/tracing/per_cpu/cpu17/trace
+    chmod 0666 /sys/kernel/tracing/per_cpu/cpu17/trace
+    chmod 0666 /sys/kernel/debug/tracing/per_cpu/cpu18/trace
+    chmod 0666 /sys/kernel/tracing/per_cpu/cpu18/trace
+    chmod 0666 /sys/kernel/debug/tracing/per_cpu/cpu19/trace
+    chmod 0666 /sys/kernel/tracing/per_cpu/cpu19/trace
+    chmod 0666 /sys/kernel/debug/tracing/per_cpu/cpu20/trace
+    chmod 0666 /sys/kernel/tracing/per_cpu/cpu20/trace
+    chmod 0666 /sys/kernel/debug/tracing/per_cpu/cpu21/trace
+    chmod 0666 /sys/kernel/tracing/per_cpu/cpu21/trace
+    chmod 0666 /sys/kernel/debug/tracing/per_cpu/cpu22/trace
+    chmod 0666 /sys/kernel/tracing/per_cpu/cpu22/trace
+    chmod 0666 /sys/kernel/debug/tracing/per_cpu/cpu23/trace
+    chmod 0666 /sys/kernel/tracing/per_cpu/cpu23/trace
+
+# Only create the tracing instance if persist.mm_events.enabled
+# Attempting to remove the tracing instance after it has been created
+# will likely fail with EBUSY as it would be in use by traced_probes.
+on post-fs-data && property:persist.mm_events.enabled=true
+# Create MM Events Tracing Instance for Kmem Activity Trigger
+    mkdir /sys/kernel/debug/tracing/instances/mm_events 0755 system system
+    mkdir /sys/kernel/tracing/instances/mm_events 0755 system system
+
+# Read and set per CPU buffer size
+    chmod 0666 /sys/kernel/debug/tracing/instances/mm_events/buffer_size_kb
+    chmod 0666 /sys/kernel/tracing/instances/mm_events/buffer_size_kb
+
+# Set the default buffer size to the minimum
+    write /sys/kernel/debug/tracing/instances/mm_events/buffer_size_kb 1
+    write /sys/kernel/tracing/instances/mm_events/buffer_size_kb 1
+
+# Read and enable tracing
+    chmod 0666 /sys/kernel/debug/tracing/instances/mm_events/tracing_on
+    chmod 0666 /sys/kernel/tracing/instances/mm_events/tracing_on
+
+# Tracing disabled by default
+    write /sys/kernel/debug/tracing/instances/mm_events/tracing_on 0
+    write /sys/kernel/tracing/instances/mm_events/tracing_on 0
+
+# Read and truncate kernel trace
+    chmod 0666 /sys/kernel/debug/tracing/instances/mm_events/trace
+    chmod 0666 /sys/kernel/tracing/instances/mm_events/trace
+
+# Enable trace events
+    chmod 0666 /sys/kernel/debug/tracing/instances/mm_events/events/vmscan/mm_vmscan_direct_reclaim_begin/enable
+    chmod 0666 /sys/kernel/tracing/instances/mm_events/events/vmscan/mm_vmscan_direct_reclaim_begin/enable
+    chmod 0666 /sys/kernel/debug/tracing/instances/mm_events/events/vmscan/mm_vmscan_kswapd_wake/enable
+    chmod 0666 /sys/kernel/tracing/instances/mm_events/events/vmscan/mm_vmscan_kswapd_wake/enable
+    chmod 0666 /sys/kernel/debug/tracing/instances/mm_events/events/compaction/mm_compaction_begin/enable
+    chmod 0666 /sys/kernel/tracing/instances/mm_events/events/compaction/mm_compaction_begin/enable
+
+# Read and clear per-CPU raw kernel trace
+# Cannot use wildcards in .rc files. Update this if there is a phone with
+# more CPUs.
+    chmod 0666 /sys/kernel/debug/tracing/instances/mm_events/per_cpu/cpu0/trace
+    chmod 0666 /sys/kernel/tracing/instances/mm_events/per_cpu/cpu0/trace
+    chmod 0666 /sys/kernel/debug/tracing/instances/mm_events/per_cpu/cpu1/trace
+    chmod 0666 /sys/kernel/tracing/instances/mm_events/per_cpu/cpu1/trace
+    chmod 0666 /sys/kernel/debug/tracing/instances/mm_events/per_cpu/cpu2/trace
+    chmod 0666 /sys/kernel/tracing/instances/mm_events/per_cpu/cpu2/trace
+    chmod 0666 /sys/kernel/debug/tracing/instances/mm_events/per_cpu/cpu3/trace
+    chmod 0666 /sys/kernel/tracing/instances/mm_events/per_cpu/cpu3/trace
+    chmod 0666 /sys/kernel/debug/tracing/instances/mm_events/per_cpu/cpu4/trace
+    chmod 0666 /sys/kernel/tracing/instances/mm_events/per_cpu/cpu4/trace
+    chmod 0666 /sys/kernel/debug/tracing/instances/mm_events/per_cpu/cpu5/trace
+    chmod 0666 /sys/kernel/tracing/instances/mm_events/per_cpu/cpu5/trace
+    chmod 0666 /sys/kernel/debug/tracing/instances/mm_events/per_cpu/cpu6/trace
+    chmod 0666 /sys/kernel/tracing/instances/mm_events/per_cpu/cpu6/trace
+    chmod 0666 /sys/kernel/debug/tracing/instances/mm_events/per_cpu/cpu7/trace
+    chmod 0666 /sys/kernel/tracing/instances/mm_events/per_cpu/cpu7/trace
+    chmod 0666 /sys/kernel/debug/tracing/instances/mm_events/per_cpu/cpu8/trace
+    chmod 0666 /sys/kernel/tracing/instances/mm_events/per_cpu/cpu8/trace
+    chmod 0666 /sys/kernel/debug/tracing/instances/mm_events/per_cpu/cpu9/trace
+    chmod 0666 /sys/kernel/tracing/instances/mm_events/per_cpu/cpu9/trace
+    chmod 0666 /sys/kernel/debug/tracing/instances/mm_events/per_cpu/cpu10/trace
+    chmod 0666 /sys/kernel/tracing/instances/mm_events/per_cpu/cpu10/trace
+    chmod 0666 /sys/kernel/debug/tracing/instances/mm_events/per_cpu/cpu11/trace
+    chmod 0666 /sys/kernel/tracing/instances/mm_events/per_cpu/cpu11/trace
+    chmod 0666 /sys/kernel/debug/tracing/instances/mm_events/per_cpu/cpu12/trace
+    chmod 0666 /sys/kernel/tracing/instances/mm_events/per_cpu/cpu12/trace
+    chmod 0666 /sys/kernel/debug/tracing/instances/mm_events/per_cpu/cpu13/trace
+    chmod 0666 /sys/kernel/tracing/instances/mm_events/per_cpu/cpu13/trace
+    chmod 0666 /sys/kernel/debug/tracing/instances/mm_events/per_cpu/cpu14/trace
+    chmod 0666 /sys/kernel/tracing/instances/mm_events/per_cpu/cpu14/trace
+    chmod 0666 /sys/kernel/debug/tracing/instances/mm_events/per_cpu/cpu15/trace
+    chmod 0666 /sys/kernel/tracing/instances/mm_events/per_cpu/cpu15/trace
+    chmod 0666 /sys/kernel/debug/tracing/instances/mm_events/per_cpu/cpu16/trace
+    chmod 0666 /sys/kernel/tracing/instances/mm_events/per_cpu/cpu16/trace
+    chmod 0666 /sys/kernel/debug/tracing/instances/mm_events/per_cpu/cpu17/trace
+    chmod 0666 /sys/kernel/tracing/instances/mm_events/per_cpu/cpu17/trace
+    chmod 0666 /sys/kernel/debug/tracing/instances/mm_events/per_cpu/cpu18/trace
+    chmod 0666 /sys/kernel/tracing/instances/mm_events/per_cpu/cpu18/trace
+    chmod 0666 /sys/kernel/debug/tracing/instances/mm_events/per_cpu/cpu19/trace
+    chmod 0666 /sys/kernel/tracing/instances/mm_events/per_cpu/cpu19/trace
+    chmod 0666 /sys/kernel/debug/tracing/instances/mm_events/per_cpu/cpu20/trace
+    chmod 0666 /sys/kernel/tracing/instances/mm_events/per_cpu/cpu20/trace
+    chmod 0666 /sys/kernel/debug/tracing/instances/mm_events/per_cpu/cpu21/trace
+    chmod 0666 /sys/kernel/tracing/instances/mm_events/per_cpu/cpu21/trace
+    chmod 0666 /sys/kernel/debug/tracing/instances/mm_events/per_cpu/cpu22/trace
+    chmod 0666 /sys/kernel/tracing/instances/mm_events/per_cpu/cpu22/trace
+    chmod 0666 /sys/kernel/debug/tracing/instances/mm_events/per_cpu/cpu23/trace
+    chmod 0666 /sys/kernel/tracing/instances/mm_events/per_cpu/cpu23/trace
+
+on property:persist.debug.atrace.boottrace=1
+    start boottrace
+
+# Run atrace with the categories written in a file
+service boottrace /system/bin/atrace --async_start -f /data/misc/boottrace/categories
+    disabled
+    oneshot
diff --git a/core/rootdir/cells/system/atrace_userdebug.rc b/core/rootdir/cells/system/atrace_userdebug.rc
new file mode 100644
index 0000000..9186514
--- /dev/null
+++ b/core/rootdir/cells/system/atrace_userdebug.rc
@@ -0,0 +1,20 @@
+## Permissions to allow additional system-wide tracing to the kernel trace buffer.
+## The default list of permissions is set in frameworks/native/cmds/atrace/atrace.rc
+
+# Grant unix world read/write permissions to enable kernel tracepoints.
+# Access control to these files is now entirely in selinux policy.
+
+on post-fs
+    # On userdebug allow to enable any event via the generic
+    # set_event interface:
+    # echo sched/foo > set_event == echo 1 > events/sched/foo/enable.
+    chmod 0666 /sys/kernel/tracing/set_event
+    chmod 0666 /sys/kernel/debug/tracing/set_event
+
+    chmod 0666 /sys/kernel/tracing/events/workqueue/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/workqueue/enable
+    chmod 0666 /sys/kernel/tracing/events/regulator/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/regulator/enable
+    chmod 0666 /sys/kernel/tracing/events/filemap/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/filemap/enable
+
diff --git a/core/rootdir/cells/system/audioserver.rc b/core/rootdir/cells/system/audioserver.rc
new file mode 100644
index 0000000..c4a6601
--- /dev/null
+++ b/core/rootdir/cells/system/audioserver.rc
@@ -0,0 +1,63 @@
+service audioserver /system/bin/audioserver
+    class core
+    user audioserver
+    # media gid needed for /dev/fm (radio) and for /data/misc/media (tee)
+    group audio camera drmrpc media mediadrm net_bt net_bt_admin net_bw_acct wakelock
+    capabilities BLOCK_SUSPEND
+    ioprio rt 4
+    task_profiles ProcessCapacityHigh HighPerformance
+    onrestart restart vendor.audio-hal
+    onrestart restart vendor.audio-hal-4-0-msd
+    onrestart restart audio_proxy_service
+    # Keep the original service names for backward compatibility
+    onrestart restart vendor.audio-hal-2-0
+    onrestart restart audio-hal-2-0
+
+on property:vts.native_server.on=1
+    stop audioserver
+on property:vts.native_server.on=0
+    start audioserver
+
+on property:init.svc.audioserver=stopped
+    stop vendor.audio-hal
+    stop vendor.audio-hal-4-0-msd
+    stop audio_proxy_service
+    # Keep the original service names for backward compatibility
+    stop vendor.audio-hal-2-0
+    stop audio-hal-2-0
+    # See b/155364397. Need to have HAL service running for VTS.
+    # Can't use 'restart' because then HAL service would restart
+    # audioserver bringing it back into running state.
+    start vendor.audio-hal
+    start vendor.audio-hal-4-0-msd
+    start audio_proxy_service
+    # Keep the original service names for backward compatibility
+    start vendor.audio-hal-2-0
+    start audio-hal-2-0
+
+on property:init.svc.audioserver=running
+    start vendor.audio-hal
+    start vendor.audio-hal-4-0-msd
+    start audio_proxy_service
+    # Keep the original service names for backward compatibility
+    start vendor.audio-hal-2-0
+    start audio-hal-2-0
+
+on property:sys.audio.restart.hal=1
+    # See b/159966243. Avoid restart loop between audioserver and HAL.
+    # Keep the original service names for backward compatibility
+    stop vendor.audio-hal
+    stop vendor.audio-hal-4-0-msd
+    stop audio_proxy_service
+    stop vendor.audio-hal-2-0
+    stop audio-hal-2-0
+    start vendor.audio-hal
+    start vendor.audio-hal-4-0-msd
+    start audio_proxy_service
+    start vendor.audio-hal-2-0
+    start audio-hal-2-0
+    # reset the property
+    setprop sys.audio.restart.hal 0
+
+on init
+    mkdir /dev/socket/audioserver 0775 audioserver audioserver
diff --git a/core/rootdir/cells/system/blank_screen.rc b/core/rootdir/cells/system/blank_screen.rc
new file mode 100644
index 0000000..7b2a55e
--- /dev/null
+++ b/core/rootdir/cells/system/blank_screen.rc
@@ -0,0 +1,5 @@
+service blank_screen /system/bin/blank_screen
+    user system
+    oneshot
+    group system
+    shutdown critical
diff --git a/core/rootdir/cells/system/bootanim.rc b/core/rootdir/cells/system/bootanim.rc
new file mode 100644
index 0000000..ad4de0a
--- /dev/null
+++ b/core/rootdir/cells/system/bootanim.rc
@@ -0,0 +1,8 @@
+service bootanim /system/bin/bootanimation
+    class core animation
+    user graphics
+    group graphics audio
+    disabled
+    oneshot
+    ioprio rt 0
+    task_profiles MaxPerformance
diff --git a/core/rootdir/cells/system/bootstat-debug.rc b/core/rootdir/cells/system/bootstat-debug.rc
new file mode 100644
index 0000000..6a00440
--- /dev/null
+++ b/core/rootdir/cells/system/bootstat-debug.rc
@@ -0,0 +1,7 @@
+# This file is the userdebug LOCAL_INIT_RC file for the bootstat command.
+
+# FOR TESTING
+# For devices w/o bootloader boot reason reported, mirror test boot reason
+# to bootloader boot reason to allow test to inject reasons
+on property:persist.test.boot.reason=*
+    setprop ro.boot.bootreason ${persist.test.boot.reason}
diff --git a/core/rootdir/cells/system/bootstat.rc b/core/rootdir/cells/system/bootstat.rc
new file mode 100644
index 0000000..a350fe7
--- /dev/null
+++ b/core/rootdir/cells/system/bootstat.rc
@@ -0,0 +1,83 @@
+# This file is the LOCAL_INIT_RC file for the bootstat command.
+
+# Mirror bootloader boot reason to system boot reason
+# ro.boot.bootreason should be set by init already
+# before post-fs trigger
+on post-fs && property:ro.boot.bootreason=*
+    setprop sys.boot.reason ${ro.boot.bootreason}
+
+on post-fs-data
+    mkdir /data/misc/bootstat 0700 system log
+    # To deal with ota transition resulting from a change in DAC from
+    # root.root to system.log, may be deleted after ota has settled.
+    chown system log /data/misc/bootstat/absolute_boot_time
+    chown system log /data/misc/bootstat/boot_complete
+    chown system log /data/misc/bootstat/boot_complete_no_encryption
+    chown system log /data/misc/bootstat/boot_reason
+    chown system log /data/misc/bootstat/boottime.bootloader.1BLE
+    chown system log /data/misc/bootstat/boottime.bootloader.1BLL
+    chown system log /data/misc/bootstat/boottime.bootloader.2BLE
+    chown system log /data/misc/bootstat/boottime.bootloader.2BLL
+    chown system log /data/misc/bootstat/boottime.bootloader.AVB
+    chown system log /data/misc/bootstat/boottime.bootloader.KD
+    chown system log /data/misc/bootstat/boottime.bootloader.KL
+    chown system log /data/misc/bootstat/boottime.bootloader.ODT
+    chown system log /data/misc/bootstat/boottime.bootloader.SW
+    chown system log /data/misc/bootstat/boottime.bootloader.total
+    chown system log /data/misc/bootstat/build_date
+    chown system log /data/misc/bootstat/factory_reset
+    chown system log /data/misc/bootstat/factory_reset_boot_complete
+    chown system log /data/misc/bootstat/factory_reset_boot_complete_no_encryption
+    chown system log /data/misc/bootstat/factory_reset_current_time
+    chown system log /data/misc/bootstat/factory_reset_record_value
+    chown system log /data/misc/bootstat/last_boot_time_utc
+    chown system log /data/misc/bootstat/ota_boot_complete
+    chown system log /data/misc/bootstat/ota_boot_complete_no_encryption
+    chown system log /data/misc/bootstat/post_decrypt_time_elapsed
+    chown system log /data/misc/bootstat/ro.boottime.init
+    chown system log /data/misc/bootstat/ro.boottime.init.cold_boot_wait
+    chown system log /data/misc/bootstat/ro.boottime.init.selinux
+    chown system log /data/misc/bootstat/time_since_factory_reset
+    chown system log /data/misc/bootstat/time_since_last_boot
+    # end ota transitional support
+
+# Record the time at which the user has successfully entered the pin to decrypt
+# the device, /data is decrypted, and the system is entering the main boot phase.
+#
+# post-fs-data: /data is writable
+# property:init.svc.bootanim=running: The boot animation is running
+# property:ro.crypto.type=block: FDE device
+on post-fs-data && property:init.svc.bootanim=running && property:ro.crypto.type=block
+    exec_background - system log -- /system/bin/bootstat -r post_decrypt_time_elapsed
+
+# Initialize bootstat state machine.
+#
+# sys.bootstat.first_boot_completed: responsible for making sure that record_boot_complete happens
+# only once per device hard reboot. Possible values:
+#
+#   sys.bootstat.first_boot_completed=0 - first boot completed trigger wasn't processed yet.
+#   sys.bootstat.first_boot_completed=1 - first boot completed trigger was processed and
+#                                         record_boot_complete was called. Subsequent boot completed
+#                                         triggers (e.g. due to userspace reboot) won't retrigger
+#                                         record_boot_complete
+#
+# IMPORTANT, ro.persistent_properties.ready=1 trigger is used here to ensure that we initialize
+# state machine only once, which as result ensures that bootstat --set_system_boot_reason and
+# bootstat --record_boot_complete will be called only once per full reboot.
+on property:ro.persistent_properties.ready=true
+  setprop sys.bootstat.first_boot_completed 0
+
+# Set boot reason
+on property:ro.persistent_properties.ready=true
+    # Converts bootloader boot reason and persist.sys.boot.reason to system boot reason
+    # Need go after persist peroperties are loaded which is right before zygote-start trigger
+    exec_background - system log -- /system/bin/bootstat --set_system_boot_reason
+
+# Record boot complete metrics.
+on property:sys.boot_completed=1 && property:sys.bootstat.first_boot_completed=0
+    # Record boot_complete and related stats (decryption, etc).
+    # Record the boot reason.
+    # Record time since factory reset.
+    # Log all boot events.
+    exec_background - system log -- /system/bin/bootstat --record_boot_complete --record_boot_reason --record_time_since_factory_reset -l
+    setprop sys.bootstat.first_boot_completed 1
diff --git a/core/rootdir/cells/system/bpfloader.rc b/core/rootdir/cells/system/bpfloader.rc
new file mode 100644
index 0000000..3c56c43
--- /dev/null
+++ b/core/rootdir/cells/system/bpfloader.rc
@@ -0,0 +1,59 @@
+# zygote-start is what officially starts netd (see //system/core/rootdir/init.rc)
+# However, on some hardware it's started from post-fs-data as well, which is just
+# a tad earlier.  There's no benefit to that though, since on 4.9+ P+ devices netd
+# will just block until bpfloader finishes and sets the bpf.progs_loaded property.
+#
+# It is important that we start bpfloader after:
+#   - /sys/fs/bpf is already mounted,
+#   - apex (incl. rollback) is initialized (so that in the future we can load bpf
+#     programs shipped as part of apex mainline modules)
+#   - logd is ready for us to log stuff
+#
+# At the same time we want to be as early as possible to reduce races and thus
+# failures (before memory is fragmented, and cpu is busy running tons of other
+# stuff) and we absolutely want to be before netd and the system boot slot is
+# considered to have booted successfully.
+#
+on load_bpf_programs
+    # Enable the eBPF JIT -- but do note that on 64-bit kernels it is likely
+    # already force enabled by the kernel config option BPF_JIT_ALWAYS_ON
+    write /proc/sys/net/core/bpf_jit_enable 1
+    # Enable JIT kallsyms export for privileged users only
+    write /proc/sys/net/core/bpf_jit_kallsyms 1
+    exec_start bpfloader
+
+service bpfloader /system/bin/bpfloader
+    capabilities CHOWN SYS_ADMIN NET_ADMIN
+    #
+    # Set RLIMIT_MEMLOCK to 1GiB for bpfloader
+    #
+    # Actually only 8MiB would be needed if bpfloader ran as its own uid.
+    #
+    # However, while the rlimit is per-thread, the accounting is system wide.
+    # So, for example, if the graphics stack has already allocated 10MiB of
+    # memlock data before bpfloader even gets a chance to run, it would fail
+    # if its memlock rlimit is only 8MiB - since there would be none left for it.
+    #
+    # bpfloader succeeding is critical to system health, since a failure will
+    # cause netd crashloop and thus system server crashloop... and the only
+    # recovery is a full kernel reboot.
+    #
+    # We've had issues where devices would sometimes (rarely) boot into
+    # a crashloop because bpfloader would occasionally lose a boot time
+    # race against the graphics stack's boot time locked memory allocation.
+    #
+    # Thus bpfloader's memlock has to be 8MB higher then the locked memory
+    # consumption of the root uid anywhere else in the system...
+    # But we don't know what that is for all possible devices...
+    #
+    # Ideally, we'd simply grant bpfloader the IPC_LOCK capability and it
+    # would simply ignore it's memlock rlimit... but it turns that this
+    # capability is not even checked by the kernel's bpf system call.
+    #
+    # As such we simply use 1GiB as a reasonable approximation of infinity.
+    #
+    rlimit memlock 1073741824 1073741824
+    oneshot
+    reboot_on_failure reboot,bpfloader-failed
+    # we're not really updatable, but want to be able to load bpf programs shipped in apexes
+    updatable
diff --git a/core/rootdir/cells/system/cameraserver.rc b/core/rootdir/cells/system/cameraserver.rc
new file mode 100644
index 0000000..8f51458
--- /dev/null
+++ b/core/rootdir/cells/system/cameraserver.rc
@@ -0,0 +1,7 @@
+service cameraserver /system/bin/cameraserver
+    class main
+    user cameraserver
+    group audio camera input drmrpc
+    ioprio rt 4
+    task_profiles CameraServiceCapacity MaxPerformance
+    rlimit rtprio 10 10
diff --git a/core/rootdir/cells/system/clean_scratch_files.rc b/core/rootdir/cells/system/clean_scratch_files.rc
new file mode 100644
index 0000000..25a7e69
--- /dev/null
+++ b/core/rootdir/cells/system/clean_scratch_files.rc
@@ -0,0 +1,2 @@
+on post-fs-data && property:ro.debuggable=1
+    exec_background - root root -- /system/bin/clean_scratch_files
diff --git a/core/rootdir/cells/system/cppreopts.rc b/core/rootdir/cells/system/cppreopts.rc
new file mode 100644
index 0000000..cfe48e7
--- /dev/null
+++ b/core/rootdir/cells/system/cppreopts.rc
@@ -0,0 +1,40 @@
+# Copyright 2016 The Android Open Source Project
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#      http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+
+service cppreopts /system/bin/cppreopts.sh /postinstall
+    oneshot
+    disabled
+    user root
+    priority -20
+    ioprio rt 0
+    writepid /dev/cpuset/foreground/tasks
+    capabilities
+
+# Post install is above Treble VINTF, because it runs some utilities from
+# /system. Therefore, the fstab can only be in either /system or /product.
+on property:sys.cppreopt=requested && property:ro.postinstall.fstab.prefix=/system
+    mount_all /cells/fstab.postinstall
+    exec_start cppreopts
+    # Optional script to copy additional preloaded content to data directory
+    exec - system system -- /system/bin/preloads_copy.sh /postinstall
+    umount_all /cells/fstab.postinstall
+    setprop sys.cppreopt finished
+
+on property:sys.cppreopt=requested && property:ro.postinstall.fstab.prefix=/product
+    mount_all /cells/fstab.ppostinstall
+    exec_start cppreopts
+    # Optional script to copy additional preloaded content to data directory
+    exec - system system -- /system/bin/preloads_copy.sh /postinstall
+    umount_all /cells/fstab.ppostinstall
+    setprop sys.cppreopt finished
diff --git a/core/rootdir/cells/system/credstore.rc b/core/rootdir/cells/system/credstore.rc
new file mode 100644
index 0000000..d9e989a
--- /dev/null
+++ b/core/rootdir/cells/system/credstore.rc
@@ -0,0 +1,4 @@
+service credstore /system/bin/credstore /data/misc/credstore
+    class core
+    user credstore
+    group credstore
diff --git a/core/rootdir/cells/system/drmserver.rc b/core/rootdir/cells/system/drmserver.rc
new file mode 100644
index 0000000..eb176c1
--- /dev/null
+++ b/core/rootdir/cells/system/drmserver.rc
@@ -0,0 +1,12 @@
+service drm /system/bin/drmserver
+    disabled
+    class main
+    user drm
+    group drm system inet drmrpc readproc
+    writepid /dev/cpuset/foreground/tasks
+
+on property:drm.service.enabled=true
+    start drm
+
+on property:drm.service.enabled=1
+    start drm
diff --git a/core/rootdir/cells/system/dumpstate.rc b/core/rootdir/cells/system/dumpstate.rc
new file mode 100644
index 0000000..a80da4e
--- /dev/null
+++ b/core/rootdir/cells/system/dumpstate.rc
@@ -0,0 +1,24 @@
+on boot
+    # Allow bugreports access to eMMC 5.0 stats
+    chown root mount /sys/kernel/debug/mmc0/mmc0:0001/ext_csd
+    chmod 0440 /sys/kernel/debug/mmc0/mmc0:0001/ext_csd
+
+service dumpstate /system/bin/dumpstate -s
+    class main
+    socket dumpstate stream 0660 shell log
+    disabled
+    oneshot
+
+# dumpstatez generates a zipped bugreport but also uses a socket to print the file location once
+# it is finished.
+service dumpstatez /system/bin/dumpstate -S
+    socket dumpstate stream 0660 shell log
+    class main
+    disabled
+    oneshot
+
+# bugreportd starts dumpstate binder service and makes it wait for a listener to connect.
+service bugreportd /system/bin/dumpstate -w
+    class main
+    disabled
+    oneshot
diff --git a/core/rootdir/cells/system/flags_health_check.rc b/core/rootdir/cells/system/flags_health_check.rc
new file mode 100644
index 0000000..0bede55
--- /dev/null
+++ b/core/rootdir/cells/system/flags_health_check.rc
@@ -0,0 +1,11 @@
+on load_persist_props_action
+    # check server configurable flags(which is based on persistent properties) related
+    # disaster recovery
+    mkdir /data/server_configurable_flags 0775 system system
+    exec - system system -- /system/bin/flags_health_check BOOT_FAILURE
+
+on property:sys.boot_completed=1
+    setprop persist.device_config.attempted_boot_count 0
+
+on property:sys.init.updatable_crashing=1
+    exec - system system -- /system/bin/flags_health_check UPDATABLE_CRASHING
diff --git a/core/rootdir/cells/system/gatekeeperd.rc b/core/rootdir/cells/system/gatekeeperd.rc
new file mode 100644
index 0000000..8b126d5
--- /dev/null
+++ b/core/rootdir/cells/system/gatekeeperd.rc
@@ -0,0 +1,4 @@
+service gatekeeperd /system/bin/gatekeeperd /data/misc/gatekeeper
+    class late_start
+    user system
+    writepid /dev/cpuset/system-background/tasks
diff --git a/core/rootdir/cells/system/gpuservice.rc b/core/rootdir/cells/system/gpuservice.rc
new file mode 100644
index 0000000..0da8bd3
--- /dev/null
+++ b/core/rootdir/cells/system/gpuservice.rc
@@ -0,0 +1,4 @@
+service gpu /system/bin/gpuservice
+    class core
+    user gpu_service
+    group graphics readtracefs
diff --git a/core/rootdir/cells/system/gsid.rc b/core/rootdir/cells/system/gsid.rc
new file mode 100644
index 0000000..2c1a10b
--- /dev/null
+++ b/core/rootdir/cells/system/gsid.rc
@@ -0,0 +1,26 @@
+service gsid /system/bin/gsid
+    interface aidl gsiservice
+    oneshot
+    disabled
+    user root
+    group root system media_rw
+
+on post-fs
+    mkdir /metadata/gsi 0771 root system
+    mkdir /metadata/gsi/dsu 0771 root system
+    mkdir /metadata/gsi/ota 0771 root system
+    mkdir /metadata/gsi/remount 0771 root system
+    chmod 0664 /metadata/gsi/dsu/active
+    chmod 0664 /metadata/gsi/dsu/booted
+    chmod 0664 /metadata/gsi/dsu/lp_names
+
+on post-fs-data
+    write /data/gsi_persistent_data 0
+    chown system system /data/gsi_persistent_data
+    mkdir /data/gsi 0700 root root encryption=None
+    mkdir /data/gsi/dsu 0700 root root
+    mkdir /data/gsi/ota 0700 root root
+    mkdir /data/gsi/remount 0700 root root
+
+on boot
+    exec_background - root root -- /system/bin/gsid run-startup-tasks
diff --git a/core/rootdir/cells/system/heapprofd.rc b/core/rootdir/cells/system/heapprofd.rc
new file mode 100644
index 0000000..bf313b1
--- /dev/null
+++ b/core/rootdir/cells/system/heapprofd.rc
@@ -0,0 +1,53 @@
+# Copyright (C) 2018 The Android Open Source Project
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#      http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+service heapprofd /system/bin/heapprofd
+    class late_start
+    disabled
+    socket heapprofd stream 0666 root root
+    user nobody
+    group nobody readproc
+    # By default, this  daemon is idle. When profiling an app, we should unwind
+    # as fast as possible in the interest of the app being profiled.
+    writepid /dev/cpuset/foreground/tasks
+    onrestart exec_background - nobody shell -- /system/bin/heapprofd --cleanup-after-crash
+    # DAC_READ_SEARCH is denied by SELinux on user builds because the SELinux
+    # permission is userdebug_or_eng only.
+    capabilities KILL DAC_READ_SEARCH
+
+# Allow to start a second heapprofd. We can use that one to profile the
+# primary one. See src/memory/profiling/README.md.
+service heapprofd_secondary /system/bin/heapprofd
+    disabled
+    oneshot
+    socket heapprofd stream 0666 root root
+    user nobody
+    group nobody readproc
+    # By default, this  daemon is idle. When profiling an app, we should unwind
+    # as fast as possible in the interest of the app being profiled.
+    writepid /dev/cpuset/foreground/tasks
+    # DAC_READ_SEARCH is denied by SELinux on user builds because the SELinux
+    # permission is userdebug_or_eng only.
+    capabilities KILL DAC_READ_SEARCH
+
+on property:persist.heapprofd.enable=1
+    start heapprofd
+
+on property:traced.lazy.heapprofd=1
+    start heapprofd
+
+on property:persist.heapprofd.enable="" && property:traced.lazy.heapprofd=""
+    stop heapprofd
+
+on property:persist.heapprofd.enable=0
+    setprop persist.heapprofd.enable ""
diff --git a/core/rootdir/cells/system/hw/init.environ.rc b/core/rootdir/cells/system/hw/init.environ.rc
new file mode 100644
index 0000000..9496d58
--- /dev/null
+++ b/core/rootdir/cells/system/hw/init.environ.rc
@@ -0,0 +1,16 @@
+# set up the global environment
+on early-init
+    export ANDROID_BOOTLOGO 1
+    export ANDROID_ROOT /system
+    export ANDROID_ASSETS /system/app
+    export ANDROID_DATA /data
+    export ANDROID_STORAGE /storage
+    export ANDROID_ART_ROOT /apex/com.android.art
+    export ANDROID_I18N_ROOT /apex/com.android.i18n
+    export ANDROID_TZDATA_ROOT /apex/com.android.tzdata
+    export EXTERNAL_STORAGE /sdcard
+    export ASEC_MOUNTPOINT /mnt/asec
+    
+    
+    
+    
diff --git a/core/rootdir/cells/system/hw/init.rc b/core/rootdir/cells/system/hw/init.rc
new file mode 100644
index 0000000..b5efe44
--- /dev/null
+++ b/core/rootdir/cells/system/hw/init.rc
@@ -0,0 +1,1289 @@
+# Copyright (C) 2012 The Android Open Source Project
+#
+# IMPORTANT: Do not create world writable files or directories.
+# This is a common source of Android security bugs.
+#
+
+import /cells/system/hw/init.environ.rc
+import /cells/system/hw/init.usb.rc
+# import /init.${ro.hardware}.rc
+import /cells/vendor/hw/init.${ro.hardware}.rc
+import /cells/system/hw/init.usb.configfs.rc
+import /cells/system/hw/init.${ro.zygote}.rc
+
+# Cgroups are mounted right before early-init using list from /etc/cgroups.json
+on early-init
+    # Disable sysrq from keyboard
+    write /proc/sys/kernel/sysrq 0
+
+    # Android doesn't need kernel module autoloading, and it causes SELinux
+    # denials.  So disable it by setting modprobe to the empty string.  Note: to
+    # explicitly set a sysctl to an empty string, a trailing newline is needed.
+    write /proc/sys/kernel/modprobe \n
+
+    # Set the security context of /adb_keys if present.
+    restorecon /adb_keys
+
+    # Set the security context of /postinstall if present.
+    restorecon /postinstall
+
+    mkdir /acct/uid
+
+    # memory.pressure_level used by lmkd
+    chown root system /dev/memcg/memory.pressure_level
+    chmod 0040 /dev/memcg/memory.pressure_level
+    # app mem cgroups, used by activity manager, lmkd and zygote
+    mkdir /dev/memcg/apps/ 0755 system system
+    # cgroup for system_server and surfaceflinger
+    mkdir /dev/memcg/system 0550 system system
+
+    # symlink the Android specific /dev/tun to Linux expected /dev/net/tun
+    mkdir /dev/net 0755 root root
+    symlink ../tun /dev/net/tun
+
+    # set RLIMIT_NICE to allow priorities from 19 to -20
+    setrlimit nice 40 40
+
+    # Allow up to 32K FDs per process
+    setrlimit nofile 32768 32768
+
+    # Set up linker config subdirectories based on mount namespaces
+    mkdir /linkerconfig/bootstrap 0755
+    mkdir /linkerconfig/default 0755
+
+    # Disable dm-verity hash prefetching, since it doesn't help performance
+    # Read more in b/136247322
+    write /sys/module/dm_verity/parameters/prefetch_cluster 0
+
+    # Generate ld.config.txt for early executed processes
+    exec -- /system/bin/bootstrap/linkerconfig --target /linkerconfig/bootstrap
+    chmod 644 /linkerconfig/bootstrap/ld.config.txt
+    copy /linkerconfig/bootstrap/ld.config.txt /linkerconfig/default/ld.config.txt
+    chmod 644 /linkerconfig/default/ld.config.txt
+
+    # Mount bootstrap linker configuration as current
+    mount none /linkerconfig/bootstrap /linkerconfig bind rec
+
+    start ueventd
+
+    setprop ro.boot.vm 1
+    setprop persist.sys.exit 0
+    setprop persist.logd.logpersistd logcatd
+    # setprop system_init.startsensorservice 0
+    setprop persist.sys.sdcardfs force_off
+    setprop external_storage.sdcardfs.enabled 0
+
+    # Run apexd-bootstrap so that APEXes that provide critical libraries
+    # become available. Note that this is executed as exec_start to ensure that
+    # the libraries are available to the processes started after this statement.
+    exec_start apexd-bootstrap
+
+    # Generate linker config based on apex mounted in bootstrap namespace
+    update_linker_config
+
+    # These must already exist by the time boringssl_self_test32 / boringssl_self_test64 run.
+    mkdir /dev/boringssl 0755 root root
+    mkdir /dev/boringssl/selftest 0755 root root
+
+    # Mount tracefs (with GID=AID_READTRACEFS)
+    mount tracefs tracefs /sys/kernel/tracing gid=3012
+
+    # create sys dirctory
+    mkdir /dev/sys 0755 system system
+    mkdir /dev/sys/fs 0755 system system
+    mkdir /dev/sys/block 0755 system system
+
+# Run boringssl self test for each ABI so that later processes can skip it. http://b/139348610
+on early-init && property:ro.product.cpu.abilist32=*
+    exec_start boringssl_self_test32
+on early-init && property:ro.product.cpu.abilist64=*
+    exec_start boringssl_self_test64
+on property:apexd.status=ready && property:ro.product.cpu.abilist32=*
+    exec_start boringssl_self_test_apex32
+on property:apexd.status=ready && property:ro.product.cpu.abilist64=*
+    exec_start boringssl_self_test_apex64
+
+service boringssl_self_test32 /system/bin/boringssl_self_test32
+    setenv BORINGSSL_SELF_TEST_CREATE_FLAG true # Any nonempty value counts as true
+    reboot_on_failure reboot,boringssl-self-check-failed
+    stdio_to_kmsg
+
+service boringssl_self_test64 /system/bin/boringssl_self_test64
+    setenv BORINGSSL_SELF_TEST_CREATE_FLAG true # Any nonempty value counts as true
+    reboot_on_failure reboot,boringssl-self-check-failed
+    stdio_to_kmsg
+
+service boringssl_self_test_apex32 /apex/com.android.conscrypt/bin/boringssl_self_test32
+    setenv BORINGSSL_SELF_TEST_CREATE_FLAG true # Any nonempty value counts as true
+    reboot_on_failure reboot,boringssl-self-check-failed
+    stdio_to_kmsg
+
+service boringssl_self_test_apex64 /apex/com.android.conscrypt/bin/boringssl_self_test64
+    setenv BORINGSSL_SELF_TEST_CREATE_FLAG true # Any nonempty value counts as true
+    reboot_on_failure reboot,boringssl-self-check-failed
+    stdio_to_kmsg
+
+on init
+    sysclktz 0
+
+    # Mix device-specific information into the entropy pool
+    copy /proc/cmdline /dev/urandom
+    copy /system/etc/prop.default /dev/urandom
+
+    symlink /proc/self/fd/0 /dev/stdin
+    symlink /proc/self/fd/1 /dev/stdout
+    symlink /proc/self/fd/2 /dev/stderr
+
+    # Create energy-aware scheduler tuning nodes
+    mkdir /dev/stune/foreground
+    mkdir /dev/stune/background
+    mkdir /dev/stune/top-app
+    mkdir /dev/stune/rt
+    chown system system /dev/stune
+    chown system system /dev/stune/foreground
+    chown system system /dev/stune/background
+    chown system system /dev/stune/top-app
+    chown system system /dev/stune/rt
+    chown system system /dev/stune/tasks
+    chown system system /dev/stune/foreground/tasks
+    chown system system /dev/stune/background/tasks
+    chown system system /dev/stune/top-app/tasks
+    chown system system /dev/stune/rt/tasks
+    chmod 0664 /dev/stune/tasks
+    chmod 0664 /dev/stune/foreground/tasks
+    chmod 0664 /dev/stune/background/tasks
+    chmod 0664 /dev/stune/top-app/tasks
+    chmod 0664 /dev/stune/rt/tasks
+
+    # cpuctl hierarchy for devices using utilclamp
+    mkdir /dev/cpuctl/foreground
+    mkdir /dev/cpuctl/background
+    mkdir /dev/cpuctl/top-app
+    mkdir /dev/cpuctl/rt
+    mkdir /dev/cpuctl/system
+    mkdir /dev/cpuctl/system-background
+    mkdir /dev/cpuctl/dex2oat
+    chown system system /dev/cpuctl
+    chown system system /dev/cpuctl/foreground
+    chown system system /dev/cpuctl/background
+    chown system system /dev/cpuctl/top-app
+    chown system system /dev/cpuctl/rt
+    chown system system /dev/cpuctl/system
+    chown system system /dev/cpuctl/system-background
+    chown system system /dev/cpuctl/dex2oat
+    chown system system /dev/cpuctl/tasks
+    chown system system /dev/cpuctl/foreground/tasks
+    chown system system /dev/cpuctl/background/tasks
+    chown system system /dev/cpuctl/top-app/tasks
+    chown system system /dev/cpuctl/rt/tasks
+    chown system system /dev/cpuctl/system/tasks
+    chown system system /dev/cpuctl/system-background/tasks
+    chown system system /dev/cpuctl/dex2oat/tasks
+    chmod 0664 /dev/cpuctl/tasks
+    chmod 0664 /dev/cpuctl/foreground/tasks
+    chmod 0664 /dev/cpuctl/background/tasks
+    chmod 0664 /dev/cpuctl/top-app/tasks
+    chmod 0664 /dev/cpuctl/rt/tasks
+    chmod 0664 /dev/cpuctl/system/tasks
+    chmod 0664 /dev/cpuctl/system-background/tasks
+    chmod 0664 /dev/cpuctl/dex2oat/tasks
+
+    # Create a cpu group for NNAPI HAL processes
+    mkdir /dev/cpuctl/nnapi-hal
+    chown system system /dev/cpuctl/nnapi-hal
+    chown system system /dev/cpuctl/nnapi-hal/tasks
+    chmod 0664 /dev/cpuctl/nnapi-hal/tasks
+    write /dev/cpuctl/nnapi-hal/cpu.uclamp.min 1
+    write /dev/cpuctl/nnapi-hal/cpu.uclamp.latency_sensitive 1
+
+    # Create a cpu group for camera daemon processes
+    mkdir /dev/cpuctl/camera-daemon
+    chown system system /dev/cpuctl/camera-daemon
+    chown system system /dev/cpuctl/camera-daemon/tasks
+    chmod 0664 /dev/cpuctl/camera-daemon/tasks
+
+    # Create an stune group for camera-specific processes
+    mkdir /dev/stune/camera-daemon
+    chown system system /dev/stune/camera-daemon
+    chown system system /dev/stune/camera-daemon/tasks
+    chmod 0664 /dev/stune/camera-daemon/tasks
+
+    # Create an stune group for NNAPI HAL processes
+    mkdir /dev/stune/nnapi-hal
+    chown system system /dev/stune/nnapi-hal
+    chown system system /dev/stune/nnapi-hal/tasks
+    chmod 0664 /dev/stune/nnapi-hal/tasks
+    write /dev/stune/nnapi-hal/schedtune.boost 1
+    write /dev/stune/nnapi-hal/schedtune.prefer_idle 1
+
+    # Create blkio group and apply initial settings.
+    # This feature needs kernel to support it, and the
+    # device's init.rc must actually set the correct values.
+    mkdir /dev/blkio/background
+    chown system system /dev/blkio
+    chown system system /dev/blkio/background
+    chown system system /dev/blkio/tasks
+    chown system system /dev/blkio/background/tasks
+    chmod 0664 /dev/blkio/tasks
+    chmod 0664 /dev/blkio/background/tasks
+    write /dev/blkio/blkio.weight 1000
+    write /dev/blkio/background/blkio.weight 200
+    write /dev/blkio/background/blkio.bfq.weight 10
+    write /dev/blkio/blkio.group_idle 0
+    write /dev/blkio/background/blkio.group_idle 0
+
+    restorecon_recursive /mnt
+
+    mount configfs none /config nodev noexec nosuid
+    chmod 0770 /config/sdcardfs
+    chown system package_info /config/sdcardfs
+
+    # Mount binderfs
+    mkdir /dev/binderfs
+    mount binder binder /dev/binderfs stats=global
+    chmod 0755 /dev/binderfs
+
+    # Mount fusectl
+    mount fusectl none /sys/fs/fuse/connections
+
+    symlink /dev/binderfs/binder /dev/binder
+    symlink /dev/binderfs/hwbinder /dev/hwbinder
+    symlink /dev/binderfs/vndbinder /dev/vndbinder
+
+    chmod 0666 /dev/binderfs/hwbinder
+    chmod 0666 /dev/binderfs/binder
+    chmod 0666 /dev/binderfs/vndbinder
+
+    mkdir /mnt/secure 0700 root root
+    mkdir /mnt/secure/asec 0700 root root
+    mkdir /mnt/asec 0755 root system
+    mkdir /mnt/obb 0755 root system
+    mkdir /mnt/media_rw 0750 root external_storage
+    mkdir /mnt/user 0755 root root
+    mkdir /mnt/user/0 0755 root root
+    mkdir /mnt/user/0/self 0755 root root
+    mkdir /mnt/user/0/emulated 0755 root root
+    mkdir /mnt/user/0/emulated/0 0755 root root
+
+    # Prepare directories for pass through processes
+    mkdir /mnt/pass_through 0700 root root
+    mkdir /mnt/pass_through/0 0710 root media_rw
+    mkdir /mnt/pass_through/0/self 0710 root media_rw
+    mkdir /mnt/pass_through/0/emulated 0710 root media_rw
+    mkdir /mnt/pass_through/0/emulated/0 0710 root media_rw
+
+    mkdir /mnt/expand 0771 system system
+    mkdir /mnt/appfuse 0711 root root
+
+    # Storage views to support runtime permissions
+    mkdir /mnt/runtime 0700 root root
+    mkdir /mnt/runtime/default 0755 root root
+    mkdir /mnt/runtime/default/self 0755 root root
+    mkdir /mnt/runtime/read 0755 root root
+    mkdir /mnt/runtime/read/self 0755 root root
+    mkdir /mnt/runtime/write 0755 root root
+    mkdir /mnt/runtime/write/self 0755 root root
+    mkdir /mnt/runtime/full 0755 root root
+    mkdir /mnt/runtime/full/self 0755 root root
+
+    # Symlink to keep legacy apps working in multi-user world
+    symlink /storage/self/primary /mnt/sdcard
+    symlink /mnt/user/0/primary /mnt/runtime/default/self/primary
+
+    write /proc/sys/kernel/panic_on_oops 1
+    write /proc/sys/kernel/hung_task_timeout_secs 0
+    write /proc/cpu/alignment 4
+
+    # scheduler tunables
+    # Disable auto-scaling of scheduler tunables with hotplug. The tunables
+    # will vary across devices in unpredictable ways if allowed to scale with
+    # cpu cores.
+    write /proc/sys/kernel/sched_tunable_scaling 0
+    write /proc/sys/kernel/sched_latency_ns 10000000
+    write /proc/sys/kernel/sched_wakeup_granularity_ns 2000000
+    write /proc/sys/kernel/sched_child_runs_first 0
+
+    write /proc/sys/kernel/randomize_va_space 2
+    write /proc/sys/vm/mmap_min_addr 32768
+    write /proc/sys/net/ipv4/ping_group_range "0 2147483647"
+    write /proc/sys/net/unix/max_dgram_qlen 600
+
+    # Assign reasonable ceiling values for socket rcv/snd buffers.
+    # These should almost always be overridden by the target per the
+    # the corresponding technology maximums.
+    write /proc/sys/net/core/rmem_max  262144
+    write /proc/sys/net/core/wmem_max  262144
+
+    # reflect fwmark from incoming packets onto generated replies
+    write /proc/sys/net/ipv4/fwmark_reflect 1
+    write /proc/sys/net/ipv6/fwmark_reflect 1
+
+    # set fwmark on accepted sockets
+    write /proc/sys/net/ipv4/tcp_fwmark_accept 1
+
+    # disable icmp redirects
+    write /proc/sys/net/ipv4/conf/all/accept_redirects 0
+    write /proc/sys/net/ipv6/conf/all/accept_redirects 0
+
+    # /proc/net/fib_trie leaks interface IP addresses
+    chmod 0400 /proc/net/fib_trie
+
+    # sets up initial cpusets for ActivityManager
+    # this ensures that the cpusets are present and usable, but the device's
+    # init.rc must actually set the correct cpus
+    mkdir /dev/cpuset/foreground
+    copy /dev/cpuset/cpus /dev/cpuset/foreground/cpus
+    copy /dev/cpuset/mems /dev/cpuset/foreground/mems
+    mkdir /dev/cpuset/background
+    copy /dev/cpuset/cpus /dev/cpuset/background/cpus
+    copy /dev/cpuset/mems /dev/cpuset/background/mems
+
+    # system-background is for system tasks that should only run on
+    # little cores, not on bigs
+    mkdir /dev/cpuset/system-background
+    copy /dev/cpuset/cpus /dev/cpuset/system-background/cpus
+    copy /dev/cpuset/mems /dev/cpuset/system-background/mems
+
+    # restricted is for system tasks that are being throttled
+    # due to screen off.
+    mkdir /dev/cpuset/restricted
+    copy /dev/cpuset/cpus /dev/cpuset/restricted/cpus
+    copy /dev/cpuset/mems /dev/cpuset/restricted/mems
+
+    mkdir /dev/cpuset/top-app
+    copy /dev/cpuset/cpus /dev/cpuset/top-app/cpus
+    copy /dev/cpuset/mems /dev/cpuset/top-app/mems
+
+    # create a cpuset for camera daemon processes
+    mkdir /dev/cpuset/camera-daemon
+    copy /dev/cpuset/cpus /dev/cpuset/camera-daemon/cpus
+    copy /dev/cpuset/mems /dev/cpuset/camera-daemon/mems
+
+    # change permissions for all cpusets we'll touch at runtime
+    chown system system /dev/cpuset
+    chown system system /dev/cpuset/foreground
+    chown system system /dev/cpuset/background
+    chown system system /dev/cpuset/system-background
+    chown system system /dev/cpuset/top-app
+    chown system system /dev/cpuset/restricted
+    chown system system /dev/cpuset/camera-daemon
+    chown system system /dev/cpuset/tasks
+    chown system system /dev/cpuset/foreground/tasks
+    chown system system /dev/cpuset/background/tasks
+    chown system system /dev/cpuset/system-background/tasks
+    chown system system /dev/cpuset/top-app/tasks
+    chown system system /dev/cpuset/restricted/tasks
+    chown system system /dev/cpuset/camera-daemon/tasks
+
+    # set system-background to 0775 so SurfaceFlinger can touch it
+    chmod 0775 /dev/cpuset/system-background
+
+    chmod 0664 /dev/cpuset/foreground/tasks
+    chmod 0664 /dev/cpuset/background/tasks
+    chmod 0664 /dev/cpuset/system-background/tasks
+    chmod 0664 /dev/cpuset/top-app/tasks
+    chmod 0664 /dev/cpuset/restricted/tasks
+    chmod 0664 /dev/cpuset/tasks
+    chmod 0664 /dev/cpuset/camera-daemon/tasks
+
+    # make the PSI monitor accessible to others
+    chown system system /proc/pressure/memory
+    chmod 0664 /proc/pressure/memory
+
+    # qtaguid will limit access to specific data based on group memberships.
+    #   net_bw_acct grants impersonation of socket owners.
+    #   net_bw_stats grants access to other apps' detailed tagged-socket stats.
+    chown root net_bw_acct /proc/net/xt_qtaguid/ctrl
+    chown root net_bw_stats /proc/net/xt_qtaguid/stats
+
+    # Allow everybody to read the xt_qtaguid resource tracking misc dev.
+    # This is needed by any process that uses socket tagging.
+    chmod 0644 /dev/xt_qtaguid
+
+    mount bpf bpf /sys/fs/bpf nodev noexec nosuid
+
+    # Create location for fs_mgr to store abbreviated output from filesystem
+    # checker programs.
+    mkdir /dev/fscklogs 0770 root system
+
+    # pstore/ramoops previous console log
+    mount pstore pstore /sys/fs/pstore nodev noexec nosuid
+    chown system log /sys/fs/pstore
+    chmod 0550 /sys/fs/pstore
+    chown system log /sys/fs/pstore/console-ramoops
+    chmod 0440 /sys/fs/pstore/console-ramoops
+    chown system log /sys/fs/pstore/console-ramoops-0
+    chmod 0440 /sys/fs/pstore/console-ramoops-0
+    chown system log /sys/fs/pstore/pmsg-ramoops-0
+    chmod 0440 /sys/fs/pstore/pmsg-ramoops-0
+
+    # enable armv8_deprecated instruction hooks
+    write /proc/sys/abi/swp 1
+
+    # Linux's execveat() syscall may construct paths containing /dev/fd
+    # expecting it to point to /proc/self/fd
+    symlink /proc/self/fd /dev/fd
+
+    export DOWNLOAD_CACHE /data/cache
+
+    # This allows the ledtrig-transient properties to be created here so
+    # that they can be chown'd to system:system later on boot
+    write /sys/class/leds/vibrator/trigger "transient"
+
+    # This is used by Bionic to select optimized routines.
+    write /dev/cpu_variant:${ro.bionic.arch} ${ro.bionic.cpu_variant}
+    chmod 0444 /dev/cpu_variant:${ro.bionic.arch}
+    write /dev/cpu_variant:${ro.bionic.2nd_arch} ${ro.bionic.2nd_cpu_variant}
+    chmod 0444 /dev/cpu_variant:${ro.bionic.2nd_arch}
+
+    # Allow system processes to read / write power state.
+    chown system system /sys/power/state
+    chown system system /sys/power/wakeup_count
+    chmod 0660 /sys/power/state
+
+    chown radio wakelock /sys/power/wake_lock
+    chown radio wakelock /sys/power/wake_unlock
+    chmod 0660 /sys/power/wake_lock
+    chmod 0660 /sys/power/wake_unlock
+
+    # Start logd before any other services run to ensure we capture all of their logs.
+    start logd
+    # Start lmkd before any other services run so that it can register them
+    chown root system /sys/module/lowmemorykiller/parameters/adj
+    chmod 0664 /sys/module/lowmemorykiller/parameters/adj
+    chown root system /sys/module/lowmemorykiller/parameters/minfree
+    chmod 0664 /sys/module/lowmemorykiller/parameters/minfree
+    start lmkd
+
+    # Start essential services.
+    start servicemanager
+    start hwservicemanager
+    start vndservicemanager
+    start cellsservice
+
+# Healthd can trigger a full boot from charger mode by signaling this
+# property when the power button is held.
+on property:sys.boot_from_charger_mode=1
+    class_stop charger
+    trigger late-init
+
+on load_persist_props_action
+    load_persist_props
+    start logd
+    start logd-reinit
+
+# Indicate to fw loaders that the relevant mounts are up.
+on firmware_mounts_complete
+    rm /dev/.booting
+
+# Mount filesystems and start core system services.
+on late-init
+    trigger early-fs
+
+    # Mount fstab in init.{$device}.rc by mount_all command. Optional parameter
+    # '--early' can be specified to skip entries with 'latemount'.
+    # /system and /vendor must be mounted by the end of the fs stage,
+    # while /data is optional.
+    trigger fs
+    trigger post-fs
+
+    # Mount fstab in init.{$device}.rc by mount_all with '--late' parameter
+    # to only mount entries with 'latemount'. This is needed if '--early' is
+    # specified in the previous mount_all command on the fs stage.
+    # With /system mounted and properties form /system + /factory available,
+    # some services can be started.
+    trigger late-fs
+
+    # Now we can mount /data. File encryption requires keymaster to decrypt
+    # /data, which in turn can only be loaded when system properties are present.
+    trigger post-fs-data
+
+    # Load persist properties and override properties (if enabled) from /data.
+    trigger load_persist_props_action
+
+    # Should be before netd, but after apex, properties and logging is available.
+    trigger load_bpf_programs
+
+    # Now we can start zygote for devices with file based encryption
+    trigger zygote-start
+
+    # Remove a file to wake up anything waiting for firmware.
+    trigger firmware_mounts_complete
+
+    trigger early-boot
+    trigger boot
+
+on early-fs
+    # Once metadata has been mounted, we'll need vold to deal with userdata checkpointing
+    start vold
+
+on post-fs
+    exec - system system -- /system/bin/vdc checkpoint markBootAttempt
+
+    # Once everything is setup, no need to modify /.
+    # The bind+remount combination allows this to work in containers.
+    mount rootfs rootfs / remount bind ro nodev
+
+    # Mount default storage into root namespace
+    mount none /mnt/user/0 /storage bind rec
+    mount none none /storage slave rec
+
+    # Make sure /sys/kernel/debug (if present) is labeled properly
+    # Note that tracefs may be mounted under debug, so we need to cross filesystems
+    restorecon --recursive --cross-filesystems /sys/kernel/debug
+
+    # We chown/chmod /cache again so because mount is run as root + defaults
+    chown system cache /cache
+    chmod 0770 /cache
+    # We restorecon /cache in case the cache partition has been reset.
+    restorecon_recursive /cache
+
+    # Create /cache/recovery in case it's not there. It'll also fix the odd
+    # permissions if created by the recovery system.
+    mkdir /cache/recovery 0770 system cache
+
+    # Backup/restore mechanism uses the cache partition
+    mkdir /cache/backup_stage 0700 system system
+    mkdir /cache/backup 0700 system system
+
+    #change permissions on vmallocinfo so we can grab it from bugreports
+    chown root log /proc/vmallocinfo
+    chmod 0440 /proc/vmallocinfo
+
+    chown root log /proc/slabinfo
+    chmod 0440 /proc/slabinfo
+
+    chown root log /proc/pagetypeinfo
+    chmod 0440 /proc/pagetypeinfo
+
+    #change permissions on kmsg & sysrq-trigger so bugreports can grab kthread stacks
+    chown root system /proc/kmsg
+    chmod 0440 /proc/kmsg
+    chown root system /proc/sysrq-trigger
+    chmod 0220 /proc/sysrq-trigger
+    chown system log /proc/last_kmsg
+    chmod 0440 /proc/last_kmsg
+
+    # make the selinux kernel policy world-readable
+    chmod 0444 /sys/fs/selinux/policy
+
+    # create the lost+found directories, so as to enforce our permissions
+    mkdir /cache/lost+found 0770 root root
+
+    restorecon_recursive /metadata
+    mkdir /metadata/vold
+    chmod 0700 /metadata/vold
+    mkdir /metadata/password_slots 0771 root system
+    mkdir /metadata/bootstat 0750 system log
+    mkdir /metadata/ota 0700 root system
+    mkdir /metadata/ota/snapshots 0700 root system
+    mkdir /metadata/userspacereboot 0770 root system
+    mkdir /metadata/watchdog 0770 root system
+
+    mkdir /metadata/apex 0700 root system
+    mkdir /metadata/apex/sessions 0700 root system
+    # On some devices we see a weird behaviour in which /metadata/apex doesn't
+    # have a correct label. To workaround this bug, explicitly call restorecon
+    # on /metadata/apex. For most of the boot sequences /metadata/apex will
+    # already have a correct selinux label, meaning that this call will be a
+    # no-op.
+    restorecon_recursive /metadata/apex
+
+    mkdir /metadata/staged-install 0770 root system
+on late-fs
+    # Ensure that tracefs has the correct permissions.
+    # This does not work correctly if it is called in post-fs.
+    chmod 0755 /sys/kernel/tracing
+    chmod 0755 /sys/kernel/debug/tracing
+
+    # HALs required before storage encryption can get unlocked (FBE/FDE)
+    class_start early_hal
+
+    # Load trusted keys from dm-verity protected partitions
+    exec -- /system/bin/fsverity_init --load-verified-keys
+
+# Only enable the bootreceiver tracing instance for kernels 5.10 and above.
+on late-fs && property:ro.kernel.version=4.9
+    setprop bootreceiver.enable 0
+on late-fs && property:ro.kernel.version=4.14
+    setprop bootreceiver.enable 0
+on late-fs && property:ro.kernel.version=4.19
+    setprop bootreceiver.enable 0
+on late-fs && property:ro.kernel.version=5.4
+    setprop bootreceiver.enable 0
+on late-fs
+    # Bootreceiver tracing instance is enabled by default.
+    setprop bootreceiver.enable ${bootreceiver.enable:-1}
+
+on property:ro.product.cpu.abilist64=* && property:bootreceiver.enable=1
+    # Set up a tracing instance for system_server to monitor error_report_end events.
+    # These are sent by kernel tools like KASAN and KFENCE when a memory corruption
+    # is detected. This is only needed for 64-bit systems.
+    mkdir /sys/kernel/tracing/instances/bootreceiver 0700 system system
+    restorecon_recursive /sys/kernel/tracing/instances/bootreceiver
+    write /sys/kernel/tracing/instances/bootreceiver/buffer_size_kb 1
+    write /sys/kernel/tracing/instances/bootreceiver/trace_options disable_on_free
+    write /sys/kernel/tracing/instances/bootreceiver/events/error_report/error_report_end/enable 1
+
+on post-fs-data
+
+    mark_post_data
+
+    # Start checkpoint before we touch data
+    exec - system system -- /system/bin/vdc checkpoint prepareCheckpoint
+
+    # We chown/chmod /data again so because mount is run as root + defaults
+    chown system system /data
+    chmod 0771 /data
+    # We restorecon /data in case the userdata partition has been reset.
+    restorecon /data
+
+    # Make sure we have the device encryption key.
+    installkey /data
+
+    # Start bootcharting as soon as possible after the data partition is
+    # mounted to collect more data.
+    mkdir /data/bootchart 0755 shell shell encryption=Require
+    bootchart start
+
+    # Avoid predictable entropy pool. Carry over entropy from previous boot.
+    copy /data/system/entropy.dat /dev/urandom
+
+    mkdir /data/vendor 0771 root root encryption=Require
+    mkdir /data/vendor_ce 0771 root root encryption=None
+    mkdir /data/vendor_de 0771 root root encryption=None
+    mkdir /data/vendor/hardware 0771 root root
+
+    # Start tombstoned early to be able to store tombstones.
+    mkdir /data/anr 0775 system system encryption=Require
+    mkdir /data/tombstones 0771 system system encryption=Require
+    mkdir /data/vendor/tombstones 0771 root root
+    mkdir /data/vendor/tombstones/wifi 0771 wifi wifi
+    start tombstoned
+
+    # Make sure that apexd is started in the default namespace
+    enter_default_mount_ns
+
+    # set up keystore directory structure first so that we can end early boot
+    # and start apexd
+    mkdir /data/misc 01771 system misc encryption=Require
+    mkdir /data/misc/keystore 0700 keystore keystore
+    # work around b/183668221
+    restorecon /data/misc /data/misc/keystore
+
+    # Boot level 30
+    # odsign signing keys have MAX_BOOT_LEVEL=30
+    # This is currently the earliest boot level, but we start at 30
+    # to leave room for earlier levels.
+    setprop keystore.boot_level 30
+
+    # Now that /data is mounted and we have created /data/misc/keystore,
+    # we can tell keystore to stop allowing use of early-boot keys,
+    # and access its database for the first time to support creation and
+    # use of MAX_BOOT_LEVEL keys.
+    exec - system system -- /system/bin/vdc keymaster earlyBootEnded
+
+    # /data/apex is now available. Start apexd to scan and activate APEXes.
+    #
+    # To handle userspace reboots as well as devices that use FDE, make sure
+    # that apexd is started cleanly here (set apexd.status="") and that it is
+    # restarted if it's already running.
+    mkdir /data/apex 0755 root system encryption=None
+    mkdir /data/apex/active 0755 root system
+    mkdir /data/apex/backup 0700 root system
+    mkdir /data/apex/decompressed 0755 root system encryption=Require
+    mkdir /data/apex/hashtree 0700 root system
+    mkdir /data/apex/sessions 0700 root system
+    mkdir /data/app-staging 0751 system system encryption=DeleteIfNecessary
+    mkdir /data/apex/ota_reserved 0700 root system encryption=Require
+    setprop apexd.status ""
+    restart apexd
+
+    # create rest of basic filesystem structure
+    mkdir /data/misc/recovery 0770 system log
+    copy /data/misc/recovery/ro.build.fingerprint /data/misc/recovery/ro.build.fingerprint.1
+    chmod 0440 /data/misc/recovery/ro.build.fingerprint.1
+    chown system log /data/misc/recovery/ro.build.fingerprint.1
+    write /data/misc/recovery/ro.build.fingerprint ${ro.build.fingerprint}
+    chmod 0440 /data/misc/recovery/ro.build.fingerprint
+    chown system log /data/misc/recovery/ro.build.fingerprint
+    mkdir /data/misc/recovery/proc 0770 system log
+    copy /data/misc/recovery/proc/version /data/misc/recovery/proc/version.1
+    chmod 0440 /data/misc/recovery/proc/version.1
+    chown system log /data/misc/recovery/proc/version.1
+    copy /proc/version /data/misc/recovery/proc/version
+    chmod 0440 /data/misc/recovery/proc/version
+    chown system log /data/misc/recovery/proc/version
+    mkdir /data/misc/bluedroid 02770 bluetooth bluetooth
+    # Fix the access permissions and group ownership for 'bt_config.conf'
+    chmod 0660 /data/misc/bluedroid/bt_config.conf
+    chown bluetooth bluetooth /data/misc/bluedroid/bt_config.conf
+    mkdir /data/misc/bluetooth 0770 bluetooth bluetooth
+    mkdir /data/misc/bluetooth/logs 0770 bluetooth bluetooth
+    mkdir /data/misc/nfc 0770 nfc nfc
+    mkdir /data/misc/nfc/logs 0770 nfc nfc
+    mkdir /data/misc/credstore 0700 credstore credstore
+    mkdir /data/misc/gatekeeper 0700 system system
+    mkdir /data/misc/keychain 0771 system system
+    mkdir /data/misc/net 0750 root shell
+    mkdir /data/misc/radio 0770 system radio
+    mkdir /data/misc/sms 0770 system radio
+    mkdir /data/misc/carrierid 0770 system radio
+    mkdir /data/misc/apns 0770 system radio
+    mkdir /data/misc/emergencynumberdb 0770 system radio
+    mkdir /data/misc/zoneinfo 0775 system system
+    mkdir /data/misc/network_watchlist 0774 system system
+    mkdir /data/misc/textclassifier 0771 system system
+    mkdir /data/misc/vpn 0770 system vpn
+    mkdir /data/misc/shared_relro 0771 shared_relro shared_relro
+    mkdir /data/misc/systemkeys 0700 system system
+    mkdir /data/misc/wifi 0770 wifi wifi
+    mkdir /data/misc/wifi/sockets 0770 wifi wifi
+    mkdir /data/misc/wifi/wpa_supplicant 0770 wifi wifi
+    mkdir /data/misc/ethernet 0770 system system
+    mkdir /data/misc/dhcp 0770 dhcp dhcp
+    mkdir /data/misc/user 0771 root root
+    # give system access to wpa_supplicant.conf for backup and restore
+    chmod 0660 /data/misc/wifi/wpa_supplicant.conf
+    mkdir /data/local 0751 root root encryption=Require
+    mkdir /data/misc/media 0700 media media
+    mkdir /data/misc/audioserver 0700 audioserver audioserver
+    mkdir /data/misc/cameraserver 0700 cameraserver cameraserver
+    mkdir /data/misc/vold 0700 root root
+    mkdir /data/misc/boottrace 0771 system shell
+    mkdir /data/misc/update_engine 0700 root root
+    mkdir /data/misc/update_engine_log 02750 root log
+    mkdir /data/misc/trace 0700 root root
+    # create location to store surface and window trace files
+    mkdir /data/misc/wmtrace 0700 system system
+    # create location to store accessibility trace files
+    mkdir /data/misc/a11ytrace 0700 system system
+    # profile file layout
+    mkdir /data/misc/profiles 0771 system system
+    mkdir /data/misc/profiles/cur 0771 system system
+    mkdir /data/misc/profiles/ref 0771 system system
+    mkdir /data/misc/profman 0770 system shell
+    mkdir /data/misc/gcov 0770 root root
+    mkdir /data/misc/installd 0700 root root
+    mkdir /data/misc/apexdata 0711 root root
+    mkdir /data/misc/apexrollback 0700 root root
+    mkdir /data/misc/appcompat/ 0700 system system
+    mkdir /data/misc/snapshotctl_log 0755 root root
+    # create location to store pre-reboot information
+    mkdir /data/misc/prereboot 0700 system system
+    # directory used for on-device refresh metrics file.
+    mkdir /data/misc/odrefresh 0777 system system
+    # directory used for on-device signing key blob
+    mkdir /data/misc/odsign 0700 root root
+
+    mkdir /data/preloads 0775 system system encryption=None
+
+    # For security reasons, /data/local/tmp should always be empty.
+    # Do not place files or directories in /data/local/tmp
+    mkdir /data/local/tmp 0771 shell shell
+    mkdir /data/local/traces 0777 shell shell
+    mkdir /data/data 0771 system system encryption=None
+    mkdir /data/app-private 0771 system system encryption=Require
+    mkdir /data/app-ephemeral 0771 system system encryption=Require
+    mkdir /data/app-asec 0700 root root encryption=Require
+    mkdir /data/app-lib 0771 system system encryption=Require
+    mkdir /data/app 0771 system system encryption=Require
+    mkdir /data/property 0700 root root encryption=Require
+
+    # create directory for updated font files.
+    mkdir /data/fonts/ 0771 root root encryption=Require
+    mkdir /data/fonts/files 0771 system system
+    mkdir /data/fonts/config 0770 system system
+
+    # Create directories to push tests to for each linker namespace.
+    # Create the subdirectories in case the first test is run as root
+    # so it doesn't end up owned by root.
+    mkdir /data/local/tests 0700 shell shell
+    mkdir /data/local/tests/product 0700 shell shell
+    mkdir /data/local/tests/system 0700 shell shell
+    mkdir /data/local/tests/unrestricted 0700 shell shell
+    mkdir /data/local/tests/vendor 0700 shell shell
+
+    # create dalvik-cache, so as to enforce our permissions
+    mkdir /data/dalvik-cache 0771 root root encryption=Require
+    # create the A/B OTA directory, so as to enforce our permissions
+    mkdir /data/ota 0771 root root encryption=Require
+
+    # create the OTA package directory. It will be accessed by GmsCore (cache
+    # group), update_engine and update_verifier.
+    mkdir /data/ota_package 0770 system cache encryption=Require
+
+    # create resource-cache and double-check the perms
+    mkdir /data/resource-cache 0771 system system encryption=Require
+    chown system system /data/resource-cache
+    chmod 0771 /data/resource-cache
+
+    # create the lost+found directories, so as to enforce our permissions
+    mkdir /data/lost+found 0770 root root encryption=None
+
+    # create directory for DRM plug-ins - give drm the read/write access to
+    # the following directory.
+    mkdir /data/drm 0770 drm drm encryption=Require
+
+    # create directory for MediaDrm plug-ins - give drm the read/write access to
+    # the following directory.
+    mkdir /data/mediadrm 0770 mediadrm mediadrm encryption=Require
+
+    # NFC: create data/nfc for nv storage
+    mkdir /data/nfc 0770 nfc nfc encryption=Require
+    mkdir /data/nfc/param 0770 nfc nfc
+
+    # Create all remaining /data root dirs so that they are made through init
+    # and get proper encryption policy installed
+    mkdir /data/backup 0700 system system encryption=Require
+    mkdir /data/ss 0700 system system encryption=Require
+
+    mkdir /data/system 0775 system system encryption=Require
+    mkdir /data/system/environ 0700 system system
+    # b/183861600 attempt to fix selinux label before running derive_classpath service
+    restorecon /data/system/environ
+    mkdir /data/system/dropbox 0700 system system
+    mkdir /data/system/heapdump 0700 system system
+    mkdir /data/system/users 0775 system system
+
+    mkdir /data/system_de 0770 system system encryption=None
+    mkdir /data/system_ce 0770 system system encryption=None
+
+    mkdir /data/misc_de 01771 system misc encryption=None
+    mkdir /data/misc_ce 01771 system misc encryption=None
+
+    mkdir /data/user 0711 system system encryption=None
+    mkdir /data/user_de 0711 system system encryption=None
+
+    # Unlink /data/user/0 if we previously symlink it to /data/data
+    rm /data/user/0
+
+    # Bind mount /data/user/0 to /data/data
+    mkdir /data/user/0 0700 system system encryption=None
+    mount none /data/data /data/user/0 bind rec
+
+    # A tmpfs directory, which will contain all apps CE DE data directory that
+    # bind mount from the original source.
+    mount tmpfs tmpfs /data_mirror nodev noexec nosuid mode=0700,uid=0,gid=1000
+    restorecon /data_mirror
+    mkdir /data_mirror/data_ce 0700 root root
+    mkdir /data_mirror/data_de 0700 root root
+
+    # Create CE and DE data directory for default volume
+    mkdir /data_mirror/data_ce/null 0700 root root
+    mkdir /data_mirror/data_de/null 0700 root root
+
+    # Bind mount CE and DE data directory to mirror's default volume directory
+    mount none /data/user /data_mirror/data_ce/null bind rec
+    mount none /data/user_de /data_mirror/data_de/null bind rec
+
+    # Create mirror directory for jit profiles
+    mkdir /data_mirror/cur_profiles 0700 root root
+    mount none /data/misc/profiles/cur /data_mirror/cur_profiles bind rec
+    mkdir /data_mirror/ref_profiles 0700 root root
+    mount none /data/misc/profiles/ref /data_mirror/ref_profiles bind rec
+
+    mkdir /data/cache 0770 system cache encryption=Require
+    mkdir /data/cache/recovery 0770 system cache
+    mkdir /data/cache/backup_stage 0700 system system
+    mkdir /data/cache/backup 0700 system system
+
+    # Delete these if need be, per b/139193659
+    mkdir /data/rollback 0700 system system encryption=DeleteIfNecessary
+    mkdir /data/rollback-observer 0700 system system encryption=DeleteIfNecessary
+    mkdir /data/rollback-history 0700 system system encryption=DeleteIfNecessary
+
+    # Create root dir for Incremental Service
+    mkdir /data/incremental 0771 system system encryption=Require
+
+    # Create directories for statsd
+    mkdir /data/misc/stats-active-metric/ 0770 statsd system
+    mkdir /data/misc/stats-data/ 0770 statsd system
+    mkdir /data/misc/stats-metadata/ 0770 statsd system
+    mkdir /data/misc/stats-service/ 0770 statsd system
+    mkdir /data/misc/train-info/ 0770 statsd system
+
+    # Wait for apexd to finish activating APEXes before starting more processes.
+    wait_for_prop apexd.status activated
+    perform_apex_config
+
+    # Special-case /data/media/obb per b/64566063
+    mkdir /data/media 0770 media_rw media_rw encryption=None
+    exec - media_rw media_rw -- /system/bin/chattr +F /data/media
+    mkdir /data/media/obb 0770 media_rw media_rw encryption=Attempt
+
+    exec_start derive_sdk
+
+    init_user0
+
+    # Set SELinux security contexts on upgrade or policy update.
+    restorecon --recursive --skip-ce /data
+
+    # Define and export *CLASSPATH variables
+    # Must start before 'odsign', as odsign depends on *CLASSPATH variables
+    exec_start derive_classpath
+    load_exports /data/system/environ/classpath
+
+    # Start the on-device signing daemon, and wait for it to finish, to ensure
+    # ART artifacts are generated if needed.
+    # Must start after 'derive_classpath' to have *CLASSPATH variables set.
+    start odsign
+
+    # Before we can lock keys and proceed to the next boot stage, wait for
+    # odsign to be done with the key
+    wait_for_prop odsign.key.done 1
+
+    # Lock the fs-verity keyring, so no more keys can be added
+    exec -- /system/bin/fsverity_init --lock
+
+    # Bump the boot level to 1000000000; this prevents further on-device signing.
+    # This is a special value that shuts down the thread which listens for
+    # further updates.
+    setprop keystore.boot_level 1000000000
+
+    # Allow apexd to snapshot and restore device encrypted apex data in the case
+    # of a rollback. This should be done immediately after DE_user data keys
+    # are loaded. APEXes should not access this data until this has been
+    # completed and apexd.status becomes "ready".
+    exec_start apexd-snapshotde
+
+    # Check any timezone data in /data is newer than the copy in the time zone data
+    # module, delete if not.
+    exec - system system -- /system/bin/tzdatacheck /apex/com.android.tzdata/etc/tz /data/misc/zoneinfo
+
+    # If there is no post-fs-data action in the init.<device>.rc file, you
+    # must uncomment this line, otherwise encrypted filesystems
+    # won't work.
+    # Set indication (checked by vold) that we have finished this action
+    #setprop vold.post_fs_data_done 1
+
+    # sys.memfd_use set to false by default, which keeps it disabled
+    # until it is confirmed that apps and vendor processes don't make
+    # IOCTLs on ashmem fds any more.
+    setprop sys.use_memfd false
+
+    # Set fscklog permission
+    chown root system /dev/fscklogs/log
+    chmod 0770 /dev/fscklogs/log
+
+    # Enable FUSE by default
+    setprop persist.sys.fuse true
+
+# It is recommended to put unnecessary data/ initialization from post-fs-data
+# to start-zygote in device's init.rc to unblock zygote start.
+on zygote-start && property:ro.crypto.state=unencrypted
+    wait_for_prop odsign.verification.done 1
+    # A/B update verifier that marks a successful boot.
+    exec_start update_verifier_nonencrypted
+    start statsd
+    start netd
+    start zygote
+    start zygote_secondary
+
+on zygote-start && property:ro.crypto.state=unsupported
+    wait_for_prop odsign.verification.done 1
+    # A/B update verifier that marks a successful boot.
+    exec_start update_verifier_nonencrypted
+    start statsd
+    start netd
+    start zygote
+    start zygote_secondary
+
+on zygote-start && property:ro.crypto.state=encrypted && property:ro.crypto.type=file
+    wait_for_prop odsign.verification.done 1
+    # A/B update verifier that marks a successful boot.
+    exec_start update_verifier_nonencrypted
+    start statsd
+    start netd
+    start zygote
+    start zygote_secondary
+
+on boot && property:ro.config.low_ram=true
+    # Tweak background writeout
+    write /proc/sys/vm/dirty_expire_centisecs 200
+    write /proc/sys/vm/dirty_background_ratio  5
+
+on boot
+    # basic network init
+    ifup lo
+    hostname localhost
+    domainname localdomain
+
+    # IPsec SA default expiration length
+    write /proc/sys/net/core/xfrm_acq_expires 3600
+
+    # Memory management.  Basic kernel parameters, and allow the high
+    # level system server to be able to adjust the kernel OOM driver
+    # parameters to match how it is managing things.
+    write /proc/sys/vm/overcommit_memory 1
+    write /proc/sys/vm/min_free_order_shift 4
+
+    # System server manages zram writeback
+    chown root system /sys/block/zram0/idle
+    chmod 0664 /sys/block/zram0/idle
+    chown root system /sys/block/zram0/writeback
+    chmod 0664 /sys/block/zram0/writeback
+
+    # to access F2FS sysfs on dm-<num> directly
+    mkdir /dev/sys/fs/by-name 0755 system system
+    symlink /sys/fs/f2fs/${dev.mnt.blk.data} /dev/sys/fs/by-name/userdata
+
+    # to access dm-<num> sysfs
+    mkdir /dev/sys/block/by-name 0755 system system
+    symlink /sys/devices/virtual/block/${dev.mnt.blk.data} /dev/sys/block/by-name/userdata
+
+    # F2FS tuning. Set cp_interval larger than dirty_expire_centisecs, 30 secs,
+    # to avoid power consumption when system becomes mostly idle. Be careful
+    # to make it too large, since it may bring userdata loss, if they
+    # are not aware of using fsync()/sync() to prepare sudden power-cut.
+    write /dev/sys/fs/by-name/userdata/cp_interval 200
+    write /dev/sys/fs/by-name/userdata/gc_urgent_sleep_time 50
+    write /dev/sys/fs/by-name/userdata/iostat_enable 1
+
+    # limit discard size to 128MB in order to avoid long IO latency
+    # for filesystem tuning first (dm or sda)
+    # Note that, if dm-<num> is used, sda/mmcblk0 should be tuned in vendor/init.rc
+    write /dev/sys/block/by-name/userdata/queue/discard_max_bytes 134217728
+
+    # Permissions for System Server and daemons.
+    chown system system /sys/power/autosleep
+
+    chown system system /sys/devices/system/cpu/cpufreq/interactive/timer_rate
+    chmod 0660 /sys/devices/system/cpu/cpufreq/interactive/timer_rate
+    chown system system /sys/devices/system/cpu/cpufreq/interactive/timer_slack
+    chmod 0660 /sys/devices/system/cpu/cpufreq/interactive/timer_slack
+    chown system system /sys/devices/system/cpu/cpufreq/interactive/min_sample_time
+    chmod 0660 /sys/devices/system/cpu/cpufreq/interactive/min_sample_time
+    chown system system /sys/devices/system/cpu/cpufreq/interactive/hispeed_freq
+    chmod 0660 /sys/devices/system/cpu/cpufreq/interactive/hispeed_freq
+    chown system system /sys/devices/system/cpu/cpufreq/interactive/target_loads
+    chmod 0660 /sys/devices/system/cpu/cpufreq/interactive/target_loads
+    chown system system /sys/devices/system/cpu/cpufreq/interactive/go_hispeed_load
+    chmod 0660 /sys/devices/system/cpu/cpufreq/interactive/go_hispeed_load
+    chown system system /sys/devices/system/cpu/cpufreq/interactive/above_hispeed_delay
+    chmod 0660 /sys/devices/system/cpu/cpufreq/interactive/above_hispeed_delay
+    chown system system /sys/devices/system/cpu/cpufreq/interactive/boost
+    chmod 0660 /sys/devices/system/cpu/cpufreq/interactive/boost
+    chown system system /sys/devices/system/cpu/cpufreq/interactive/boostpulse
+    chown system system /sys/devices/system/cpu/cpufreq/interactive/input_boost
+    chmod 0660 /sys/devices/system/cpu/cpufreq/interactive/input_boost
+    chown system system /sys/devices/system/cpu/cpufreq/interactive/boostpulse_duration
+    chmod 0660 /sys/devices/system/cpu/cpufreq/interactive/boostpulse_duration
+    chown system system /sys/devices/system/cpu/cpufreq/interactive/io_is_busy
+    chmod 0660 /sys/devices/system/cpu/cpufreq/interactive/io_is_busy
+
+    # Assume SMP uses shared cpufreq policy for all CPUs
+    chown system system /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq
+    chmod 0660 /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq
+
+    chown system system /sys/class/leds/vibrator/trigger
+    chown system system /sys/class/leds/vibrator/activate
+    chown system system /sys/class/leds/vibrator/brightness
+    chown system system /sys/class/leds/vibrator/duration
+    chown system system /sys/class/leds/vibrator/state
+    chown system system /sys/class/timed_output/vibrator/enable
+    chown system system /sys/class/leds/keyboard-backlight/brightness
+    chown system system /sys/class/leds/lcd-backlight/brightness
+    chown system system /sys/class/leds/button-backlight/brightness
+    chown system system /sys/class/leds/jogball-backlight/brightness
+    chown system system /sys/class/leds/red/brightness
+    chown system system /sys/class/leds/green/brightness
+    chown system system /sys/class/leds/blue/brightness
+    chown system system /sys/class/leds/red/device/grpfreq
+    chown system system /sys/class/leds/red/device/grppwm
+    chown system system /sys/class/leds/red/device/blink
+    chown system system /sys/module/sco/parameters/disable_esco
+    chown system system /sys/kernel/ipv4/tcp_wmem_min
+    chown system system /sys/kernel/ipv4/tcp_wmem_def
+    chown system system /sys/kernel/ipv4/tcp_wmem_max
+    chown system system /sys/kernel/ipv4/tcp_rmem_min
+    chown system system /sys/kernel/ipv4/tcp_rmem_def
+    chown system system /sys/kernel/ipv4/tcp_rmem_max
+    chown root radio /proc/cmdline
+
+    # Define default initial receive window size in segments.
+    setprop net.tcp_def_init_rwnd 60
+
+    # Start standard binderized HAL daemons
+    class_start hal
+
+    class_start core
+
+    #class_start main
+
+    write /dev/celld.startpipe cell
+
+on nonencrypted
+    class_start main
+    class_start late_start
+
+on property:sys.init_log_level=*
+    loglevel ${sys.init_log_level}
+
+on charger
+    class_start charger
+
+on property:vold.decrypt=trigger_load_persist_props
+    load_persist_props
+    start logd
+    start logd-reinit
+
+on property:vold.decrypt=trigger_post_fs_data
+    trigger post-fs-data
+    trigger zygote-start
+
+on property:vold.decrypt=trigger_restart_min_framework
+    # A/B update verifier that marks a successful boot.
+    exec_start update_verifier
+    class_start main
+
+on property:vold.decrypt=trigger_restart_framework
+    # A/B update verifier that marks a successful boot.
+    exec_start update_verifier
+    class_start_post_data hal
+    class_start_post_data core
+    class_start main
+    class_start late_start
+    setprop service.bootanim.exit 0
+    setprop service.bootanim.progress 0
+    start bootanim
+
+on property:vold.decrypt=trigger_shutdown_framework
+    class_reset late_start
+    class_reset main
+    class_reset_post_data core
+    class_reset_post_data hal
+
+on property:sys.boot_completed=1
+    bootchart stop
+    # Setup per_boot directory so other .rc could start to use it on boot_completed
+    exec - system system -- /bin/rm -rf /data/per_boot
+    mkdir /data/per_boot 0700 system system encryption=Require key=per_boot_ref
+
+# system server cannot write to /proc/sys files,
+# and chown/chmod does not work for /proc/sys/ entries.
+# So proxy writes through init.
+on property:sys.sysctl.extra_free_kbytes=*
+    write /proc/sys/vm/extra_free_kbytes ${sys.sysctl.extra_free_kbytes}
+
+# Allow users to drop caches
+on property:perf.drop_caches=3
+    write /proc/sys/vm/drop_caches 3
+    setprop perf.drop_caches 0
+
+# "tcp_default_init_rwnd" Is too long!
+on property:net.tcp_def_init_rwnd=*
+    write /proc/sys/net/ipv4/tcp_default_init_rwnd ${net.tcp_def_init_rwnd}
+
+# perf_event_open syscall security:
+# Newer kernels have the ability to control the use of the syscall via SELinux
+# hooks. init tests for this, and sets sys_init.perf_lsm_hooks to 1 if the
+# kernel has the hooks. In this case, the system-wide perf_event_paranoid
+# sysctl is set to -1 (unrestricted use), and the SELinux policy is used for
+# controlling access. On older kernels, the paranoid value is the only means of
+# controlling access. It is normally 3 (allow only root), but the shell user
+# can lower it to 1 (allowing thread-scoped pofiling) via security.perf_harden.
+on property:sys.init.perf_lsm_hooks=1
+    write /proc/sys/kernel/perf_event_paranoid -1
+on property:security.perf_harden=0 && property:sys.init.perf_lsm_hooks=""
+    write /proc/sys/kernel/perf_event_paranoid 1
+on property:security.perf_harden=1 && property:sys.init.perf_lsm_hooks=""
+    write /proc/sys/kernel/perf_event_paranoid 3
+
+# Additionally, simpleperf profiler uses debug.* and security.perf_harden
+# sysprops to be able to indirectly set these sysctls.
+on property:security.perf_harden=0
+    write /proc/sys/kernel/perf_event_max_sample_rate ${debug.perf_event_max_sample_rate:-100000}
+    write /proc/sys/kernel/perf_cpu_time_max_percent ${debug.perf_cpu_time_max_percent:-25}
+    write /proc/sys/kernel/perf_event_mlock_kb ${debug.perf_event_mlock_kb:-516}
+# Default values.
+on property:security.perf_harden=1
+    write /proc/sys/kernel/perf_event_max_sample_rate 100000
+    write /proc/sys/kernel/perf_cpu_time_max_percent 25
+    write /proc/sys/kernel/perf_event_mlock_kb 516
+
+# This property can be set only on userdebug/eng. See neverallow rule in
+# /system/sepolicy/private/property.te .
+on property:security.lower_kptr_restrict=1
+    write /proc/sys/kernel/kptr_restrict 0
+
+on property:security.lower_kptr_restrict=0
+    write /proc/sys/kernel/kptr_restrict 2
+
+
+# on shutdown
+# In device's init.rc, this trigger can be used to do device-specific actions
+# before shutdown. e.g disable watchdog and mask error handling
+
+## Daemon processes to be run by init.
+##
+service ueventd /system/bin/ueventd
+    class core
+    critical
+    seclabel u:r:ueventd:s0
+    shutdown critical
+
+service console /system/bin/sh
+    class core
+    console
+    disabled
+    user shell
+    group shell log readproc
+    seclabel u:r:shell:s0
+    setenv HOSTNAME console
+
+on property:ro.debuggable=1
+    # Give writes to anyone for the trace folder on debug builds.
+    # The folder is used to store method traces.
+    chmod 0773 /data/misc/trace
+    # Give reads to anyone for the window trace folder on debug builds.
+    chmod 0775 /data/misc/wmtrace
+    # Give reads to anyone for the accessibility trace folder on debug builds.
+    chmod 0775 /data/misc/a11ytrace
+
+on init && property:ro.debuggable=1
+    start console
+
+on userspace-reboot-requested
+  # TODO(b/135984674): reset all necessary properties here.
+  setprop sys.boot_completed ""
+  setprop dev.bootcomplete ""
+  setprop sys.init.updatable_crashing ""
+  setprop sys.init.updatable_crashing_process_name ""
+  setprop sys.user.0.ce_available ""
+  setprop sys.shutdown.requested ""
+  setprop service.bootanim.exit ""
+  setprop service.bootanim.progress ""
+
+on userspace-reboot-fs-remount
+  # Make sure that vold is running.
+  # This is mostly a precaution measure in case vold for some reason wasn't running when
+  # userspace reboot was initiated.
+  start vold
+  exec - system system -- /system/bin/vdc checkpoint resetCheckpoint
+  exec - system system -- /system/bin/vdc checkpoint markBootAttempt
+  # Unmount /data_mirror mounts in the reverse order of corresponding mounts.
+  umount /data_mirror/data_ce/null/0
+  umount /data_mirror/data_ce/null
+  umount /data_mirror/data_de/null
+  umount /data_mirror/cur_profiles
+  umount /data_mirror/ref_profiles
+  umount /data_mirror
+  remount_userdata
+  start bootanim
+
+on userspace-reboot-resume
+  trigger userspace-reboot-fs-remount
+  trigger post-fs-data
+  trigger zygote-start
+  trigger early-boot
+  trigger boot
+
+on property:sys.boot_completed=1 && property:sys.init.userspace_reboot.in_progress=1
+  setprop sys.init.userspace_reboot.in_progress ""
+
+service cellsservice /system/bin/cellsservice
+    class main
+    user root
+    group root
+    seclabel  u:r:init:s0
diff --git a/core/rootdir/cells/system/hw/init.usb.configfs.rc b/core/rootdir/cells/system/hw/init.usb.configfs.rc
new file mode 100644
index 0000000..3a33c94
--- /dev/null
+++ b/core/rootdir/cells/system/hw/init.usb.configfs.rc
@@ -0,0 +1,140 @@
+on property:sys.usb.config=none && property:sys.usb.configfs=1
+    write /config/usb_gadget/g1/UDC "none"
+    stop adbd
+    setprop sys.usb.ffs.ready 0
+    write /config/usb_gadget/g1/bDeviceClass 0
+    write /config/usb_gadget/g1/bDeviceSubClass 0
+    write /config/usb_gadget/g1/bDeviceProtocol 0
+    rm /config/usb_gadget/g1/configs/b.1/f1
+    rm /config/usb_gadget/g1/configs/b.1/f2
+    rm /config/usb_gadget/g1/configs/b.1/f3
+    rmdir /config/usb_gadget/g1/functions/rndis.gs4
+    setprop sys.usb.state ${sys.usb.config}
+
+on property:init.svc.adbd=stopped
+    setprop sys.usb.ffs.ready 0
+
+on property:sys.usb.config=adb && property:sys.usb.configfs=1
+    start adbd
+
+on property:sys.usb.ffs.ready=1 && property:sys.usb.config=adb && property:sys.usb.configfs=1
+    write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "adb"
+    symlink /config/usb_gadget/g1/functions/ffs.adb /config/usb_gadget/g1/configs/b.1/f1
+    write /config/usb_gadget/g1/UDC ${sys.usb.controller}
+    setprop sys.usb.state ${sys.usb.config}
+
+on property:sys.usb.config=mtp && property:sys.usb.configfs=1
+    write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "mtp"
+    symlink /config/usb_gadget/g1/functions/mtp.gs0 /config/usb_gadget/g1/configs/b.1/f1
+    write /config/usb_gadget/g1/UDC ${sys.usb.controller}
+    setprop sys.usb.state ${sys.usb.config}
+
+on property:sys.usb.config=mtp,adb && property:sys.usb.configfs=1
+    start adbd
+
+on property:sys.usb.ffs.ready=1 && property:sys.usb.config=mtp,adb && property:sys.usb.configfs=1
+    write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "mtp_adb"
+    symlink /config/usb_gadget/g1/functions/mtp.gs0 /config/usb_gadget/g1/configs/b.1/f1
+    symlink /config/usb_gadget/g1/functions/ffs.adb /config/usb_gadget/g1/configs/b.1/f2
+    write /config/usb_gadget/g1/UDC ${sys.usb.controller}
+    setprop sys.usb.state ${sys.usb.config}
+
+on property:sys.usb.config=ptp && property:sys.usb.configfs=1
+    write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "ptp"
+    symlink /config/usb_gadget/g1/functions/ptp.gs1 /config/usb_gadget/g1/configs/b.1/f1
+    write /config/usb_gadget/g1/UDC ${sys.usb.controller}
+    setprop sys.usb.state ${sys.usb.config}
+
+on property:sys.usb.config=ptp,adb && property:sys.usb.configfs=1
+    start adbd
+
+on property:sys.usb.ffs.ready=1 && property:sys.usb.config=ptp,adb && property:sys.usb.configfs=1
+    write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "ptp_adb"
+    symlink /config/usb_gadget/g1/functions/ptp.gs1 /config/usb_gadget/g1/configs/b.1/f1
+    symlink /config/usb_gadget/g1/functions/ffs.adb /config/usb_gadget/g1/configs/b.1/f2
+    write /config/usb_gadget/g1/UDC ${sys.usb.controller}
+    setprop sys.usb.state ${sys.usb.config}
+
+on property:sys.usb.config=accessory && property:sys.usb.configfs=1
+    write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "accessory"
+    symlink /config/usb_gadget/g1/functions/accessory.gs2 /config/usb_gadget/g1/configs/b.1/f1
+    write /config/usb_gadget/g1/UDC ${sys.usb.controller}
+    setprop sys.usb.state ${sys.usb.config}
+
+on property:sys.usb.config=accessory,adb && property:sys.usb.configfs=1
+    start adbd
+
+on property:sys.usb.ffs.ready=1 && property:sys.usb.config=accessory,adb && property:sys.usb.configfs=1
+    write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "accessory_adb"
+    symlink /config/usb_gadget/g1/functions/accessory.gs2 /config/usb_gadget/g1/configs/b.1/f1
+    symlink /config/usb_gadget/g1/functions/ffs.adb /config/usb_gadget/g1/configs/b.1/f2
+    write /config/usb_gadget/g1/UDC ${sys.usb.controller}
+    setprop sys.usb.state ${sys.usb.config}
+
+on property:sys.usb.config=audio_source && property:sys.usb.configfs=1
+    write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "audiosource"
+    symlink /config/usb_gadget/g1/functions/audio_source.gs3 /config/usb_gadget/g1/configs/b.1/f1
+    write /config/usb_gadget/g1/UDC ${sys.usb.controller}
+    setprop sys.usb.state ${sys.usb.config}
+
+on property:sys.usb.config=audio_source,adb && property:sys.usb.configfs=1
+    start adbd
+
+on property:sys.usb.ffs.ready=1 && property:sys.usb.config=audio_source,adb && property:sys.usb.configfs=1
+    write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "audiosource_adb"
+    symlink /config/usb_gadget/g1/functions/audio_source.gs3 /config/usb_gadget/g1/configs/b.1/f1
+    symlink /config/usb_gadget/g1/functions/ffs.adb /config/usb_gadget/g1/configs/b.1/f2
+    write /config/usb_gadget/g1/UDC ${sys.usb.controller}
+    setprop sys.usb.state ${sys.usb.config}
+
+on property:sys.usb.config=accessory,audio_source && property:sys.usb.configfs=1
+    write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "accessory_audiosource"
+    symlink /config/usb_gadget/g1/functions/accessory.gs2 /config/usb_gadget/g1/configs/b.1/f1
+    symlink /config/usb_gadget/g1/functions/audio_source.gs3 /config/usb_gadget/g1/configs/b.1/f2
+    write /config/usb_gadget/g1/UDC ${sys.usb.controller}
+    setprop sys.usb.state ${sys.usb.config}
+
+on property:sys.usb.config=accessory,audio_source,adb && property:sys.usb.configfs=1
+    start adbd
+
+on property:sys.usb.ffs.ready=1 && property:sys.usb.config=accessory,audio_source,adb && property:sys.usb.configfs=1
+    write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "accessory_audiosource_adb"
+    symlink /config/usb_gadget/g1/functions/accessory.gs2 /config/usb_gadget/g1/configs/b.1/f1
+    symlink /config/usb_gadget/g1/functions/audio_source.gs3 /config/usb_gadget/g1/configs/b.1/f2
+    symlink /config/usb_gadget/g1/functions/ffs.adb /config/usb_gadget/g1/configs/b.1/f3
+    write /config/usb_gadget/g1/UDC ${sys.usb.controller}
+    setprop sys.usb.state ${sys.usb.config}
+
+on property:sys.usb.config=midi && property:sys.usb.configfs=1
+    write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "midi"
+    symlink /config/usb_gadget/g1/functions/midi.gs5 /config/usb_gadget/g1/configs/b.1/f1
+    write /config/usb_gadget/g1/UDC ${sys.usb.controller}
+    setprop sys.usb.state ${sys.usb.config}
+
+on property:sys.usb.config=midi,adb && property:sys.usb.configfs=1
+    start adbd
+
+on property:sys.usb.ffs.ready=1 && property:sys.usb.config=midi,adb && property:sys.usb.configfs=1
+    write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "midi_adb"
+    symlink /config/usb_gadget/g1/functions/midi.gs5 /config/usb_gadget/g1/configs/b.1/f1
+    symlink /config/usb_gadget/g1/functions/ffs.adb /config/usb_gadget/g1/configs/b.1/f2
+    write /config/usb_gadget/g1/UDC ${sys.usb.controller}
+    setprop sys.usb.state ${sys.usb.config}
+
+on property:sys.usb.config=rndis && property:sys.usb.configfs=1
+    mkdir /config/usb_gadget/g1/functions/rndis.gs4
+    write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "rndis"
+    symlink /config/usb_gadget/g1/functions/rndis.gs4 /config/usb_gadget/g1/configs/b.1/f1
+    write /config/usb_gadget/g1/UDC ${sys.usb.controller}
+    setprop sys.usb.state ${sys.usb.config}
+
+on property:sys.usb.config=rndis,adb && property:sys.usb.configfs=1
+    start adbd
+
+on property:sys.usb.ffs.ready=1 && property:sys.usb.config=rndis,adb && property:sys.usb.configfs=1
+    mkdir /config/usb_gadget/g1/functions/rndis.gs4
+    write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "rndis_adb"
+    symlink /config/usb_gadget/g1/functions/rndis.gs4 /config/usb_gadget/g1/configs/b.1/f1
+    symlink /config/usb_gadget/g1/functions/ffs.adb /config/usb_gadget/g1/configs/b.1/f2
+    write /config/usb_gadget/g1/UDC ${sys.usb.controller}
+    setprop sys.usb.state ${sys.usb.config}
diff --git a/core/rootdir/cells/system/hw/init.usb.rc b/core/rootdir/cells/system/hw/init.usb.rc
new file mode 100644
index 0000000..0730cce
--- /dev/null
+++ b/core/rootdir/cells/system/hw/init.usb.rc
@@ -0,0 +1,144 @@
+# Copyright (C) 2012 The Android Open Source Project
+#
+# USB configuration common for all android devices
+#
+
+on post-fs-data
+    chown system system /sys/class/android_usb/android0/f_mass_storage/lun/file
+    chmod 0660 /sys/class/android_usb/android0/f_mass_storage/lun/file
+    chown system system /sys/class/android_usb/android0/f_rndis/ethaddr
+    chmod 0660 /sys/class/android_usb/android0/f_rndis/ethaddr
+    mkdir /data/misc/adb 02750 system shell
+    mkdir /data/adb 0700 root root encryption=Require
+
+# adbd is controlled via property triggers in init.<platform>.usb.rc
+service adbd /system/bin/adbd --root_seclabel=u:r:su:s0
+    class core
+    socket adbd seqpacket 660 system system
+    disabled
+    updatable
+    seclabel u:r:adbd:s0
+
+on property:vendor.sys.usb.adb.disabled=*
+    setprop sys.usb.adb.disabled ${vendor.sys.usb.adb.disabled}
+
+# Set default value on sys.usb.configfs early in boot sequence. It will be
+# overridden in `on boot` action of init.hardware.rc.
+on init
+    setprop sys.usb.configfs 0
+
+# Used to disable USB when switching states
+on property:sys.usb.config=none && property:sys.usb.configfs=0
+    stop adbd
+    write /sys/class/android_usb/android0/enable 0
+    write /sys/class/android_usb/android0/bDeviceClass 0
+    setprop sys.usb.state ${sys.usb.config}
+
+# adb only USB configuration
+# This is the fallback configuration if the
+# USB manager fails to set a standard configuration
+on property:sys.usb.config=adb && property:sys.usb.configfs=0
+    write /sys/class/android_usb/android0/enable 0
+    write /sys/class/android_usb/android0/idVendor 18d1
+    write /sys/class/android_usb/android0/idProduct 4EE7
+    write /sys/class/android_usb/android0/functions ${sys.usb.config}
+    write /sys/class/android_usb/android0/enable 1
+    start adbd
+    setprop sys.usb.state ${sys.usb.config}
+
+# USB accessory configuration
+on property:sys.usb.config=accessory && property:sys.usb.configfs=0
+    write /sys/class/android_usb/android0/enable 0
+    write /sys/class/android_usb/android0/idVendor 18d1
+    write /sys/class/android_usb/android0/idProduct 2d00
+    write /sys/class/android_usb/android0/functions ${sys.usb.config}
+    write /sys/class/android_usb/android0/enable 1
+    setprop sys.usb.state ${sys.usb.config}
+
+# USB accessory configuration, with adb
+on property:sys.usb.config=accessory,adb && property:sys.usb.configfs=0
+    write /sys/class/android_usb/android0/enable 0
+    write /sys/class/android_usb/android0/idVendor 18d1
+    write /sys/class/android_usb/android0/idProduct 2d01
+    write /sys/class/android_usb/android0/functions ${sys.usb.config}
+    write /sys/class/android_usb/android0/enable 1
+    start adbd
+    setprop sys.usb.state ${sys.usb.config}
+
+# audio accessory configuration
+on property:sys.usb.config=audio_source && property:sys.usb.configfs=0
+    write /sys/class/android_usb/android0/enable 0
+    write /sys/class/android_usb/android0/idVendor 18d1
+    write /sys/class/android_usb/android0/idProduct 2d02
+    write /sys/class/android_usb/android0/functions ${sys.usb.config}
+    write /sys/class/android_usb/android0/enable 1
+    setprop sys.usb.state ${sys.usb.config}
+
+# audio accessory configuration, with adb
+on property:sys.usb.config=audio_source,adb && property:sys.usb.configfs=0
+    write /sys/class/android_usb/android0/enable 0
+    write /sys/class/android_usb/android0/idVendor 18d1
+    write /sys/class/android_usb/android0/idProduct 2d03
+    write /sys/class/android_usb/android0/functions ${sys.usb.config}
+    write /sys/class/android_usb/android0/enable 1
+    start adbd
+    setprop sys.usb.state ${sys.usb.config}
+
+# USB and audio accessory configuration
+on property:sys.usb.config=accessory,audio_source && property:sys.usb.configfs=0
+    write /sys/class/android_usb/android0/enable 0
+    write /sys/class/android_usb/android0/idVendor 18d1
+    write /sys/class/android_usb/android0/idProduct 2d04
+    write /sys/class/android_usb/android0/functions ${sys.usb.config}
+    write /sys/class/android_usb/android0/enable 1
+    setprop sys.usb.state ${sys.usb.config}
+
+# USB and audio accessory configuration, with adb
+on property:sys.usb.config=accessory,audio_source,adb && property:sys.usb.configfs=0
+    write /sys/class/android_usb/android0/enable 0
+    write /sys/class/android_usb/android0/idVendor 18d1
+    write /sys/class/android_usb/android0/idProduct 2d05
+    write /sys/class/android_usb/android0/functions ${sys.usb.config}
+    write /sys/class/android_usb/android0/enable 1
+    start adbd
+    setprop sys.usb.state ${sys.usb.config}
+
+# Used to set USB configuration at boot and to switch the configuration
+# when changing the default configuration
+on boot && property:persist.sys.usb.config=*
+    setprop sys.usb.config ${persist.sys.usb.config}
+
+#
+# USB type C
+#
+
+# USB mode changes
+on property:sys.usb.typec.mode=dfp
+    write /sys/class/dual_role_usb/otg_default/mode ${sys.usb.typec.mode}
+    setprop sys.usb.typec.state ${sys.usb.typec.mode}
+
+on property:sys.usb.typec.mode=ufp
+    write /sys/class/dual_role_usb/otg_default/mode ${sys.usb.typec.mode}
+    setprop sys.usb.typec.state ${sys.usb.typec.mode}
+
+# USB data role changes
+on property:sys.usb.typec.data_role=device
+    write /sys/class/dual_role_usb/otg_default/data_role ${sys.usb.typec.data_role}
+    setprop sys.usb.typec.state ${sys.usb.typec.data_role}
+
+on property:sys.usb.typec.data_role=host
+    write /sys/class/dual_role_usb/otg_default/data_role ${sys.usb.typec.data_role}
+    setprop sys.usb.typec.state ${sys.usb.typec.data_role}
+
+# USB power role changes
+on property:sys.usb.typec.power_role=source
+    write /sys/class/dual_role_usb/otg_default/power_role ${sys.usb.typec.power_role}
+    setprop sys.usb.typec.state ${sys.usb.typec.power_role}
+
+on property:sys.usb.typec.power_role=sink
+    write /sys/class/dual_role_usb/otg_default/power_role ${sys.usb.typec.power_role}
+    setprop sys.usb.typec.state ${sys.usb.typec.power_role}
+
+on userspace-reboot-requested
+  setprop sys.usb.config ""
+  setprop sys.usb.state ""
diff --git a/core/rootdir/cells/system/hw/init.zygote32.rc b/core/rootdir/cells/system/hw/init.zygote32.rc
new file mode 100644
index 0000000..9469a48
--- /dev/null
+++ b/core/rootdir/cells/system/hw/init.zygote32.rc
@@ -0,0 +1,16 @@
+service zygote /system/bin/app_process -Xzygote /system/bin --zygote --start-system-server
+    class main
+    priority -20
+    user root
+    group root readproc reserved_disk
+    socket zygote stream 660 root system
+    socket usap_pool_primary stream 660 root system
+    onrestart exec_background - system system -- /system/bin/vdc volume abort_fuse
+    onrestart write /sys/power/state on
+    onrestart restart audioserver
+    onrestart restart cameraserver
+    onrestart restart media
+    onrestart restart netd
+    onrestart restart wificond
+    writepid /dev/cpuset/foreground/tasks
+    critical window=${zygote.critical_window.minute:-off} target=zygote-fatal
diff --git a/core/rootdir/cells/system/hw/init.zygote64.rc b/core/rootdir/cells/system/hw/init.zygote64.rc
new file mode 100644
index 0000000..98dc088
--- /dev/null
+++ b/core/rootdir/cells/system/hw/init.zygote64.rc
@@ -0,0 +1,16 @@
+service zygote /system/bin/app_process64 -Xzygote /system/bin --zygote --start-system-server
+    class main
+    priority -20
+    user root
+    group root readproc reserved_disk
+    socket zygote stream 660 root system
+    socket usap_pool_primary stream 660 root system
+    onrestart exec_background - system system -- /system/bin/vdc volume abort_fuse
+    onrestart write /sys/power/state on
+    onrestart restart audioserver
+    onrestart restart cameraserver
+    onrestart restart media
+    onrestart restart netd
+    onrestart restart wificond
+    writepid /dev/cpuset/foreground/tasks
+    critical window=${zygote.critical_window.minute:-off} target=zygote-fatal
diff --git a/core/rootdir/cells/system/hw/init.zygote64_32.rc b/core/rootdir/cells/system/hw/init.zygote64_32.rc
new file mode 100644
index 0000000..3eee180
--- /dev/null
+++ b/core/rootdir/cells/system/hw/init.zygote64_32.rc
@@ -0,0 +1,26 @@
+service zygote /system/bin/app_process64 -Xzygote /system/bin --zygote --start-system-server --socket-name=zygote
+    class main
+    priority -20
+    user root
+    group root readproc reserved_disk
+    socket zygote stream 660 root system
+    socket usap_pool_primary stream 660 root system
+    onrestart exec_background - system system -- /system/bin/vdc volume abort_fuse
+    onrestart write /sys/power/state on
+    onrestart restart audioserver
+    onrestart restart cameraserver
+    onrestart restart media
+    onrestart restart netd
+    onrestart restart wificond
+    task_profiles ProcessCapacityHigh MaxPerformance
+    critical window=${zygote.critical_window.minute:-off} target=zygote-fatal
+
+service zygote_secondary /system/bin/app_process32 -Xzygote /system/bin --zygote --socket-name=zygote_secondary --enable-lazy-preload
+    class main
+    priority -20
+    user root
+    group root readproc reserved_disk
+    socket zygote_secondary stream 660 root system
+    socket usap_pool_secondary stream 660 root system
+    onrestart restart zygote
+    task_profiles ProcessCapacityHigh MaxPerformance
diff --git a/core/rootdir/cells/system/hwservicemanager.rc b/core/rootdir/cells/system/hwservicemanager.rc
new file mode 100644
index 0000000..2a70afd
--- /dev/null
+++ b/core/rootdir/cells/system/hwservicemanager.rc
@@ -0,0 +1,12 @@
+service hwservicemanager /system/bin/hwservicemanager
+    user system
+    disabled
+    group system readproc
+    critical
+    onrestart setprop hwservicemanager.ready false
+    onrestart class_restart main
+    onrestart class_restart hal
+    onrestart class_restart early_hal
+    task_profiles ServiceCapacityLow HighPerformance
+    class animation
+    shutdown critical
diff --git a/core/rootdir/cells/system/idmap2d.rc b/core/rootdir/cells/system/idmap2d.rc
new file mode 100644
index 0000000..203e7be
--- /dev/null
+++ b/core/rootdir/cells/system/idmap2d.rc
@@ -0,0 +1,4 @@
+service idmap2d /system/bin/idmap2d
+    class main
+    user system
+    group system
diff --git a/core/rootdir/cells/system/incidentd.rc b/core/rootdir/cells/system/incidentd.rc
new file mode 100644
index 0000000..9c16a1c
--- /dev/null
+++ b/core/rootdir/cells/system/incidentd.rc
@@ -0,0 +1,23 @@
+# Copyright (C) 2016 The Android Open Source Project
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#      http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+
+service incidentd /system/bin/incidentd
+    class main
+    user incidentd
+    group incidentd log readproc
+    capabilities KILL SYS_PTRACE
+
+on post-fs-data
+    # Create directory for incidentd
+    mkdir /data/misc/incidents 0770 incidentd incidentd
diff --git a/core/rootdir/cells/system/init-debug.rc b/core/rootdir/cells/system/init-debug.rc
new file mode 100644
index 0000000..77a80cd
--- /dev/null
+++ b/core/rootdir/cells/system/init-debug.rc
@@ -0,0 +1,16 @@
+on property:persist.mmc.max_read_speed=*
+    write /sys/block/mmcblk0/max_read_speed ${persist.mmc.max_read_speed}
+
+on property:persist.mmc.max_write_speed=*
+    write /sys/block/mmcblk0/max_write_speed ${persist.mmc.max_write_speed}
+
+on property:persist.mmc.cache_size=*
+    write /sys/block/mmcblk0/cache_size ${persist.mmc.cache_size}
+
+on early-init && property:ro.product.debugfs_restrictions.enabled=true
+    mount debugfs debugfs /sys/kernel/debug
+    chmod 0755 /sys/kernel/debug
+
+on property:sys.boot_completed=1 && property:ro.product.debugfs_restrictions.enabled=true && \
+   property:persist.dbg.keep_debugfs_mounted=""
+   umount /sys/kernel/debug
diff --git a/core/rootdir/cells/system/installd.rc b/core/rootdir/cells/system/installd.rc
new file mode 100644
index 0000000..240aa49
--- /dev/null
+++ b/core/rootdir/cells/system/installd.rc
@@ -0,0 +1,103 @@
+
+service installd /system/bin/installd
+    class main
+
+on early-boot
+    mkdir /config/sdcardfs/extensions/1055
+    mkdir /config/sdcardfs/extensions/1056
+    mkdir /config/sdcardfs/extensions/1057
+    mkdir /config/sdcardfs/extensions/1056/3gpp
+    mkdir /config/sdcardfs/extensions/1056/3gp
+    mkdir /config/sdcardfs/extensions/1056/3gpp2
+    mkdir /config/sdcardfs/extensions/1056/3g2
+    mkdir /config/sdcardfs/extensions/1056/avi
+    mkdir /config/sdcardfs/extensions/1056/dl
+    mkdir /config/sdcardfs/extensions/1056/dif
+    mkdir /config/sdcardfs/extensions/1056/dv
+    mkdir /config/sdcardfs/extensions/1056/fli
+    mkdir /config/sdcardfs/extensions/1056/m4v
+    mkdir /config/sdcardfs/extensions/1056/ts
+    mkdir /config/sdcardfs/extensions/1056/mpeg
+    mkdir /config/sdcardfs/extensions/1056/mpg
+    mkdir /config/sdcardfs/extensions/1056/mpe
+    mkdir /config/sdcardfs/extensions/1056/mp4
+    mkdir /config/sdcardfs/extensions/1056/vob
+    mkdir /config/sdcardfs/extensions/1056/qt
+    mkdir /config/sdcardfs/extensions/1056/mov
+    mkdir /config/sdcardfs/extensions/1056/mxu
+    mkdir /config/sdcardfs/extensions/1056/webm
+    mkdir /config/sdcardfs/extensions/1056/lsf
+    mkdir /config/sdcardfs/extensions/1056/lsx
+    mkdir /config/sdcardfs/extensions/1056/mkv
+    mkdir /config/sdcardfs/extensions/1056/mng
+    mkdir /config/sdcardfs/extensions/1056/asf
+    mkdir /config/sdcardfs/extensions/1056/asx
+    mkdir /config/sdcardfs/extensions/1056/wm
+    mkdir /config/sdcardfs/extensions/1056/wmv
+    mkdir /config/sdcardfs/extensions/1056/wmx
+    mkdir /config/sdcardfs/extensions/1056/wvx
+    mkdir /config/sdcardfs/extensions/1056/movie
+    mkdir /config/sdcardfs/extensions/1056/wrf
+    mkdir /config/sdcardfs/extensions/1057/bmp
+    mkdir /config/sdcardfs/extensions/1057/gif
+    mkdir /config/sdcardfs/extensions/1057/jpg
+    mkdir /config/sdcardfs/extensions/1057/jpeg
+    mkdir /config/sdcardfs/extensions/1057/jpe
+    mkdir /config/sdcardfs/extensions/1057/pcx
+    mkdir /config/sdcardfs/extensions/1057/png
+    mkdir /config/sdcardfs/extensions/1057/svg
+    mkdir /config/sdcardfs/extensions/1057/svgz
+    mkdir /config/sdcardfs/extensions/1057/tiff
+    mkdir /config/sdcardfs/extensions/1057/tif
+    mkdir /config/sdcardfs/extensions/1057/wbmp
+    mkdir /config/sdcardfs/extensions/1057/webp
+    mkdir /config/sdcardfs/extensions/1057/dng
+    mkdir /config/sdcardfs/extensions/1057/cr2
+    mkdir /config/sdcardfs/extensions/1057/ras
+    mkdir /config/sdcardfs/extensions/1057/art
+    mkdir /config/sdcardfs/extensions/1057/jng
+    mkdir /config/sdcardfs/extensions/1057/nef
+    mkdir /config/sdcardfs/extensions/1057/nrw
+    mkdir /config/sdcardfs/extensions/1057/orf
+    mkdir /config/sdcardfs/extensions/1057/rw2
+    mkdir /config/sdcardfs/extensions/1057/pef
+    mkdir /config/sdcardfs/extensions/1057/psd
+    mkdir /config/sdcardfs/extensions/1057/pnm
+    mkdir /config/sdcardfs/extensions/1057/pbm
+    mkdir /config/sdcardfs/extensions/1057/pgm
+    mkdir /config/sdcardfs/extensions/1057/ppm
+    mkdir /config/sdcardfs/extensions/1057/srw
+    mkdir /config/sdcardfs/extensions/1057/arw
+    mkdir /config/sdcardfs/extensions/1057/rgb
+    mkdir /config/sdcardfs/extensions/1057/xbm
+    mkdir /config/sdcardfs/extensions/1057/xpm
+    mkdir /config/sdcardfs/extensions/1057/xwd
+    mkdir /config/sdcardfs/extensions/1055/aac
+    mkdir /config/sdcardfs/extensions/1055/aac
+    mkdir /config/sdcardfs/extensions/1055/amr
+    mkdir /config/sdcardfs/extensions/1055/awb
+    mkdir /config/sdcardfs/extensions/1055/snd
+    mkdir /config/sdcardfs/extensions/1055/flac
+    mkdir /config/sdcardfs/extensions/1055/flac
+    mkdir /config/sdcardfs/extensions/1055/mp3
+    mkdir /config/sdcardfs/extensions/1055/mpga
+    mkdir /config/sdcardfs/extensions/1055/mpega
+    mkdir /config/sdcardfs/extensions/1055/mp2
+    mkdir /config/sdcardfs/extensions/1055/m4a
+    mkdir /config/sdcardfs/extensions/1055/aif
+    mkdir /config/sdcardfs/extensions/1055/aiff
+    mkdir /config/sdcardfs/extensions/1055/aifc
+    mkdir /config/sdcardfs/extensions/1055/gsm
+    mkdir /config/sdcardfs/extensions/1055/mka
+    mkdir /config/sdcardfs/extensions/1055/m3u
+    mkdir /config/sdcardfs/extensions/1055/wma
+    mkdir /config/sdcardfs/extensions/1055/wax
+    mkdir /config/sdcardfs/extensions/1055/ra
+    mkdir /config/sdcardfs/extensions/1055/rm
+    mkdir /config/sdcardfs/extensions/1055/ram
+    mkdir /config/sdcardfs/extensions/1055/ra
+    mkdir /config/sdcardfs/extensions/1055/pls
+    mkdir /config/sdcardfs/extensions/1055/sd2
+    mkdir /config/sdcardfs/extensions/1055/wav
+    mkdir /config/sdcardfs/extensions/1055/ogg
+    mkdir /config/sdcardfs/extensions/1055/oga
diff --git a/core/rootdir/cells/system/iorapd.rc b/core/rootdir/cells/system/iorapd.rc
new file mode 100644
index 0000000..cb887ac
--- /dev/null
+++ b/core/rootdir/cells/system/iorapd.rc
@@ -0,0 +1,38 @@
+# Copyright (C) 2018 The Android Open Source Project
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#      http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+
+service iorapd /system/bin/iorapd
+    class main
+    disabled
+    user iorapd
+    group iorapd
+    capabilities DAC_READ_SEARCH
+    writepid /dev/cpuset/system-background/tasks
+# TODO: should this be something else like performance/tasks?
+# the main 'activity hint' thread needs to be fairly high priority to kick off
+# tracing or prefetching asap.
+
+on property:ro.iorapd.enable=false
+    stop iorapd
+
+on post-fs-data
+    # Create directory for iorapd (see iorapd_data_file in selinux file_contexts).
+    mkdir /data/misc/iorapd/ 0750 iorapd system
+
+# Start iorapd when either prefetching or tracing is enabled.
+on property:persist.device_config.runtime_native_boot.iorap_perfetto_enable=true && property:ro.iorapd.enable=true
+    start iorapd
+
+on property:persist.device_config.runtime_native_boot.iorap_readahead_enable=true && property:ro.iorapd.enable=true
+    start iorapd
diff --git a/core/rootdir/cells/system/keystore2.rc b/core/rootdir/cells/system/keystore2.rc
new file mode 100644
index 0000000..82bf3b8
--- /dev/null
+++ b/core/rootdir/cells/system/keystore2.rc
@@ -0,0 +1,13 @@
+# Start the keystore2 service.
+# Keystore 2.0 changes its working directory to the first positional
+# command line option, i.e., /data/misc/keystore, where it stores its
+# database.
+# Keystore shall run as user keystore and groups keystore, readproc, and log.
+#
+# See system/core/init/README.md for information on the init.rc language.
+
+service keystore2 /system/bin/keystore2 /data/misc/keystore
+    class early_hal
+    user keystore
+    group keystore readproc log
+    writepid /dev/cpuset/foreground/tasks
diff --git a/core/rootdir/cells/system/llkd-debuggable.rc b/core/rootdir/cells/system/llkd-debuggable.rc
new file mode 100644
index 0000000..c075609
--- /dev/null
+++ b/core/rootdir/cells/system/llkd-debuggable.rc
@@ -0,0 +1,19 @@
+on property:ro.debuggable=1
+    setprop llk.enable ${ro.llk.enable:-0}
+    setprop khungtask.enable ${ro.khungtask.enable:-1}
+
+on property:ro.llk.enable=eng
+    setprop llk.enable ${ro.debuggable:-0}
+
+on property:ro.khungtask.enable=eng
+    setprop khungtask.enable ${ro.debuggable:-0}
+
+service llkd-1 /system/bin/llkd
+    class late_start
+    disabled
+    user llkd
+    group llkd readproc
+    capabilities KILL IPC_LOCK SYS_PTRACE DAC_OVERRIDE SYS_ADMIN
+    file /dev/kmsg w
+    file /proc/sysrq-trigger w
+    writepid /dev/cpuset/system-background/tasks
diff --git a/core/rootdir/cells/system/llkd.rc b/core/rootdir/cells/system/llkd.rc
new file mode 100644
index 0000000..b1f96a8
--- /dev/null
+++ b/core/rootdir/cells/system/llkd.rc
@@ -0,0 +1,45 @@
+# eng default for ro.llk.enable and ro.khungtask.enable
+on property:ro.debuggable=*
+    setprop llk.enable ${ro.llk.enable:-0}
+    setprop khungtask.enable ${ro.khungtask.enable:-0}
+
+on property:ro.llk.enable=true
+    setprop llk.enable true
+
+on property:llk.enable=1
+    setprop llk.enable true
+
+on property:llk.enable=0
+    setprop llk.enable false
+
+on property:ro.khungtask.enable=true
+    setprop khungtask.enable true
+
+on property:khungtask.enable=1
+    setprop khungtask.enable true
+
+on property:khungtask.enable=0
+    setprop khungtask.enable false
+
+# Configure [khungtaskd]
+on property:khungtask.enable=true
+    write /proc/sys/kernel/hung_task_timeout_secs ${ro.khungtask.timeout:-720}
+    write /proc/sys/kernel/hung_task_warnings 65535
+    write /proc/sys/kernel/hung_task_check_count 65535
+    write /proc/sys/kernel/hung_task_panic 1
+
+on property:khungtask.enable=false
+    write /proc/sys/kernel/hung_task_panic 0
+
+on property:llk.enable=true
+    start llkd-${ro.debuggable:-0}
+
+service llkd-0 /system/bin/llkd
+    class late_start
+    disabled
+    user llkd
+    group llkd readproc
+    capabilities KILL IPC_LOCK
+    file /dev/kmsg w
+    file /proc/sysrq-trigger w
+    writepid /dev/cpuset/system-background/tasks
diff --git a/core/rootdir/cells/system/lmkd.rc b/core/rootdir/cells/system/lmkd.rc
new file mode 100644
index 0000000..6f90bcb
--- /dev/null
+++ b/core/rootdir/cells/system/lmkd.rc
@@ -0,0 +1,51 @@
+service lmkd /system/bin/lmkd
+    class core
+    user lmkd
+    group lmkd system readproc
+    capabilities DAC_OVERRIDE KILL IPC_LOCK SYS_NICE SYS_RESOURCE
+    critical
+    socket lmkd seqpacket+passcred 0660 system system
+    writepid /dev/cpuset/system-background/tasks
+
+on property:lmkd.reinit=1
+    exec_background /system/bin/lmkd --reinit
+
+# reinitialize lmkd after device finished booting if experiments set any flags during boot
+on property:sys.boot_completed=1 && property:lmkd.reinit=0
+    setprop lmkd.reinit 1
+
+# properties most likely to be used in experiments
+# setting persist.device_config.* property either triggers immediate lmkd re-initialization
+# if the device finished booting or sets lmkd.reinit=0 to re-initialize lmkd after boot completes
+on property:persist.device_config.lmkd_native.debug=*
+    setprop lmkd.reinit ${sys.boot_completed:-0}
+
+on property:persist.device_config.lmkd_native.kill_heaviest_task=*
+    setprop lmkd.reinit ${sys.boot_completed:-0}
+
+on property:persist.device_config.lmkd_native.kill_timeout_ms=*
+    setprop lmkd.reinit ${sys.boot_completed:-0}
+
+on property:persist.device_config.lmkd_native.swap_free_low_percentage=*
+    setprop lmkd.reinit ${sys.boot_completed:-0}
+
+on property:persist.device_config.lmkd_native.psi_partial_stall_ms=*
+    setprop lmkd.reinit ${sys.boot_completed:-0}
+
+on property:persist.device_config.lmkd_native.psi_complete_stall_ms=*
+    setprop lmkd.reinit ${sys.boot_completed:-0}
+
+on property:persist.device_config.lmkd_native.thrashing_limit=*
+    setprop lmkd.reinit ${sys.boot_completed:-0}
+
+on property:persist.device_config.lmkd_native.thrashing_limit_decay=*
+    setprop lmkd.reinit ${sys.boot_completed:-0}
+
+on property:persist.device_config.lmkd_native.thrashing_limit_critical=*
+    setprop lmkd.reinit ${sys.boot_completed:-0}
+
+on property:persist.device_config.lmkd_native.swap_util_max=*
+    setprop lmkd.reinit ${sys.boot_completed:-0}
+
+on property:persist.device_config.lmkd_native.filecache_min_kb=*
+    setprop lmkd.reinit ${sys.boot_completed:-0}
diff --git a/core/rootdir/cells/system/logcatd.rc b/core/rootdir/cells/system/logcatd.rc
new file mode 100644
index 0000000..64d5500
--- /dev/null
+++ b/core/rootdir/cells/system/logcatd.rc
@@ -0,0 +1,62 @@
+#
+# init scriptures for logcatd persistent logging.
+#
+# Make sure any property changes are only performed with /data mounted, after
+# post-fs-data state because otherwise behavior is undefined. The exceptions
+# are device adjustments for logcatd service properties (persist.* overrides
+# notwithstanding) for logd.logpersistd.size logd.logpersistd.rotate_kbytes and
+# logd.logpersistd.buffer.
+
+# persist to non-persistent trampolines to permit device properties can be
+# overridden when /data mounts, or during runtime.
+on property:persist.logd.logpersistd.count=*
+    # expect /init to report failure if property empty (default)
+    setprop persist.logd.logpersistd.size ${persist.logd.logpersistd.count}
+
+on property:persist.logd.logpersistd.size=*
+    setprop logd.logpersistd.size ${persist.logd.logpersistd.size}
+
+on property:persist.logd.logpersistd.rotate_kbytes=*
+    setprop logd.logpersistd.rotate_kbytes ${persist.logd.logpersistd.rotate_kbytes}
+
+on property:persist.logd.logpersistd.buffer=*
+    setprop logd.logpersistd.buffer ${persist.logd.logpersistd.buffer}
+
+on property:persist.logd.logpersistd=logcatd
+    setprop logd.logpersistd logcatd
+
+# enable, prep and start logcatd service
+on load_persist_props_action
+    setprop logd.logpersistd.enable true
+
+on property:logd.logpersistd.enable=true && property:logd.logpersistd=logcatd
+    # log group should be able to read persisted logs
+    mkdir /data/misc/logd 0750 logd log
+    start logcatd
+
+# stop logcatd service and clear data
+on property:logd.logpersistd.enable=true && property:logd.logpersistd=clear
+    setprop persist.logd.logpersistd ""
+    stop logcatd
+    # logd for clear of only our files in /data/misc/logd
+    exec - logd log -- /system/bin/logcat -c -f /data/misc/logd/logcat -n ${logd.logpersistd.size:-256}
+    setprop logd.logpersistd ""
+
+# stop logcatd service
+on property:logd.logpersistd=stop
+    setprop persist.logd.logpersistd ""
+    stop logcatd
+    setprop logd.logpersistd ""
+
+on property:logd.logpersistd.enable=false
+    stop logcatd
+
+# logcatd service
+service logcatd /system/bin/logcatd -L -b ${logd.logpersistd.buffer:-all} -v threadtime -v usec -v printable -D -f /data/misc/logd/logcat -r ${logd.logpersistd.rotate_kbytes:-2048} -n ${logd.logpersistd.size:-256} --id=${ro.build.id}
+    class late_start
+    disabled
+    # logd for write to /data/misc/logd, log group for read from log daemon
+    user logd
+    group log
+    writepid /dev/cpuset/system-background/tasks
+    oom_score_adjust -600
diff --git a/core/rootdir/cells/system/logd.rc b/core/rootdir/cells/system/logd.rc
new file mode 100644
index 0000000..c8c599b
--- /dev/null
+++ b/core/rootdir/cells/system/logd.rc
@@ -0,0 +1,35 @@
+service logd /system/bin/logd
+    socket logd stream 0666 logd logd
+    socket logdr seqpacket 0666 logd logd
+    socket logdw dgram+passcred 0222 logd logd
+    file /proc/kmsg r
+    file /dev/kmsg w
+    user logd
+    group logd system package_info readproc
+    capabilities SYSLOG AUDIT_CONTROL
+    priority 10
+    writepid /dev/cpuset/system-background/tasks
+
+service logd-reinit /system/bin/logd --reinit
+    oneshot
+    disabled
+    user logd
+    group logd
+    writepid /dev/cpuset/system-background/tasks
+
+# Limit SELinux denial generation to 5/second
+#service logd-auditctl /system/bin/auditctl -r 5
+#    oneshot
+#    disabled
+#    user logd
+#    group logd
+#    capabilities AUDIT_CONTROL
+
+on fs
+    write /dev/event-log-tags "# content owned by logd
+"
+    chown logd logd /dev/event-log-tags
+    chmod 0644 /dev/event-log-tags
+
+on property:sys.boot_completed=1
+    start logd-auditctl
diff --git a/core/rootdir/cells/system/logtagd.rc b/core/rootdir/cells/system/logtagd.rc
new file mode 100644
index 0000000..248a78c
--- /dev/null
+++ b/core/rootdir/cells/system/logtagd.rc
@@ -0,0 +1,9 @@
+#
+# logtagd event log tag service (debug only)
+#
+on post-fs-data
+    mkdir /data/misc/logd 0750 logd log
+    write /data/misc/logd/event-log-tags ""
+    chown logd log /data/misc/logd/event-log-tags
+    chmod 0600 /data/misc/logd/event-log-tags
+    restorecon /data/misc/logd/event-log-tags
diff --git a/core/rootdir/cells/system/lpdumpd.rc b/core/rootdir/cells/system/lpdumpd.rc
new file mode 100644
index 0000000..46ef5b3
--- /dev/null
+++ b/core/rootdir/cells/system/lpdumpd.rc
@@ -0,0 +1,35 @@
+#
+# Copyright (C) 2019 The Android Open Source Project
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#      http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+#
+
+service lpdumpd /system/bin/lpdumpd
+    # TODO(b/129011369): make this killable by lmkd
+    oneshot
+    disabled
+    user system
+    group system
+    # On Launch devices, assume "super". On virtual devices, ${ro.boot.super_partition}
+    # might be something else.
+    file /dev/block/by-name/${ro.boot.super_partition:-super} r
+    # On retrofit devices, ${ro.boot.super_partition} is slot-suffixed.
+    # Use NO_SUCH_DEVICE_NO_SUCH_SUFFIX as default values so that host_init_verifier does
+    # not complain about missing sysprops
+    file /dev/block/by-name/${ro.boot.super_partition:-NO_SUCH_DEVICE}${ro.boot.slot_suffix:-_NO_SUCH_SUFFIX} r
+
+on property:sys.lpdumpd=start
+    start lpdumpd
+
+on property:sys.lpdumpd=stop
+    stop lpdumpd
diff --git a/core/rootdir/cells/system/mdnsd.rc b/core/rootdir/cells/system/mdnsd.rc
new file mode 100644
index 0000000..0696ac5
--- /dev/null
+++ b/core/rootdir/cells/system/mdnsd.rc
@@ -0,0 +1,7 @@
+service mdnsd /system/bin/mdnsd
+    class main
+    user mdnsr
+    group inet
+    socket mdnsd stream 0660 mdnsr inet
+    disabled
+    oneshot
diff --git a/core/rootdir/cells/system/mediaextractor.rc b/core/rootdir/cells/system/mediaextractor.rc
new file mode 100644
index 0000000..5fc2941
--- /dev/null
+++ b/core/rootdir/cells/system/mediaextractor.rc
@@ -0,0 +1,6 @@
+service mediaextractor /system/bin/mediaextractor
+    class main
+    user mediaex
+    group drmrpc mediadrm
+    ioprio rt 4
+    writepid /dev/cpuset/foreground/tasks
diff --git a/core/rootdir/cells/system/mediametrics.rc b/core/rootdir/cells/system/mediametrics.rc
new file mode 100644
index 0000000..2a6c817
--- /dev/null
+++ b/core/rootdir/cells/system/mediametrics.rc
@@ -0,0 +1,6 @@
+service mediametrics /system/bin/mediametrics
+    class main
+    user media
+    group media
+    ioprio rt 4
+    task_profiles ProcessCapacityHigh HighPerformance
diff --git a/core/rootdir/cells/system/mediaserver.rc b/core/rootdir/cells/system/mediaserver.rc
new file mode 100644
index 0000000..05373c9
--- /dev/null
+++ b/core/rootdir/cells/system/mediaserver.rc
@@ -0,0 +1,9 @@
+on property:init.svc.media=*
+    setprop init.svc.mediadrm ${init.svc.media}
+
+service media /system/bin/mediaserver
+    class main
+    user media
+    group audio camera inet net_bt net_bt_admin net_bw_acct drmrpc mediadrm
+    ioprio rt 4
+    task_profiles ProcessCapacityHigh HighPerformance
diff --git a/core/rootdir/cells/system/mtpd.rc b/core/rootdir/cells/system/mtpd.rc
new file mode 100644
index 0000000..af701d5
--- /dev/null
+++ b/core/rootdir/cells/system/mtpd.rc
@@ -0,0 +1,8 @@
+service mtpd /system/bin/mtpd
+    class main
+    socket mtpd stream 600 system system
+    user vpn
+    group vpn inet
+    capabilities NET_ADMIN NET_RAW
+    disabled
+    oneshot
diff --git a/core/rootdir/cells/system/netd.rc b/core/rootdir/cells/system/netd.rc
new file mode 100644
index 0000000..e6316c1
--- /dev/null
+++ b/core/rootdir/cells/system/netd.rc
@@ -0,0 +1,12 @@
+service netd /system/bin/netd
+    class main
+    capabilities CHOWN DAC_OVERRIDE DAC_READ_SEARCH FOWNER IPC_LOCK KILL NET_ADMIN NET_BIND_SERVICE NET_RAW SETUID SETGID
+    socket dnsproxyd stream 0660 root inet
+    socket mdns stream 0660 root system
+    socket fwmarkd stream 0660 root inet
+    onrestart restart zygote
+    onrestart restart zygote_secondary
+    # b/121354779: netd itself is not updatable, but on startup it dlopen()s the resolver library
+    # from the DNS resolver APEX. Mark it as updatable so init won't start it until all APEX
+    # packages are ready.
+    updatable
diff --git a/core/rootdir/cells/system/odsign.rc b/core/rootdir/cells/system/odsign.rc
new file mode 100644
index 0000000..de09fc0
--- /dev/null
+++ b/core/rootdir/cells/system/odsign.rc
@@ -0,0 +1,9 @@
+service odsign /system/bin/odsign
+    class core
+    user root
+    group system
+    disabled # does not start with the core class
+
+# Note that odsign is not oneshot, but stopped manually when it exits. This
+# ensures that if odsign crashes during a module update, apexd will detect
+# those crashes and roll back the update.
diff --git a/core/rootdir/cells/system/otapreopt.rc b/core/rootdir/cells/system/otapreopt.rc
new file mode 100644
index 0000000..059ae75
--- /dev/null
+++ b/core/rootdir/cells/system/otapreopt.rc
@@ -0,0 +1,8 @@
+# When /data is available, look for A/B artifacts for the current slot and move them
+# into the dalvik-cache (relabeling them).
+on post-fs-data
+    exec - root -- /system/bin/otapreopt_slot
+    # The dalvik-cache was not moved itself, so as to restrict the rights of otapreopt_slot.
+    # But now the relabeling is annoying as there is no force option available here. So
+    # explicitly list all the ISAs we know.
+    restorecon_recursive /data/dalvik-cache/arm /data/dalvik-cache/arm64 /data/dalvik-cache/mips /data/dalvik-cache/mips64 /data/dalvik-cache/x86 /data/dalvik-cache/x86_64
diff --git a/core/rootdir/cells/system/perfetto.rc b/core/rootdir/cells/system/perfetto.rc
new file mode 100644
index 0000000..11cc42e
--- /dev/null
+++ b/core/rootdir/cells/system/perfetto.rc
@@ -0,0 +1,92 @@
+# Copyright (C) 2017 The Android Open Source Project
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#      http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+
+service traced /system/bin/traced
+    class late_start
+    disabled
+    socket traced_consumer stream 0666 root root
+    socket traced_producer stream 0666 root root
+    user nobody
+    group nobody
+    writepid /dev/cpuset/system-background/tasks
+
+service traced_probes /system/bin/traced_probes
+    class late_start
+    disabled
+    user nobody
+    # Despite the "log" group below, traced_probes is allowed to read log
+    # only on userdebug/eng via selinux (see traced_probes.te).
+    group nobody readproc log readtracefs
+    writepid /dev/cpuset/system-background/tasks
+    # Clean up procfs configuration even if traced_probes crashes
+    # unexpectedly.
+    onrestart exec_background - nobody shell -- /system/bin/traced_probes --cleanup-after-crash
+    file /dev/kmsg w
+    capabilities DAC_READ_SEARCH
+
+on property:persist.device_config.global_settings.sys_traced=1
+    setprop persist.traced.enable 1
+
+on property:persist.device_config.global_settings.sys_traced=0
+    setprop persist.traced.enable 0
+
+on property:debug.atrace.user_initiated=1
+    stop traced_probes
+
+on property:persist.traced.enable=1 && property:debug.atrace.user_initiated=""
+    start traced_probes
+
+on property:persist.traced.enable=1
+    # Trace files need to be:
+    # - Written by either uid:shell or uid:statsd.
+    # - Read by shell and incidentd.
+    mkdir /data/misc/perfetto-traces 0773 root shell
+
+    # Traces in this directory are only accessed by dumpstate (read+unlink) and
+    # by the bug reporting UI (ls+getattr).
+    mkdir /data/misc/perfetto-traces/bugreport 0773 root shell
+
+    # This directory allows shell to save configs file in a place where the
+    # perfetto cmdline client can read then. /data/local/tmp/ isn't safe because
+    # too many other domains can write into that. See b/170404111.
+    mkdir /data/misc/perfetto-configs 0775 root shell
+
+    start traced
+    start traced_probes
+
+on property:persist.traced.enable=0
+    stop traced
+    stop traced_probes
+
+# Reset the Perfetto guard rail state on boot:
+on post-fs-data
+    rm /data/misc/perfetto-traces/.guardraildata
+
+#############################################################################
+#  mm_events - Arms a perfetto trace config that is triggered
+#              on memory pressure (kmem_activity trigger)
+#############################################################################
+
+service mm_events /system/bin/mm_events
+    class late_start
+    disabled
+    oneshot
+    user nobody
+    group nobody
+
+on property:persist.mm_events.enabled=true && property:persist.traced.enable=1
+    restart mm_events   # Restart to reset backoff interval
+
+on property:persist.mm_events.enabled=false
+    stop mm_events
diff --git a/core/rootdir/cells/system/profcollectd.rc b/core/rootdir/cells/system/profcollectd.rc
new file mode 100644
index 0000000..b92fccb
--- /dev/null
+++ b/core/rootdir/cells/system/profcollectd.rc
@@ -0,0 +1,20 @@
+service profcollectd /system/bin/profcollectd
+    class late_start
+    disabled
+    oneshot
+    user root
+    group root wakelock
+    writepid /dev/cpuset/system-background/tasks
+
+on post-fs-data
+    # Create directory for profcollectd.
+    mkdir /data/misc/profcollectd 0770 shell shell
+    mkdir /data/misc/profcollectd/trace 0770 shell shell
+    mkdir /data/misc/profcollectd/output 0770 shell shell
+    mkdir /data/misc/profcollectd/report 0770 shell shell
+
+on boot && property:persist.device_config.profcollect_native_boot.enabled=true
+    start profcollectd
+
+on boot && property:persist.device_config.profcollect_native_boot.enabled=
+    exec_background - root shell -- /system/bin/profcollectctl reset
diff --git a/core/rootdir/cells/system/racoon.rc b/core/rootdir/cells/system/racoon.rc
new file mode 100644
index 0000000..fdb8823
--- /dev/null
+++ b/core/rootdir/cells/system/racoon.rc
@@ -0,0 +1,9 @@
+service racoon /system/bin/racoon
+    class main
+    socket racoon stream 600 system system
+    # IKE uses UDP port 500.
+    user vpn
+    group vpn inet
+    capabilities NET_ADMIN NET_BIND_SERVICE NET_RAW
+    disabled
+    oneshot
diff --git a/core/rootdir/cells/system/recovery-persist.rc b/core/rootdir/cells/system/recovery-persist.rc
new file mode 100644
index 0000000..135a3c3
--- /dev/null
+++ b/core/rootdir/cells/system/recovery-persist.rc
@@ -0,0 +1,3 @@
+on post-fs-data
+    mkdir /data/misc/recovery 0770 system log
+    exec_background - system log -- /system/bin/recovery-persist
diff --git a/core/rootdir/cells/system/recovery-refresh.rc b/core/rootdir/cells/system/recovery-refresh.rc
new file mode 100644
index 0000000..9fefc81
--- /dev/null
+++ b/core/rootdir/cells/system/recovery-refresh.rc
@@ -0,0 +1,2 @@
+on post-fs
+    exec_background - system log -- /system/bin/recovery-refresh
diff --git a/core/rootdir/cells/system/rss_hwm_reset.rc b/core/rootdir/cells/system/rss_hwm_reset.rc
new file mode 100644
index 0000000..fbbc820
--- /dev/null
+++ b/core/rootdir/cells/system/rss_hwm_reset.rc
@@ -0,0 +1,26 @@
+# Copyright (C) 2018 The Android Open Source Project
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#      https://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+
+service rss_hwm_reset /system/bin/rss_hwm_reset
+    class late_start
+    disabled
+    oneshot
+    user nobody
+    group nobody readproc
+    writepid /dev/cpuset/system-background/tasks
+    capabilities DAC_OVERRIDE
+
+on property:sys.rss_hwm_reset.on=1
+    start rss_hwm_reset
+    setprop sys.rss_hwm_reset.on 0
diff --git a/core/rootdir/cells/system/servicemanager.rc b/core/rootdir/cells/system/servicemanager.rc
new file mode 100644
index 0000000..6d5070f
--- /dev/null
+++ b/core/rootdir/cells/system/servicemanager.rc
@@ -0,0 +1,13 @@
+service servicemanager /system/bin/servicemanager
+    class core animation
+    user system
+    group system readproc
+    critical
+    onrestart restart apexd
+    onrestart restart audioserver
+    onrestart restart gatekeeperd
+    onrestart class_restart main
+    onrestart class_restart hal
+    onrestart class_restart early_hal
+    writepid /dev/cpuset/system-background/tasks
+    shutdown critical
diff --git a/core/rootdir/cells/system/snapuserd.rc b/core/rootdir/cells/system/snapuserd.rc
new file mode 100644
index 0000000..4bf34a2
--- /dev/null
+++ b/core/rootdir/cells/system/snapuserd.rc
@@ -0,0 +1,7 @@
+service snapuserd /system/bin/snapuserd
+    socket snapuserd stream 0660 system system
+    oneshot
+    disabled
+    user root
+    group root system
+    seclabel u:r:snapuserd:s0
diff --git a/core/rootdir/cells/system/storaged.rc b/core/rootdir/cells/system/storaged.rc
new file mode 100644
index 0000000..0614fad
--- /dev/null
+++ b/core/rootdir/cells/system/storaged.rc
@@ -0,0 +1,8 @@
+service storaged /system/bin/storaged
+    class main
+    capabilities DAC_READ_SEARCH
+    priority 10
+    file /d/mmc0/mmc0:0001/ext_csd r
+    writepid /dev/cpuset/system-background/tasks
+    user root
+    group package_info
diff --git a/core/rootdir/cells/system/surfaceflinger.rc b/core/rootdir/cells/system/surfaceflinger.rc
new file mode 100644
index 0000000..575e70d
--- /dev/null
+++ b/core/rootdir/cells/system/surfaceflinger.rc
@@ -0,0 +1,10 @@
+service surfaceflinger /system/bin/surfaceflinger
+    class core animation
+    user system
+    group graphics drmrpc readproc
+    capabilities SYS_NICE
+    onrestart restart zygote
+    task_profiles HighPerformance
+    socket pdx/system/vr/display/client     stream 0666 system graphics u:object_r:pdx_display_client_endpoint_socket:s0
+    socket pdx/system/vr/display/manager    stream 0666 system graphics u:object_r:pdx_display_manager_endpoint_socket:s0
+    socket pdx/system/vr/display/vsync      stream 0666 system graphics u:object_r:pdx_display_vsync_endpoint_socket:s0
diff --git a/core/rootdir/cells/system/tombstoned.rc b/core/rootdir/cells/system/tombstoned.rc
new file mode 100644
index 0000000..c39f4e4
--- /dev/null
+++ b/core/rootdir/cells/system/tombstoned.rc
@@ -0,0 +1,8 @@
+service tombstoned /system/bin/tombstoned
+    user tombstoned
+    group system
+
+    socket tombstoned_crash seqpacket 0666 system system
+    socket tombstoned_intercept seqpacket 0666 system system
+    socket tombstoned_java_trace seqpacket 0666 system system
+    writepid /dev/cpuset/system-background/tasks
diff --git a/core/rootdir/cells/system/traced_perf.rc b/core/rootdir/cells/system/traced_perf.rc
new file mode 100644
index 0000000..cc8d4e8
--- /dev/null
+++ b/core/rootdir/cells/system/traced_perf.rc
@@ -0,0 +1,47 @@
+# Copyright (C) 2020 The Android Open Source Project
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#      http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+
+# Notes:
+# * socket used for receiving /proc/pid/{maps,mem} file descriptors
+# * readproc group to stat(/proc/pid) to find out UID of processes, and read
+#   /proc/pid/cmdline.
+# * KILL capability for sending BIONIC_SIGNAL_PROFILER.
+# * DAC_READ_SEARCH capability for stack unwinding and on-device symbolization (requires
+#   opening libraries/executables for sections not already mapped in).
+# * foreground task group as unwinding based on minidebug info is a heavyweight action.
+service traced_perf /system/bin/traced_perf
+    class late_start
+    disabled
+    socket traced_perf stream 0666 root root
+    user nobody
+    group nobody readproc readtracefs
+    capabilities KILL DAC_READ_SEARCH
+    writepid /dev/cpuset/foreground/tasks
+
+# Daemon run state:
+# * initially off
+# * |persist.traced_perf.enable| forces daemon to run unconditionally
+# * if kernel doesn't have perf_event_open LSM hooks, daemon is stopped
+# * otherwise, follow |traced.lazy.traced_perf| as an on-demand service
+on property:persist.traced_perf.enable=1
+    start traced_perf
+on property:persist.traced_perf.enable="" && property:sys.init.perf_lsm_hooks=""
+    stop traced_perf
+on property:persist.traced_perf.enable="" && property:sys.init.perf_lsm_hooks=1 && property:traced.lazy.traced_perf=1
+    start traced_perf
+on property:persist.traced_perf.enable="" && property:sys.init.perf_lsm_hooks=1 && property:traced.lazy.traced_perf=""
+    stop traced_perf
+
+on property:persist.traced_perf.enable=0
+    setprop persist.traced_perf.enable ""
diff --git a/core/rootdir/cells/system/uncrypt.rc b/core/rootdir/cells/system/uncrypt.rc
new file mode 100644
index 0000000..52f564e
--- /dev/null
+++ b/core/rootdir/cells/system/uncrypt.rc
@@ -0,0 +1,17 @@
+service uncrypt /system/bin/uncrypt
+    class main
+    socket uncrypt stream 600 system system
+    disabled
+    oneshot
+
+service setup-bcb /system/bin/uncrypt --setup-bcb
+    class main
+    socket uncrypt stream 600 system system
+    disabled
+    oneshot
+
+service clear-bcb /system/bin/uncrypt --clear-bcb
+    class main
+    socket uncrypt stream 600 system system
+    disabled
+    oneshot
diff --git a/core/rootdir/cells/system/update_engine.rc b/core/rootdir/cells/system/update_engine.rc
new file mode 100644
index 0000000..b9f80fc
--- /dev/null
+++ b/core/rootdir/cells/system/update_engine.rc
@@ -0,0 +1,9 @@
+service update_engine /system/bin/update_engine --logtostderr --logtofile --foreground
+    class late_start
+    user root
+    group root system wakelock inet cache media_rw
+    writepid /dev/cpuset/system-background/tasks /dev/blkio/background/tasks
+    disabled
+
+on property:ro.boot.slot_suffix=*
+    enable update_engine
diff --git a/core/rootdir/cells/system/update_verifier.rc b/core/rootdir/cells/system/update_verifier.rc
new file mode 100644
index 0000000..862b062
--- /dev/null
+++ b/core/rootdir/cells/system/update_verifier.rc
@@ -0,0 +1,11 @@
+service update_verifier_nonencrypted /system/bin/update_verifier nonencrypted
+    user root
+    group cache system
+    priority -20
+    ioprio rt 0
+
+service update_verifier /system/bin/update_verifier ${vold.decrypt}
+    user root
+    group cache system
+    priority -20
+    ioprio rt 0
diff --git a/core/rootdir/cells/system/usbd.rc b/core/rootdir/cells/system/usbd.rc
new file mode 100644
index 0000000..809044a
--- /dev/null
+++ b/core/rootdir/cells/system/usbd.rc
@@ -0,0 +1,5 @@
+service usbd /system/bin/usbd
+    class late_start
+    oneshot
+    user root
+    group root usb system
diff --git a/core/rootdir/cells/system/vdc.rc b/core/rootdir/cells/system/vdc.rc
new file mode 100644
index 0000000..f2a8076
--- /dev/null
+++ b/core/rootdir/cells/system/vdc.rc
@@ -0,0 +1,12 @@
+# One shot invocation to deal with encrypted volume.
+on defaultcrypto
+    exec - root -- /system/bin/vdc --wait cryptfs mountdefaultencrypted
+    # vold will set vold.decrypt to trigger_restart_framework (default
+    # encryption) or trigger_restart_min_framework (other encryption)
+
+# One shot invocation to encrypt unencrypted volumes
+on encrypt
+    start surfaceflinger
+    exec - root -- /system/bin/vdc --wait cryptfs enablecrypto
+    # vold will set vold.decrypt to trigger_restart_framework (default
+    # encryption)
diff --git a/core/rootdir/cells/system/vendor-464xlat.rc b/core/rootdir/cells/system/vendor-464xlat.rc
new file mode 100644
index 0000000..609531d
--- /dev/null
+++ b/core/rootdir/cells/system/vendor-464xlat.rc
@@ -0,0 +1,15 @@
+# Certain vendors disable 464xlat by setting a vendor property.
+# The connectivity code in the Tethering APEX needs to disable
+# 464xlat when the property is set, but it is only allowed to
+# access non-vendor system properties. So copy the property to
+# a property available to system APIs in android.sysprop.
+#
+# Arguably this script should live close to the code that uses
+# it, but scrips in APEXes are not allowed to use "on property".
+# So put it here close to clatd, which is at least related to
+# 464xlat.
+on property:persist.vendor.net.doxlat=true
+    setprop net.464xlat.cellular.enabled true
+
+on property:persist.vendor.net.doxlat=false
+    setprop net.464xlat.cellular.enabled false
diff --git a/core/rootdir/cells/system/vold.rc b/core/rootdir/cells/system/vold.rc
new file mode 100644
index 0000000..a21d1d9
--- /dev/null
+++ b/core/rootdir/cells/system/vold.rc
@@ -0,0 +1,9 @@
+service vold /system/bin/vold \
+        --blkid_context=u:r:blkid:s0 --blkid_untrusted_context=u:r:blkid_untrusted:s0 \
+        --fsck_context=u:r:fsck:s0 --fsck_untrusted_context=u:r:fsck_untrusted:s0
+    class core
+    ioprio be 2
+    writepid /dev/cpuset/foreground/tasks
+    shutdown critical
+    group root reserved_disk
+    reboot_on_failure reboot,vold-failed
diff --git a/core/rootdir/cells/system/wait_for_keymaster.rc b/core/rootdir/cells/system/wait_for_keymaster.rc
new file mode 100644
index 0000000..9e83a93
--- /dev/null
+++ b/core/rootdir/cells/system/wait_for_keymaster.rc
@@ -0,0 +1,5 @@
+service wait_for_keymaster /system/bin/wait_for_keymaster
+    user root
+    group root system
+    priority -20
+    ioprio rt 0
diff --git a/core/rootdir/cells/system/wifi.rc b/core/rootdir/cells/system/wifi.rc
new file mode 100644
index 0000000..71567ed
--- /dev/null
+++ b/core/rootdir/cells/system/wifi.rc
@@ -0,0 +1,101 @@
+#
+# Copyright (C) 2016 The Android Open Source Project
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#      http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+#
+
+# These are needed for migration of data to wifi apex directory.
+on post-fs-data
+   restorecon_recursive /data/misc/apexdata/com.android.wifi
+
+on property:sys.user.0.ce_available=true
+   restorecon_recursive /data/misc_ce/0/apexdata/com.android.wifi
+
+# Below are for kernel tracing related stuff.
+on fs
+   setprop sys.wifitracing.started 0
+
+on property:sys.boot_completed=1 && property:sys.wifitracing.started=0
+   # Create trace buffer, and set basic configuration.
+   mkdir /sys/kernel/debug/tracing/instances/wifi 711
+   restorecon_recursive /sys/kernel/debug/tracing/instances/wifi
+#   write /sys/kernel/debug/tracing/instances/wifi/tracing_on 0
+#   write /sys/kernel/debug/tracing/instances/wifi/buffer_size_kb 1
+#   write /sys/kernel/debug/tracing/instances/wifi/trace_options disable_on_free
+
+   mkdir /sys/kernel/tracing/instances/wifi 711
+   restorecon_recursive /sys/kernel/tracing/instances/wifi
+#   write /sys/kernel/tracing/instances/wifi/tracing_on 0
+#   write /sys/kernel/tracing/instances/wifi/buffer_size_kb 1
+#   write /sys/kernel/tracing/instances/wifi/trace_options disable_on_free
+
+   # Enable cfg80211 events for connection and key management events.
+   # - Events are not actually logged until WifiService writes "1" to
+   #   /sys/kernel/debug/tracing/instances/wifi/tracing_on.
+   # - WifiService is responsible for turning tracing off and on.
+#   write /sys/kernel/debug/tracing/instances/wifi/events/cfg80211/cfg80211_gtk_rekey_notify/enable 1
+#   write /sys/kernel/debug/tracing/instances/wifi/events/cfg80211/rdev_add_key/enable 1
+#   write /sys/kernel/debug/tracing/instances/wifi/events/cfg80211/rdev_assoc/enable 1
+#   write /sys/kernel/debug/tracing/instances/wifi/events/cfg80211/rdev_auth/enable 1
+#   write /sys/kernel/debug/tracing/instances/wifi/events/cfg80211/rdev_connect/enable 1
+#   write /sys/kernel/debug/tracing/instances/wifi/events/cfg80211/rdev_set_default_key/enable 1
+#   write /sys/kernel/debug/tracing/instances/wifi/events/cfg80211/rdev_set_default_mgmt_key/enable 1
+#   write /sys/kernel/debug/tracing/instances/wifi/events/cfg80211/rdev_set_rekey_data/enable 1
+
+#   write /sys/kernel/tracing/instances/wifi/events/cfg80211/cfg80211_gtk_rekey_notify/enable 1
+#   write /sys/kernel/tracing/instances/wifi/events/cfg80211/rdev_add_key/enable 1
+#   write /sys/kernel/tracing/instances/wifi/events/cfg80211/rdev_assoc/enable 1
+#   write /sys/kernel/tracing/instances/wifi/events/cfg80211/rdev_auth/enable 1
+#   write /sys/kernel/tracing/instances/wifi/events/cfg80211/rdev_connect/enable 1
+#   write /sys/kernel/tracing/instances/wifi/events/cfg80211/rdev_set_default_key/enable 1
+#   write /sys/kernel/tracing/instances/wifi/events/cfg80211/rdev_set_default_mgmt_key/enable 1
+#   write /sys/kernel/tracing/instances/wifi/events/cfg80211/rdev_set_rekey_data/enable 1
+
+   # Enable datapath events for Wifi.
+   # - Events are not actually logged until WifiService writes "1" to
+   #   /sys/kernel/debug/tracing/instances/wifi/tracing_on.
+   # - WifiService will ensure that tracing is turned back off,
+   #   when a connection attempt ends (whether in success or failure)
+#   write /sys/kernel/debug/tracing/instances/wifi/events/net/filter name==${wifi.interface:-wlan0}
+#   write /sys/kernel/debug/tracing/instances/wifi/events/net/net_dev_queue/enable 1
+#   write /sys/kernel/debug/tracing/instances/wifi/events/net/net_dev_xmit/enable 1
+#   write /sys/kernel/debug/tracing/instances/wifi/events/net/netif_rx/enable 1
+#   write /sys/kernel/debug/tracing/instances/wifi/events/net/netif_receive_skb/enable 1
+
+#   write /sys/kernel/tracing/instances/wifi/events/net/filter name==${wifi.interface:-wlan0}
+#   write /sys/kernel/tracing/instances/wifi/events/net/net_dev_queue/enable 1
+#   write /sys/kernel/tracing/instances/wifi/events/net/net_dev_xmit/enable 1
+#   write /sys/kernel/tracing/instances/wifi/events/net/netif_rx/enable 1
+#   write /sys/kernel/tracing/instances/wifi/events/net/netif_receive_skb/enable 1
+
+   # Set DAC to allow system to enable/disable, and read wifi trace
+   # events.
+   chown system /sys/kernel/debug/tracing/instances/wifi/tracing_on
+   chown system /sys/kernel/debug/tracing/instances/wifi/free_buffer
+   chown system /sys/kernel/debug/tracing/instances/wifi/trace
+   chmod 200 /sys/kernel/debug/tracing/instances/wifi/tracing_on
+   chmod 400 /sys/kernel/debug/tracing/instances/wifi/free_buffer
+   chmod 600 /sys/kernel/debug/tracing/instances/wifi/trace
+
+   chown system /sys/kernel/tracing/instances/wifi/tracing_on
+   chown system /sys/kernel/tracing/instances/wifi/free_buffer
+   chown system /sys/kernel/tracing/instances/wifi/trace
+   chmod 200 /sys/kernel/tracing/instances/wifi/tracing_on
+   chmod 400 /sys/kernel/tracing/instances/wifi/free_buffer
+   chmod 600 /sys/kernel/tracing/instances/wifi/trace
+   setprop sys.wifitracing.started 1
+
+on property:sys.boot_completed=1 && property:wifi.interface=* && property:sys.wifitracing.started=1
+   # Override default value.
+#   write /sys/kernel/debug/tracing/instances/wifi/events/net/filter name==${wifi.interface}
+#   write /sys/kernel/tracing/instances/wifi/events/net/filter name==${wifi.interface}
diff --git a/core/rootdir/cells/system/wificond.rc b/core/rootdir/cells/system/wificond.rc
new file mode 100644
index 0000000..407fcca
--- /dev/null
+++ b/core/rootdir/cells/system/wificond.rc
@@ -0,0 +1,5 @@
+service wificond /system/bin/wificond
+    class main
+    user wifi
+    group wifi net_raw net_admin
+    capabilities NET_RAW NET_ADMIN
diff --git a/core/rootdir/cells/vendor/android.hardware.atrace@1.0-service.pixel.rc b/core/rootdir/cells/vendor/android.hardware.atrace@1.0-service.pixel.rc
new file mode 100644
index 0000000..353c073
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.atrace@1.0-service.pixel.rc
@@ -0,0 +1,46 @@
+on late-init
+    # vendor graphics trace points
+    chmod 0666 /sys/kernel/debug/tracing/events/sde/enable
+    chmod 0666 /sys/kernel/tracing/events/sde/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/mdss/enable
+    chmod 0666 /sys/kernel/tracing/events/mdss/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/dpu/enable
+    chmod 0666 /sys/kernel/tracing/events/dpu/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/g2d/enable
+    chmod 0666 /sys/kernel/tracing/events/g2d/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/mali/enable
+    chmod 0666 /sys/kernel/tracing/events/mali/enable
+
+    # ion allocation trace point
+    chmod 0666 /sys/kernel/debug/tracing/events/kmem/ion_alloc_buffer_start/enable
+    chmod 0666 /sys/kernel/tracing/events/kmem/ion_alloc_buffer_start/enable
+    # scm trace point
+    chmod 0666 /sys/kernel/debug/tracing/events/scm/enable
+    chmod 0666 /sys/kernel/tracing/events/scm/enable
+    # system bus clk trace point
+    chmod 0666 /sys/kernel/debug/tracing/events/msm_bus/enable
+    chmod 0666 /sys/kernel/tracing/events/msm_bus/enable
+    # legacy systrace point
+    chmod 0666 /sys/kernel/debug/tracing/events/systrace/enable
+    chmod 0666 /sys/kernel/tracing/events/systrace/enable
+    # qct hw lmh-dcvs
+    chmod 0666 /sys/kernel/debug/tracing/events/lmh/lmh_dcvs_freq/enable
+    chmod 0666 /sys/kernel/tracing/events/lmh/lmh_dcvs_freq/enable
+    # qct fastrpc dma buffers
+    chmod 0666 /sys/kernel/debug/tracing/events/fastrpc/fastrpc_dma_stat/enable
+    chmod 0666 /sys/kernel/tracing/events/fastrpc/fastrpc_dma_stat/enable
+    # dmabuf heap stats
+    chmod 0666 /sys/kernel/tracing/events/dmabuf_heap/enable
+    # Tj pid control loop trace points
+    chmod 0666 /sys/kernel/debug/tracing/events/thermal_exynos/enable
+    chmod 0666 /sys/kernel/tracing/events/thermal_exynos/enable
+    chmod 0666 /sys/kernel/debug/tracing/events/thermal_exynos_gpu/enable
+    chmod 0666 /sys/kernel/tracing/events/thermal_exynos_gpu/enable
+
+service vendor.atrace-hal-1-0 /vendor/bin/hw/android.hardware.atrace@1.0-service.pixel
+    interface android.hardware.atrace@1.0::IAtraceDevice default
+    class early_hal
+    user system
+    group system
+    oneshot
+    disabled
diff --git a/core/rootdir/cells/vendor/android.hardware.audio.service.rc b/core/rootdir/cells/vendor/android.hardware.audio.service.rc
new file mode 100644
index 0000000..8fe7c6e
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.audio.service.rc
@@ -0,0 +1,10 @@
+#service vendor.audio-hal /vendor/bin/hw/android.hardware.audio.service
+#    class hal
+#    user audioserver
+#    # media gid needed for /dev/fm (radio) and for /data/misc/media (tee)
+#    group audio camera drmrpc inet media mediadrm net_bt net_bt_admin net_bw_acct wakelock context_hub
+#    capabilities BLOCK_SUSPEND
+#    ioprio rt 4
+#    task_profiles ProcessCapacityHigh HighPerformance
+#    onrestart restart audioserver
+#
diff --git a/core/rootdir/cells/vendor/android.hardware.biometrics.fingerprint@2.2-service.fpc.rc b/core/rootdir/cells/vendor/android.hardware.biometrics.fingerprint@2.2-service.fpc.rc
new file mode 100644
index 0000000..c5f2808
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.biometrics.fingerprint@2.2-service.fpc.rc
@@ -0,0 +1,8 @@
+#service fps_hal /vendor/bin/hw/android.hardware.biometrics.fingerprint@2.2-service.fpc
+#    # "class hal" causes a race condition on some devices due to files created
+#    # in /data. As a workaround, postpone startup until later in boot once
+#    # /data is mounted.
+#    class late_start
+#    user system
+#    group system input uhid
+#
diff --git a/core/rootdir/cells/vendor/android.hardware.bluetooth@1.0-service-qti.rc b/core/rootdir/cells/vendor/android.hardware.bluetooth@1.0-service-qti.rc
new file mode 100644
index 0000000..bd398c5
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.bluetooth@1.0-service-qti.rc
@@ -0,0 +1,7 @@
+#service vendor.bluetooth-1-0 /vendor/bin/hw/android.hardware.bluetooth@1.0-service-qti
+#    class hal
+#    user bluetooth
+#    group bluetooth system wakelock oem_2901
+#    capabilities BLOCK_SUSPEND NET_ADMIN SYS_NICE
+#    writepid /dev/stune/foreground/tasks
+
diff --git a/core/rootdir/cells/vendor/android.hardware.boot@1.2-service.rc b/core/rootdir/cells/vendor/android.hardware.boot@1.2-service.rc
new file mode 100644
index 0000000..14926c0
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.boot@1.2-service.rc
@@ -0,0 +1,7 @@
+service vendor.boot-hal-1-2 /vendor/bin/hw/android.hardware.boot@1.2-service
+    interface android.hardware.boot@1.0::IBootControl default
+    interface android.hardware.boot@1.1::IBootControl default
+    interface android.hardware.boot@1.2::IBootControl default
+    class early_hal
+    user root
+    group root
diff --git a/core/rootdir/cells/vendor/android.hardware.camera.provider@2.7-service-google.rc b/core/rootdir/cells/vendor/android.hardware.camera.provider@2.7-service-google.rc
new file mode 100644
index 0000000..5797a28
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.camera.provider@2.7-service-google.rc
@@ -0,0 +1,8 @@
+#service vendor.camera-provider-2-7-google /vendor/bin/hw/android.hardware.camera.provider@2.7-service-google
+#    class hal
+#    user system
+#    group system
+#    capabilities SYS_NICE
+#    rlimit rtprio 10 10
+#    task_profiles CameraServiceCapacity CameraServicePerformance
+#
\ No newline at end of file
diff --git a/core/rootdir/cells/vendor/android.hardware.cas@1.2-service.rc b/core/rootdir/cells/vendor/android.hardware.cas@1.2-service.rc
new file mode 100644
index 0000000..d1c853e
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.cas@1.2-service.rc
@@ -0,0 +1,6 @@
+service vendor.cas-hal-1-2 /vendor/bin/hw/android.hardware.cas@1.2-service
+    class hal
+    user media
+    group mediadrm drmrpc
+    ioprio rt 4
+    writepid /dev/cpuset/foreground/tasks
diff --git a/core/rootdir/cells/vendor/android.hardware.confirmationui@1.0-service-google.rc b/core/rootdir/cells/vendor/android.hardware.confirmationui@1.0-service-google.rc
new file mode 100644
index 0000000..c6d8887
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.confirmationui@1.0-service-google.rc
@@ -0,0 +1,4 @@
+service confirmationui-1-0 /vendor/bin/hw/android.hardware.confirmationui@1.0-service-google
+    class hal
+    user nobody
+    group drmrpc input
diff --git a/core/rootdir/cells/vendor/android.hardware.contexthub@1.2-service-generic.rc b/core/rootdir/cells/vendor/android.hardware.contexthub@1.2-service-generic.rc
new file mode 100644
index 0000000..c625360
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.contexthub@1.2-service-generic.rc
@@ -0,0 +1,7 @@
+service vendor.contexthub-hal-1-2 /vendor/bin/hw/android.hardware.contexthub@1.2-service.generic
+    interface android.hardware.contexthub@1.0::IContexthub default
+    interface android.hardware.contexthub@1.1::IContexthub default
+    interface android.hardware.contexthub@1.2::IContexthub default
+    class hal
+    user context_hub
+    group context_hub
diff --git a/core/rootdir/cells/vendor/android.hardware.drm@1.4-service.clearkey.rc b/core/rootdir/cells/vendor/android.hardware.drm@1.4-service.clearkey.rc
new file mode 100644
index 0000000..8186933
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.drm@1.4-service.clearkey.rc
@@ -0,0 +1,16 @@
+service vendor.drm-clearkey-hal-1-4 /vendor/bin/hw/android.hardware.drm@1.4-service.clearkey
+    interface android.hardware.drm@1.0::ICryptoFactory clearkey
+    interface android.hardware.drm@1.0::IDrmFactory clearkey
+    interface android.hardware.drm@1.1::ICryptoFactory clearkey
+    interface android.hardware.drm@1.1::IDrmFactory clearkey
+    interface android.hardware.drm@1.2::ICryptoFactory clearkey
+    interface android.hardware.drm@1.2::IDrmFactory clearkey
+    interface android.hardware.drm@1.3::ICryptoFactory clearkey
+    interface android.hardware.drm@1.3::IDrmFactory clearkey
+    interface android.hardware.drm@1.4::ICryptoFactory clearkey
+    interface android.hardware.drm@1.4::IDrmFactory clearkey
+    class hal
+    user media
+    group media mediadrm
+    ioprio rt 4
+    writepid /dev/cpuset/foreground/tasks
diff --git a/core/rootdir/cells/vendor/android.hardware.drm@1.4-service.widevine.rc b/core/rootdir/cells/vendor/android.hardware.drm@1.4-service.widevine.rc
new file mode 100644
index 0000000..3d8198a
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.drm@1.4-service.widevine.rc
@@ -0,0 +1,28 @@
+on property:init.svc.mediadrm=running
+    mkdir /data/vendor/mediadrm 0770 media mediadrm
+    start vendor.move_data_sh
+
+service vendor.move_data_sh /system/bin/move_widevine_data.sh
+    class late_start
+    user media
+    group media mediadrm system
+    disabled
+    oneshot
+
+service vendor.drm-widevine-hal-1-4 /vendor/bin/hw/android.hardware.drm@1.4-service.widevine
+    interface android.hardware.drm@1.0::ICryptoFactory widevine
+    interface android.hardware.drm@1.0::IDrmFactory widevine
+    interface android.hardware.drm@1.1::ICryptoFactory widevine
+    interface android.hardware.drm@1.1::IDrmFactory widevine
+    interface android.hardware.drm@1.2::ICryptoFactory widevine
+    interface android.hardware.drm@1.2::IDrmFactory widevine
+    interface android.hardware.drm@1.3::ICryptoFactory widevine
+    interface android.hardware.drm@1.3::IDrmFactory widevine
+    interface android.hardware.drm@1.4::ICryptoFactory widevine
+    interface android.hardware.drm@1.4::IDrmFactory widevine
+    interface android.hidl.base@1.0::IBase widevine
+    class hal
+    user media
+    group media mediadrm drmrpc system
+    ioprio rt 4
+    writepid /dev/cpuset/foreground/tasks
diff --git a/core/rootdir/cells/vendor/android.hardware.dumpstate@1.1-service.redfin.rc b/core/rootdir/cells/vendor/android.hardware.dumpstate@1.1-service.redfin.rc
new file mode 100644
index 0000000..22bfd02
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.dumpstate@1.1-service.redfin.rc
@@ -0,0 +1,11 @@
+service vendor.dumpstate-1-1 /vendor/bin/hw/android.hardware.dumpstate@1.1-service.redfin
+    class hal
+    user system
+    group system vendor_rfs
+    interface android.hardware.dumpstate@1.0::IDumpstateDevice default
+    interface android.hardware.dumpstate@1.1::IDumpstateDevice default
+    oneshot
+    disabled
+
+on boot
+    chmod 0444 /sys/kernel/debug/tzdbg/qsee_log
diff --git a/core/rootdir/cells/vendor/android.hardware.gatekeeper@1.0-service-qti.rc b/core/rootdir/cells/vendor/android.hardware.gatekeeper@1.0-service-qti.rc
new file mode 100644
index 0000000..f1493c8
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.gatekeeper@1.0-service-qti.rc
@@ -0,0 +1,4 @@
+#service gatekeeper-1-0 /vendor/bin/hw/android.hardware.gatekeeper@1.0-service-qti
+#    class early_hal
+#    user system
+#    group system
diff --git a/core/rootdir/cells/vendor/android.hardware.gnss@2.1-service-qti.rc b/core/rootdir/cells/vendor/android.hardware.gnss@2.1-service-qti.rc
new file mode 100644
index 0000000..71b43bc
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.gnss@2.1-service-qti.rc
@@ -0,0 +1,4 @@
+service gnss_service /vendor/bin/hw/android.hardware.gnss@2.1-service-qti
+    class hal
+    user gps
+    group system gps radio
diff --git a/core/rootdir/cells/vendor/android.hardware.health.storage@1.0-service.rc b/core/rootdir/cells/vendor/android.hardware.health.storage@1.0-service.rc
new file mode 100644
index 0000000..d5e1a29
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.health.storage@1.0-service.rc
@@ -0,0 +1,7 @@
+service vendor.health-storage-hal-1-0 /vendor/bin/hw/android.hardware.health.storage@1.0-service
+    interface android.hardware.health.storage@1.0::IStorage default
+    oneshot
+    disabled
+    class hal
+    user system
+    group system
diff --git a/core/rootdir/cells/vendor/android.hardware.health@2.1-service.rc b/core/rootdir/cells/vendor/android.hardware.health@2.1-service.rc
new file mode 100644
index 0000000..8728257
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.health@2.1-service.rc
@@ -0,0 +1,6 @@
+service health-hal-2-1 /vendor/bin/hw/android.hardware.health@2.1-service
+    class hal charger
+    user system
+    group system
+    capabilities WAKE_ALARM BLOCK_SUSPEND
+    file /dev/kmsg w
diff --git a/core/rootdir/cells/vendor/android.hardware.identity@1.0-service.citadel.rc b/core/rootdir/cells/vendor/android.hardware.identity@1.0-service.citadel.rc
new file mode 100644
index 0000000..8791626
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.identity@1.0-service.citadel.rc
@@ -0,0 +1,3 @@
+#service vendor.identity_hal /vendor/bin/hw/android.hardware.identity@1.0-service.citadel
+#    class hal
+#    user nobody
\ No newline at end of file
diff --git a/core/rootdir/cells/vendor/android.hardware.input.classifier@1.0-service.rc b/core/rootdir/cells/vendor/android.hardware.input.classifier@1.0-service.rc
new file mode 100644
index 0000000..55cc8f6
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.input.classifier@1.0-service.rc
@@ -0,0 +1,9 @@
+#service vendor.input.classifier-1-0 /vendor/bin/hw/android.hardware.input.classifier@1.0-service
+#    # Must be specified if "disabled" is set. This HAL will only start if requested via getService
+#    interface android.hardware.input.classifier@1.0::IInputClassifier default
+#    class hal
+#    user nobody
+#    # will not be restarted if it exits until it is requested to be restarted
+#    oneshot
+#    # will only be started when requested
+#    disabled
diff --git a/core/rootdir/cells/vendor/android.hardware.keymaster@4.0-service-qti.rc b/core/rootdir/cells/vendor/android.hardware.keymaster@4.0-service-qti.rc
new file mode 100644
index 0000000..baa1124
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.keymaster@4.0-service-qti.rc
@@ -0,0 +1,8 @@
+#on init
+#    start keymaster-4-0
+#
+#service keymaster-4-0 /vendor/bin/hw/android.hardware.keymaster@4.0-service-qti
+#    class early_hal
+#    user system
+#    group system drmrpc
+#
\ No newline at end of file
diff --git a/core/rootdir/cells/vendor/android.hardware.keymaster@4.1-service.citadel.rc b/core/rootdir/cells/vendor/android.hardware.keymaster@4.1-service.citadel.rc
new file mode 100644
index 0000000..128036a
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.keymaster@4.1-service.citadel.rc
@@ -0,0 +1,5 @@
+#service vendor.keymaster-4-1-citadel /vendor/bin/hw/android.hardware.keymaster@4.1-service.citadel
+#    class early_hal
+#    user hsm
+#    group hsm drmrpc
+#
\ No newline at end of file
diff --git a/core/rootdir/cells/vendor/android.hardware.media.omx@1.0-service.rc b/core/rootdir/cells/vendor/android.hardware.media.omx@1.0-service.rc
new file mode 100644
index 0000000..3ef9a85
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.media.omx@1.0-service.rc
@@ -0,0 +1,6 @@
+service vendor.media.omx /vendor/bin/hw/android.hardware.media.omx@1.0-service
+    class main
+    user mediacodec
+    group camera drmrpc mediadrm
+    ioprio rt 4
+    writepid /dev/cpuset/foreground/tasks
diff --git a/core/rootdir/cells/vendor/android.hardware.memtrack@1.0-service.rc b/core/rootdir/cells/vendor/android.hardware.memtrack@1.0-service.rc
new file mode 100644
index 0000000..f5eee54
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.memtrack@1.0-service.rc
@@ -0,0 +1,5 @@
+service vendor.memtrack-hal-1-0 /vendor/bin/hw/android.hardware.memtrack@1.0-service
+    interface android.hardware.memtrack@1.0::IMemtrack default
+    class hal
+    user system
+    group system
diff --git a/core/rootdir/cells/vendor/android.hardware.neuralnetworks@1.3-service-qti.rc b/core/rootdir/cells/vendor/android.hardware.neuralnetworks@1.3-service-qti.rc
new file mode 100644
index 0000000..1d6c390
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.neuralnetworks@1.3-service-qti.rc
@@ -0,0 +1,14 @@
+# Copyright (c) 2019-2020 Qualcomm Technologies, Inc.
+# All Rights Reserved.
+# Confidential and Proprietary - Qualcomm Technologies, Inc.
+#
+
+service neuralnetworks_hal_service /vendor/bin/hw/android.hardware.neuralnetworks@1.3-service-qti
+    class hal
+    user system
+    group system
+    writepid /dev/stune/nnapi-hal/tasks
+
+#Below changes moved from init.target.rc as part of go/FR53051
+on post-fs-data
+    mkdir /data/vendor/nnhal 0700 system system
diff --git a/core/rootdir/cells/vendor/android.hardware.nfc@1.2-service.st.rc b/core/rootdir/cells/vendor/android.hardware.nfc@1.2-service.st.rc
new file mode 100644
index 0000000..cf31b3e
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.nfc@1.2-service.st.rc
@@ -0,0 +1,4 @@
+service nfc_hal_service /vendor/bin/hw/android.hardware.nfc@1.2-service.st
+    class hal
+    user nfc
+    group nfc
diff --git a/core/rootdir/cells/vendor/android.hardware.power-service.pixel-libperfmgr.rc b/core/rootdir/cells/vendor/android.hardware.power-service.pixel-libperfmgr.rc
new file mode 100644
index 0000000..ef15b12
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.power-service.pixel-libperfmgr.rc
@@ -0,0 +1,29 @@
+service vendor.power-hal-aidl /vendor/bin/hw/android.hardware.power-service.pixel-libperfmgr
+    class hal
+    user root
+    group system
+    priority -20
+
+on late-fs
+     start vendor.power-hal-aidl
+
+# restart powerHAL when framework died
+on property:init.svc.zygote=restarting && property:vendor.powerhal.state=*
+    setprop vendor.powerhal.state ""
+    setprop vendor.powerhal.audio ""
+    setprop vendor.powerhal.rendering ""
+    restart vendor.power-hal-aidl
+
+# restart powerHAL when audioHAL died
+on property:init.svc.vendor.audio-hal-2-0=restarting && property:vendor.powerhal.audio=AUDIO_STREAMING_LOW_LATENCY
+    setprop vendor.powerhal.audio ""
+    restart vendor.power-hal-aidl
+
+# Clean up after b/163539793 resolved
+on property:vendor.powerhal.dalvik.vm.dex2oat-threads=*
+    setprop dalvik.vm.dex2oat-threads ${vendor.powerhal.dalvik.vm.dex2oat-threads}
+    setprop dalvik.vm.restore-dex2oat-threads ${vendor.powerhal.dalvik.vm.dex2oat-threads}
+
+on property:vendor.powerhal.dalvik.vm.dex2oat-cpu-set=*
+    setprop dalvik.vm.dex2oat-cpu-set ${vendor.powerhal.dalvik.vm.dex2oat-cpu-set}
+    setprop dalvik.vm.restore-dex2oat-cpu-set ${vendor.powerhal.dalvik.vm.dex2oat-cpu-set}
diff --git a/core/rootdir/cells/vendor/android.hardware.power.stats@1.0-service.pixel.rc b/core/rootdir/cells/vendor/android.hardware.power.stats@1.0-service.pixel.rc
new file mode 100644
index 0000000..6ba83c2
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.power.stats@1.0-service.pixel.rc
@@ -0,0 +1,4 @@
+service vendor.power.stats-hal-1-0 /vendor/bin/hw/android.hardware.power.stats@1.0-service.pixel
+    class hal
+    user system
+    group system
diff --git a/core/rootdir/cells/vendor/android.hardware.secure_element@1.2-service.st.rc b/core/rootdir/cells/vendor/android.hardware.secure_element@1.2-service.st.rc
new file mode 100644
index 0000000..3f94a31
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.secure_element@1.2-service.st.rc
@@ -0,0 +1,4 @@
+service secure_element_hal_service /vendor/bin/hw/android.hardware.secure_element@1.2-service.st
+    class hal
+    user secure_element
+    group secure_element nfc
diff --git a/core/rootdir/cells/vendor/android.hardware.sensors@2.0-service-multihal.rc b/core/rootdir/cells/vendor/android.hardware.sensors@2.0-service-multihal.rc
new file mode 100644
index 0000000..09eff61
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.sensors@2.0-service-multihal.rc
@@ -0,0 +1,8 @@
+#service vendor.sensors-hal-2-0-multihal /vendor/bin/hw/android.hardware.sensors@2.0-service.multihal
+#    class hal
+#    user system
+#    group system wakelock context_hub
+#    writepid /dev/cpuset/system-background/tasks
+#    capabilities BLOCK_SUSPEND
+#    rlimit rtprio 10 10
+#
\ No newline at end of file
diff --git a/core/rootdir/cells/vendor/android.hardware.thermal@2.0-service.pixel.rc b/core/rootdir/cells/vendor/android.hardware.thermal@2.0-service.pixel.rc
new file mode 100644
index 0000000..d7880ef
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.thermal@2.0-service.pixel.rc
@@ -0,0 +1,17 @@
+#on property:vendor.thermal.link_ready=1
+#    # queue the trigger to start thermal-hal and continue execute
+#    # per-device thermal setup "on property:vendor.thermal.link_ready=1"
+#    trigger enable-thermal-hal
+#
+#on enable-thermal-hal
+#    start vendor.thermal-hal-2-0
+#
+#service vendor.thermal-hal-2-0 /vendor/bin/hw/android.hardware.thermal@2.0-service.pixel
+#    interface android.hardware.thermal@1.0::IThermal default
+#    interface android.hardware.thermal@2.0::IThermal default
+#    class hal
+#    user system
+#    group system
+#    priority -20
+#    disabled
+#
diff --git a/core/rootdir/cells/vendor/android.hardware.usb@1.3-service.redfin.rc b/core/rootdir/cells/vendor/android.hardware.usb@1.3-service.redfin.rc
new file mode 100644
index 0000000..fffa93a
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.usb@1.3-service.redfin.rc
@@ -0,0 +1,26 @@
+service vendor.usb-hal-1-3 /vendor/bin/hw/android.hardware.usb@1.3-service.redfin
+    class hal
+    user system
+    group system shell mtp
+
+service init-gadgethal-sh /vendor/bin/init.gadgethal.sh
+    class hal
+    user root
+    disabled
+    oneshot
+
+on boot
+    chown root system /sys/class/typec/port0/power_role
+    chown root system /sys/class/typec/port0/data_role
+    chown root system /sys/class/typec/port0/port_type
+    chmod 664 /sys/class/typec/port0/power_role
+    chmod 664 /sys/class/typec/port0/data_role
+    chmod 664 /sys/class/typec/port0/port_type
+
+on post-fs
+    chown root system /sys/devices/platform/soc/a600000.ssusb/id
+    chown root system /sys/devices/platform/soc/a600000.ssusb/b_sess
+    chown root system /sys/devices/platform/soc/a600000.ssusb/usb_data_enabled
+    chmod 664 /sys/devices/platform/soc/a600000.ssusb/id
+    chmod 664 /sys/devices/platform/soc/a600000.ssusb/b_sess
+    chmod 664 /sys/devices/platform/soc/a600000.ssusb/usb_data_enabled
diff --git a/core/rootdir/cells/vendor/android.hardware.vibrator-service.redfin.rc b/core/rootdir/cells/vendor/android.hardware.vibrator-service.redfin.rc
new file mode 100644
index 0000000..452b775
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.vibrator-service.redfin.rc
@@ -0,0 +1,15 @@
+service vendor.vibrator.redfin /vendor/bin/hw/android.hardware.vibrator-service.redfin
+    class hal
+    user system
+    group system
+
+    setenv PROPERTY_PREFIX ro.vendor.vibrator.hal.
+    setenv CALIBRATION_FILEPATH /mnt/vendor/persist/haptics/drv2624.cal
+
+    setenv HWAPI_PATH_PREFIX /sys/class/leds/vibrator/
+    setenv HWAPI_DEBUG_PATHS "
+        device/autocal
+        device/lp_trigger_effect
+        device/ol_lra_period
+        state
+        "
diff --git a/core/rootdir/cells/vendor/android.hardware.weaver@1.0-service.citadel.rc b/core/rootdir/cells/vendor/android.hardware.weaver@1.0-service.citadel.rc
new file mode 100644
index 0000000..704b6f2
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.weaver@1.0-service.citadel.rc
@@ -0,0 +1,5 @@
+#service vendor.weaver_hal /vendor/bin/hw/android.hardware.weaver@1.0-service.citadel
+#    class hal
+#    user hsm
+#    group hsm
+#
\ No newline at end of file
diff --git a/core/rootdir/cells/vendor/android.hardware.wifi.supplicant-service.rc b/core/rootdir/cells/vendor/android.hardware.wifi.supplicant-service.rc
new file mode 100644
index 0000000..71318d4
--- /dev/null
+++ b/core/rootdir/cells/vendor/android.hardware.wifi.supplicant-service.rc
@@ -0,0 +1,16 @@
+service wpa_supplicant /vendor/bin/hw/wpa_supplicant \
+    -O/data/vendor/wifi/wpa/sockets -dd \
+    -g@android:wpa_wlan0
+    #   we will start as root and wpa_supplicant will switch to user wifi
+    #   after setting up the capabilities required for WEXT
+    #   user wifi
+    #   group wifi inet keystore
+    interface android.hardware.wifi.supplicant@1.0::ISupplicant default
+    interface android.hardware.wifi.supplicant@1.1::ISupplicant default
+    interface android.hardware.wifi.supplicant@1.2::ISupplicant default
+    interface android.hardware.wifi.supplicant@1.3::ISupplicant default
+    interface android.hardware.wifi.supplicant@1.4::ISupplicant default
+    class main
+    socket wpa_wlan0 dgram 660 wifi wifi
+    disabled
+    oneshot
diff --git a/core/rootdir/cells/vendor/boringssl_self_test.rc b/core/rootdir/cells/vendor/boringssl_self_test.rc
new file mode 100644
index 0000000..dc08111
--- /dev/null
+++ b/core/rootdir/cells/vendor/boringssl_self_test.rc
@@ -0,0 +1,15 @@
+# Run boringssl self test for each ABI so that later processes can skip it. http://b/139348610
+on early-init && property:ro.product.cpu.abilist32=*
+    exec_start boringssl_self_test32_vendor
+on early-init && property:ro.product.cpu.abilist64=*
+    exec_start boringssl_self_test64_vendor
+
+service boringssl_self_test32_vendor /vendor/bin/boringssl_self_test32
+    setenv BORINGSSL_SELF_TEST_CREATE_FLAG true # Any nonempty value counts as true
+    reboot_on_failure reboot,boringssl-self-check-failed
+    stdio_to_kmsg
+
+service boringssl_self_test64_vendor /vendor/bin/boringssl_self_test64
+    setenv BORINGSSL_SELF_TEST_CREATE_FLAG true # Any nonempty value counts as true
+    reboot_on_failure reboot,boringssl-self-check-failed
+    stdio_to_kmsg
diff --git a/core/rootdir/cells/vendor/chre_daemon.rc b/core/rootdir/cells/vendor/chre_daemon.rc
new file mode 100644
index 0000000..80b4731
--- /dev/null
+++ b/core/rootdir/cells/vendor/chre_daemon.rc
@@ -0,0 +1,24 @@
+##
+## Copyright (C) 2019 The Android Open-Source Project
+##
+## Licensed under the Apache License, Version 2.0 (the "License");
+## you may not use this file except in compliance with the License.
+## You may obtain a copy of the License at
+##
+##      http://www.apache.org/licenses/LICENSE-2.0
+##
+## Unless required by applicable law or agreed to in writing, software
+## distributed under the License is distributed on an "AS IS" BASIS,
+## WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+## See the License for the specific language governing permissions and
+## limitations under the License.
+##
+#
+#service vendor.chre /vendor/bin/chre
+#    class late_start
+#    user context_hub
+#    group wakelock context_hub
+#    capabilities BLOCK_SUSPEND
+#    socket chre seqpacket 0660 root context_hub
+#    shutdown critical
+#
\ No newline at end of file
diff --git a/core/rootdir/cells/vendor/citadeld.rc b/core/rootdir/cells/vendor/citadeld.rc
new file mode 100644
index 0000000..1ab3e7e
--- /dev/null
+++ b/core/rootdir/cells/vendor/citadeld.rc
@@ -0,0 +1,8 @@
+#on property:vendor.all.modules.ready=1
+#   enable vendor.citadeld
+
+#service vendor.citadeld /vendor/bin/hw/citadeld
+#    class early_hal
+#    user hsm
+#    group hsm
+#    disabled
diff --git a/core/rootdir/cells/vendor/cnd-generic.rc b/core/rootdir/cells/vendor/cnd-generic.rc
new file mode 100644
index 0000000..930a045
--- /dev/null
+++ b/core/rootdir/cells/vendor/cnd-generic.rc
@@ -0,0 +1,4 @@
+service vendor.cnd /system/vendor/bin/cnd
+    class main
+    user radio
+    group wifi inet radio wakelock
diff --git a/core/rootdir/cells/vendor/cnss-daemon.rc b/core/rootdir/cells/vendor/cnss-daemon.rc
new file mode 100644
index 0000000..0808442
--- /dev/null
+++ b/core/rootdir/cells/vendor/cnss-daemon.rc
@@ -0,0 +1,2 @@
+on zygote-start
+    mkdir /data/vendor/wifi/cnss_daemon 0770 wifi wifi
diff --git a/core/rootdir/cells/vendor/dataadpl.rc b/core/rootdir/cells/vendor/dataadpl.rc
new file mode 100644
index 0000000..24152a1
--- /dev/null
+++ b/core/rootdir/cells/vendor/dataadpl.rc
@@ -0,0 +1,13 @@
+# Copyright (c) 2019 Qualcomm Technologies, Inc.
+# All Rights Reserved.
+# Confidential and Proprietary - Qualcomm Technologies, Inc.
+
+# Create the directories used by DPM subsystem
+
+#start dataadpl service
+service vendor.dataadpl /system/vendor/bin/adpl
+    class main
+    user radio
+    socket adpl_cmd_uds_file dgram 660 radio radio
+    group radio oem_2901 diag usb inet
+    disabled
\ No newline at end of file
diff --git a/core/rootdir/cells/vendor/dataqti.rc b/core/rootdir/cells/vendor/dataqti.rc
new file mode 100644
index 0000000..4c682b6
--- /dev/null
+++ b/core/rootdir/cells/vendor/dataqti.rc
@@ -0,0 +1,19 @@
+# Copyright (c) 2019 Qualcomm Technologies, Inc.
+# All Rights Reserved.
+# Confidential and Proprietary - Qualcomm Technologies, Inc.
+
+# Create the directories used by DPM subsystem
+
+# msm specific files that need to be created on /data
+on post-fs-data
+    #Create DATAQTI dir for logs
+    mkdir /data/vendor/dataqti 0770 radio radio
+    chmod 0770 /data/vendor/dataqti
+
+#start dataqti service
+service vendor.dataqti /system/vendor/bin/qti
+    class main
+    user radio
+    socket qti_dpm_uds_file dgram 660 radio radio
+    group radio oem_2901 diag usb inet
+    disabled
diff --git a/core/rootdir/cells/vendor/feature_enabler_client.rc b/core/rootdir/cells/vendor/feature_enabler_client.rc
new file mode 100644
index 0000000..d8d9ab2
--- /dev/null
+++ b/core/rootdir/cells/vendor/feature_enabler_client.rc
@@ -0,0 +1,19 @@
+on post-fs-data
+    mkdir /mnt/vendor/persist/data/pfm 0755 system system
+    mkdir /mnt/vendor/persist/data/pfm/licenses 0755 system system
+    chown system system /mnt/vendor/persist/feature_enabler_client
+    chmod 0775 /mnt/vendor/persist/feature_enabler_client
+
+#service feature_enabler_client /vendor/bin/feature_enabler_client
+#    class late_start
+#    user system
+#    group system graphics
+
+on property:init.svc.vendor.qti.hardware.display.composer=stopping
+    stop feature_enabler_client
+
+on property:init.svc.vendor.qti.hardware.display.composer=running
+    start feature_enabler_client
+
+on property:init.svc.vendor.qti.hardware.display.composer=restarting
+    restart feature_enabler_client
diff --git a/core/rootdir/cells/vendor/hostapd.android.rc b/core/rootdir/cells/vendor/hostapd.android.rc
new file mode 100644
index 0000000..7cc45bd
--- /dev/null
+++ b/core/rootdir/cells/vendor/hostapd.android.rc
@@ -0,0 +1,24 @@
+#
+# init.rc fragment for hostapd on Android
+# Copyright (c) 2002-2016, Jouni Malinen <j@w1.fi>
+#
+# This software may be distributed under the terms of the BSD license.
+# See README for more details.
+#
+
+on post-fs-data
+    mkdir /data/vendor/wifi 0770 wifi wifi
+    mkdir /data/vendor/wifi/hostapd 0770 wifi wifi
+    mkdir /data/vendor/wifi/hostapd/sockets 0770 wifi wifi
+
+service hostapd /vendor/bin/hw/hostapd
+    interface android.hardware.wifi.hostapd@1.0::IHostapd default
+    interface android.hardware.wifi.hostapd@1.1::IHostapd default
+    interface android.hardware.wifi.hostapd@1.2::IHostapd default
+    interface android.hardware.wifi.hostapd@1.3::IHostapd default
+    class main
+    capabilities NET_ADMIN NET_RAW
+    user wifi
+    group wifi net_raw net_admin
+    disabled
+    oneshot
diff --git a/core/rootdir/cells/vendor/hw/init.redfin.rc b/core/rootdir/cells/vendor/hw/init.redfin.rc
new file mode 100644
index 0000000..e5e095e
--- /dev/null
+++ b/core/rootdir/cells/vendor/hw/init.redfin.rc
@@ -0,0 +1,63 @@
+#
+# Copyright (C) 2017 The Android Open-Source Project
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#      http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+#
+
+import /cells/vendor/hw/init.${ro.boot.hardware.platform}.rc
+
+on property:graphics.display.kernel_idle_timer.enabled=true
+    # Switch display mode to 60hz when idle
+#   write /sys/devices/platform/soc/soc:qcom,dsi-display-primary/idle_mode "@60"
+
+on property:graphics.display.kernel_idle_timer.enabled=false
+    # Disable aggressive idle mode switching
+#   write /sys/devices/platform/soc/soc:qcom,dsi-display-primary/idle_mode "none"
+
+on property:vendor.all.modules.ready=1
+    chown system system /sys/devices/virtual/sec/tsp/fw_version
+    chown system system /sys/devices/virtual/sec/tsp/cmd
+    chown system system /sys/devices/virtual/sec/tsp/cmd_result
+    chown system system /sys/devices/virtual/sec/tsp/status
+
+service vendor.mdm_helper /vendor/bin/mdm_helper
+    class core
+    group system wakelock
+
+on property:sys.retaildemo.enabled=1
+#   write /sys/class/thermal/cdev-by-name/dc_icl/cur_state 2
+
+on property:sys.retaildemo.enabled=0
+#   write /sys/class/thermal/cdev-by-name/dc_icl/cur_state 0
+
+# Toggle glove_mode according to touch_sensitivity_mode
+#on property:persist.vendor.touch_sensitivity_mode=0 && property:sys.boot_completed=1
+#   write /sys/devices/virtual/sec/tsp/cmd "glove_mode,0"
+
+#on property:persist.vendor.touch_sensitivity_mode=1 && property:sys.boot_completed=1
+#   write /sys/devices/virtual/sec/tsp/cmd "glove_mode,1"
+
+# Route touch_sensitivity_mode to persist
+on property:debug.touch_sensitivity_mode=0
+    setprop persist.vendor.touch_sensitivity_mode 0
+
+on property:debug.touch_sensitivity_mode=1
+    setprop persist.vendor.touch_sensitivity_mode 1
+
+on late-init
+    chown system system /sys/devices/virtual/thermal/tz-by-name/skin-therm-monitor/trip_point_0_temp
+    chown system system /sys/devices/virtual/thermal/tz-by-name/skin-therm-monitor/trip_point_0_hyst
+    chown system system /sys/devices/virtual/thermal/tz-by-name/panel-audio-therm/trip_point_0_temp
+    chown system system /sys/devices/virtual/thermal/tz-by-name/panel-audio-therm/trip_point_0_hyst
+    chown system system /sys/devices/virtual/thermal/tz-by-name/usbc-virt-monitor/trip_point_0_temp
+    chown system system /sys/devices/virtual/thermal/tz-by-name/usbc-virt-monitor/trip_point_0_hyst
diff --git a/core/rootdir/cells/vendor/hw/init.sm7250.diag.rc b/core/rootdir/cells/vendor/hw/init.sm7250.diag.rc
new file mode 100644
index 0000000..16225b9
--- /dev/null
+++ b/core/rootdir/cells/vendor/hw/init.sm7250.diag.rc
@@ -0,0 +1,117 @@
+#
+# Copyright (C) 2018 The Android Open-Source Project
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#      http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+#
+
+on init
+    chmod 666 /dev/diag
+
+on post-fs-data
+    # Modem logging collection
+    mkdir /data/vendor/radio 0777 radio radio
+    mkdir /data/vendor/radio/diag_logs 0777 system system
+    rm /data/vendor/radio/diag_logs/logs/diag_poweron_log.qmdl
+    # WLAN logging collection
+    mkdir /data/vendor/wifi 0777 system system
+    mkdir /data/vendor/wifi/cnss_diag 0777 system system
+
+service diag_mdlog_start /vendor/bin/diag_mdlog
+    class late_start
+    user shell
+    group system diag media_rw
+    socket diag_router stream 0666 system system
+    disabled
+    oneshot
+
+service diag_mdlog_stop /vendor/bin/diag_mdlog -k
+    class late_start
+    user shell
+    group system diag media_rw
+    disabled
+    oneshot
+
+on boot && property:persist.vendor.sys.modem.diag.mdlog=*
+    rm /data/vendor/radio/diag_logs/diag_mdlog_pid
+    setprop vendor.sys.modem.diag.mdlog ${persist.vendor.sys.modem.diag.mdlog}
+
+on property:vendor.sys.modem.diag.mdlog=true && property:persist.vendor.verbose_logging_enabled=true
+    start diag_mdlog_start
+
+on property:vendor.sys.modem.diag.mdlog=false
+    start diag_mdlog_stop
+
+on property:persist.vendor.sys.cnss.diag_qxdm=true
+    start vendor.cnss_diag
+
+on property:persist.vendor.sys.cnss.diag_qxdm=false
+    stop vendor.cnss_diag
+
+on property:persist.vendor.sys.cnss.diag_txt=true
+    start vendor.cnss_diag_txt
+
+on property:persist.vendor.sys.cnss.diag_txt=false
+    stop vendor.cnss_diag_txt
+
+service vendor.cnss_diag /vendor/bin/cnss_diag -q -u -w
+    class late_start
+    user system
+    group system
+    disabled
+    oneshot
+
+service vendor.cnss_diag_txt /vendor/bin/cnss_diag -s -f -P -m /data/vendor/wifi/cnss_diag/cnss_diag.conf -t HELIUM
+    class late_start
+    user system
+    group system
+    disabled
+    oneshot
+
+on property:vendor.debug.ramdump.force_crash=true
+    write /proc/sysrq-trigger "c"
+
+on property:ro.vendor.bluetooth.ftm_enabled=true
+    start ftmd
+
+service ftmd /vendor/bin/ftmdaemon
+    class late_start
+    user root
+    group bluetooth net_bt_admin misc diag net_bt
+    disabled
+    oneshot
+
+on property:vendor.sys.logger.bluetooth=true
+   setprop persist.vendor.service.bdroid.snooplog true
+   setprop persist.vendor.service.bdroid.fwsnoop true
+
+on property:vendor.sys.logger.bluetooth=false
+   setprop persist.vendor.service.bdroid.snooplog false
+   setprop persist.vendor.service.bdroid.fwsnoop false
+
+on property:persist.bluetooth.btsnoopenable=true
+   setprop persist.vendor.service.bdroid.soclog true
+
+on property:persist.bluetooth.btsnoopenable=false
+   setprop persist.vendor.service.bdroid.soclog false
+
+on property:vendor.usb.config=*
+   start usbd
+
+on property:persist.vendor.usb.usbradio.config=*
+   start usbd
+
+on property:power.battery_input.suspended=true
+   write /sys/kernel/debug/google_charger/input_suspend 1
+
+on property:power.battery_input.suspended=false
+   write /sys/kernel/debug/google_charger/input_suspend 0
diff --git a/core/rootdir/cells/vendor/hw/init.sm7250.logging.rc b/core/rootdir/cells/vendor/hw/init.sm7250.logging.rc
new file mode 100644
index 0000000..969d548
--- /dev/null
+++ b/core/rootdir/cells/vendor/hw/init.sm7250.logging.rc
@@ -0,0 +1,4 @@
+on post-fs-data
+    mkdir /data/vendor/modem_dump 0777 system system
+    mkdir /data/vendor/radio/diag_logs/logs 0777 system system
+    mkdir /data/vendor/radio/extended_logs 0770 system radio
diff --git a/core/rootdir/cells/vendor/hw/init.sm7250.mpssrfs.rc b/core/rootdir/cells/vendor/hw/init.sm7250.mpssrfs.rc
new file mode 100644
index 0000000..5939bfc
--- /dev/null
+++ b/core/rootdir/cells/vendor/hw/init.sm7250.mpssrfs.rc
@@ -0,0 +1,11 @@
+on post-fs-data
+    # Modem Remote FS
+    mkdir /data/vendor/rfs      0770 vendor_rfs vendor_rfs
+    mkdir /data/vendor/rfs/mpss 0770 vendor_rfs vendor_rfs
+    mkdir /data/vendor/tombstones/rfs      0770 vendor_rfs vendor_rfs
+    write /data/vendor/rfs/mpss/mcfg_nv_list_flag "1"
+    chown vendor_rfs vendor_rfs /data/vendor/rfs/mpss/mcfg_nv_list_flag
+    chmod 0700 /data/vendor/rfs/mpss/mcfg_nv_list_flag
+
+on property:vendor.sys.modem.diag.efsdump=true
+    chmod 0660 /data/vendor/rfs/mpss/modem_efs
diff --git a/core/rootdir/cells/vendor/hw/init.sm7250.power.rc b/core/rootdir/cells/vendor/hw/init.sm7250.power.rc
new file mode 100644
index 0000000..e5c19f6
--- /dev/null
+++ b/core/rootdir/cells/vendor/hw/init.sm7250.power.rc
@@ -0,0 +1,150 @@
+#
+# Copyright (C) 2017 The Android Open-Source Project
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#      http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+#
+
+on property:vendor.setup.power=1
+    # Enable suspend clock reporting
+#    write /sys/kernel/debug/clk/debug_suspend 1
+
+    # Enable bus-dcvs
+#    write /sys/devices/platform/soc/soc:qcom,cpu-cpu-llcc-bw/devfreq/soc:qcom,cpu-cpu-llcc-bw/governor bw_hwmon
+#    write /sys/devices/platform/soc/soc:qcom,cpu-cpu-llcc-bw/devfreq/soc:qcom,cpu-cpu-llcc-bw/polling_interval 50
+#    write /sys/devices/platform/soc/soc:qcom,cpu-cpu-llcc-bw/devfreq/soc:qcom,cpu-cpu-llcc-bw/bw_hwmon/mbps_zones "2288 4577 7110 9155 12298 14236 16265"
+#    write /sys/devices/platform/soc/soc:qcom,cpu-cpu-llcc-bw/devfreq/soc:qcom,cpu-cpu-llcc-bw/bw_hwmon/sample_ms 4
+#    write /sys/devices/platform/soc/soc:qcom,cpu-cpu-llcc-bw/devfreq/soc:qcom,cpu-cpu-llcc-bw/bw_hwmon/io_percent 68
+#    write /sys/devices/platform/soc/soc:qcom,cpu-cpu-llcc-bw/devfreq/soc:qcom,cpu-cpu-llcc-bw/bw_hwmon/hist_memory 20
+#    write /sys/devices/platform/soc/soc:qcom,cpu-cpu-llcc-bw/devfreq/soc:qcom,cpu-cpu-llcc-bw/bw_hwmon/hyst_length 0
+#    write /sys/devices/platform/soc/soc:qcom,cpu-cpu-llcc-bw/devfreq/soc:qcom,cpu-cpu-llcc-bw/bw_hwmon/down_thres 80
+#    write /sys/devices/platform/soc/soc:qcom,cpu-cpu-llcc-bw/devfreq/soc:qcom,cpu-cpu-llcc-bw/bw_hwmon/guard_band_mbps 0
+#    write /sys/devices/platform/soc/soc:qcom,cpu-cpu-llcc-bw/devfreq/soc:qcom,cpu-cpu-llcc-bw/bw_hwmon/up_scale 250
+#    write /sys/devices/platform/soc/soc:qcom,cpu-cpu-llcc-bw/devfreq/soc:qcom,cpu-cpu-llcc-bw/bw_hwmon/idle_mbps 1600
+
+#    write /sys/devices/platform/soc/soc:qcom,cpu-llcc-ddr-bw/devfreq/soc:qcom,cpu-llcc-ddr-bw/governor bw_hwmon
+#    write /sys/devices/platform/soc/soc:qcom,cpu-llcc-ddr-bw/devfreq/soc:qcom,cpu-llcc-ddr-bw/polling_interval 50
+#    write /sys/devices/platform/soc/soc:qcom,cpu-llcc-ddr-bw/devfreq/soc:qcom,cpu-llcc-ddr-bw/bw_hwmon/mbps_zones "1144 1720 2086 2929 3879 5931 6881 7980"
+#    write /sys/devices/platform/soc/soc:qcom,cpu-llcc-ddr-bw/devfreq/soc:qcom,cpu-llcc-ddr-bw/bw_hwmon/sample_ms 4
+#    write /sys/devices/platform/soc/soc:qcom,cpu-llcc-ddr-bw/devfreq/soc:qcom,cpu-llcc-ddr-bw/bw_hwmon/io_percent 68
+#    write /sys/devices/platform/soc/soc:qcom,cpu-llcc-ddr-bw/devfreq/soc:qcom,cpu-llcc-ddr-bw/bw_hwmon/hist_memory 20
+#    write /sys/devices/platform/soc/soc:qcom,cpu-llcc-ddr-bw/devfreq/soc:qcom,cpu-llcc-ddr-bw/bw_hwmon/hyst_length 0
+#    write /sys/devices/platform/soc/soc:qcom,cpu-llcc-ddr-bw/devfreq/soc:qcom,cpu-llcc-ddr-bw/bw_hwmon/down_thres 80
+#    write /sys/devices/platform/soc/soc:qcom,cpu-llcc-ddr-bw/devfreq/soc:qcom,cpu-llcc-ddr-bw/bw_hwmon/guard_band_mbps 0
+#    write /sys/devices/platform/soc/soc:qcom,cpu-llcc-ddr-bw/devfreq/soc:qcom,cpu-llcc-ddr-bw/bw_hwmon/up_scale 250
+#    write /sys/devices/platform/soc/soc:qcom,cpu-llcc-ddr-bw/devfreq/soc:qcom,cpu-llcc-ddr-bw/bw_hwmon/idle_mbps 1600
+
+#    write /sys/devices/virtual/npu/msm_npu/pwr 1
+#    write /sys/devices/platform/soc/soc:qcom,npu-llcc-ddr-bw/devfreq/soc:qcom,npu-llcc-ddr-bw/governor "bw_hwmon"
+#    write /sys/devices/platform/soc/soc:qcom,npu-llcc-ddr-bw/devfreq/soc:qcom,npu-llcc-ddr-bw/polling_interval 40
+#    write /sys/devices/platform/soc/soc:qcom,npu-llcc-ddr-bw/devfreq/soc:qcom,npu-llcc-ddr-bw/bw_hwmon/mbps_zones "1144 1720 2086 2929 3879 5931 6881 7980"
+#    write /sys/devices/platform/soc/soc:qcom,npu-llcc-ddr-bw/devfreq/soc:qcom,npu-llcc-ddr-bw/bw_hwmon/sample_ms 4
+#    write /sys/devices/platform/soc/soc:qcom,npu-llcc-ddr-bw/devfreq/soc:qcom,npu-llcc-ddr-bw/bw_hwmon/io_percent 80
+#    write /sys/devices/platform/soc/soc:qcom,npu-llcc-ddr-bw/devfreq/soc:qcom,npu-llcc-ddr-bw/bw_hwmon/hist_memory 20
+#    write /sys/devices/platform/soc/soc:qcom,npu-llcc-ddr-bw/devfreq/soc:qcom,npu-llcc-ddr-bw/bw_hwmon/hyst_length 10
+#    write /sys/devices/platform/soc/soc:qcom,npu-llcc-ddr-bw/devfreq/soc:qcom,npu-llcc-ddr-bw/bw_hwmon/down_thres 30
+#    write /sys/devices/platform/soc/soc:qcom,npu-llcc-ddr-bw/devfreq/soc:qcom,npu-llcc-ddr-bw/bw_hwmon/guard_band_mbps 0
+#    write /sys/devices/platform/soc/soc:qcom,npu-llcc-ddr-bw/devfreq/soc:qcom,npu-llcc-ddr-bw/bw_hwmon/up_scale 250
+#    write /sys/devices/platform/soc/soc:qcom,npu-llcc-ddr-bw/devfreq/soc:qcom,npu-llcc-ddr-bw/bw_hwmon/idle_mbps 0
+#    write /sys/devices/virtual/npu/msm_npu/pwr 0
+
+#    write /sys/devices/virtual/npu/msm_npu/pwr 1
+#    write /sys/devices/platform/soc/soc:qcom,npudsp-npu-ddr-bw/devfreq/soc:qcom,npudsp-npu-ddr-bw/governor "bw_hwmon"
+#    write /sys/devices/platform/soc/soc:qcom,npudsp-npu-ddr-bw/devfreq/soc:qcom,npudsp-npu-ddr-bw/polling_interval 40
+#    write /sys/devices/platform/soc/soc:qcom,npudsp-npu-ddr-bw/devfreq/soc:qcom,npudsp-npu-ddr-bw/bw_hwmon/mbps_zones "1144 1720 2086 2929 3879 5931 6881 7980"
+#    write /sys/devices/platform/soc/soc:qcom,npudsp-npu-ddr-bw/devfreq/soc:qcom,npudsp-npu-ddr-bw/bw_hwmon/sample_ms 4
+#    write /sys/devices/platform/soc/soc:qcom,npudsp-npu-ddr-bw/devfreq/soc:qcom,npudsp-npu-ddr-bw/bw_hwmon/io_percent 80
+#    write /sys/devices/platform/soc/soc:qcom,npudsp-npu-ddr-bw/devfreq/soc:qcom,npudsp-npu-ddr-bw/bw_hwmon/hist_memory 20
+#    write /sys/devices/platform/soc/soc:qcom,npudsp-npu-ddr-bw/devfreq/soc:qcom,npudsp-npu-ddr-bw/bw_hwmon/hyst_length 10
+#    write /sys/devices/platform/soc/soc:qcom,npudsp-npu-ddr-bw/devfreq/soc:qcom,npudsp-npu-ddr-bw/bw_hwmon/down_thres 30
+#    write /sys/devices/platform/soc/soc:qcom,npudsp-npu-ddr-bw/devfreq/soc:qcom,npudsp-npu-ddr-bw/bw_hwmon/guard_band_mbps 0
+#    write /sys/devices/platform/soc/soc:qcom,npudsp-npu-ddr-bw/devfreq/soc:qcom,npudsp-npu-ddr-bw/bw_hwmon/up_scale 250
+#    write /sys/devices/platform/soc/soc:qcom,npudsp-npu-ddr-bw/devfreq/soc:qcom,npudsp-npu-ddr-bw/bw_hwmon/idle_mbps 0
+#    write /sys/devices/virtual/npu/msm_npu/pwr 0
+
+#    write /sys/devices/virtual/npu/msm_npu/pwr 1
+#    write /sys/devices/platform/soc/soc:qcom,npu-npu-llcc-bw/devfreq/soc:qcom,npu-npu-llcc-bw/governor "bw_hwmon"
+#    write /sys/devices/platform/soc/soc:qcom,npu-npu-llcc-bw/devfreq/soc:qcom,npu-npu-llcc-bw/polling_interval 40
+#    write /sys/devices/platform/soc/soc:qcom,npu-npu-llcc-bw/devfreq/soc:qcom,npu-npu-llcc-bw/bw_hwmon/mbps_zones "2288 4577 7110 9155 12298 14236 16265"
+#    write /sys/devices/platform/soc/soc:qcom,npu-npu-llcc-bw/devfreq/soc:qcom,npu-npu-llcc-bw/bw_hwmon/sample_ms 4
+#    write /sys/devices/platform/soc/soc:qcom,npu-npu-llcc-bw/devfreq/soc:qcom,npu-npu-llcc-bw/bw_hwmon/io_percent 100
+#    write /sys/devices/platform/soc/soc:qcom,npu-npu-llcc-bw/devfreq/soc:qcom,npu-npu-llcc-bw/bw_hwmon/hist_memory 20
+#    write /sys/devices/platform/soc/soc:qcom,npu-npu-llcc-bw/devfreq/soc:qcom,npu-npu-llcc-bw/bw_hwmon/hyst_length 10
+#    write /sys/devices/platform/soc/soc:qcom,npu-npu-llcc-bw/devfreq/soc:qcom,npu-npu-llcc-bw/bw_hwmon/down_thres 30
+#    write /sys/devices/platform/soc/soc:qcom,npu-npu-llcc-bw/devfreq/soc:qcom,npu-npu-llcc-bw/bw_hwmon/guard_band_mbps 0
+#    write /sys/devices/platform/soc/soc:qcom,npu-npu-llcc-bw/devfreq/soc:qcom,npu-npu-llcc-bw/bw_hwmon/up_scale 250
+#    write /sys/devices/virtual/npu/msm_npu/pwr 0
+
+    #Enable mem_latency governor for L3, LLCC, and DDR scaling
+#    write /sys/devices/platform/soc/soc:qcom,cpu0-cpu-llcc-lat/devfreq/soc:qcom,cpu0-cpu-llcc-lat/governor mem_latency
+#    write /sys/devices/platform/soc/soc:qcom,cpu0-cpu-llcc-lat/devfreq/soc:qcom,cpu0-cpu-llcc-lat/polling_interval 10
+#    write /sys/devices/platform/soc/soc:qcom,cpu0-cpu-llcc-lat/devfreq/soc:qcom,cpu0-cpu-llcc-lat/mem_latency/ratio_ceil 400
+
+#    write /sys/devices/platform/soc/18321000.qcom,devfreq-l3/18321000.qcom,devfreq-l3:qcom,cpu0-cpu-l3-lat/devfreq/18321000.qcom,devfreq-l3:qcom,cpu0-cpu-l3-lat/governor mem_latency
+#    write /sys/devices/platform/soc/18321000.qcom,devfreq-l3/18321000.qcom,devfreq-l3:qcom,cpu0-cpu-l3-lat/devfreq/18321000.qcom,devfreq-l3:qcom,cpu0-cpu-l3-lat/polling_interval 10
+#    write /sys/devices/platform/soc/18321000.qcom,devfreq-l3/18321000.qcom,devfreq-l3:qcom,cpu0-cpu-l3-lat/devfreq/18321000.qcom,devfreq-l3:qcom,cpu0-cpu-l3-lat/mem_latency/ratio_ceil 400
+
+#    write /sys/devices/platform/soc/soc:qcom,cpu0-llcc-ddr-lat/devfreq/soc:qcom,cpu0-llcc-ddr-lat/governor mem_latency
+#    write /sys/devices/platform/soc/soc:qcom,cpu0-llcc-ddr-lat/devfreq/soc:qcom,cpu0-llcc-ddr-lat/polling_interval 10
+#    write /sys/devices/platform/soc/soc:qcom,cpu0-llcc-ddr-lat/devfreq/soc:qcom,cpu0-llcc-ddr-lat/mem_latency/ratio_ceil 400
+
+#    write /sys/devices/platform/soc/soc:qcom,cpu6-cpu-llcc-lat/devfreq/soc:qcom,cpu6-cpu-llcc-lat/governor mem_latency
+#    write /sys/devices/platform/soc/soc:qcom,cpu6-cpu-llcc-lat/devfreq/soc:qcom,cpu6-cpu-llcc-lat/polling_interval 10
+#    write /sys/devices/platform/soc/soc:qcom,cpu6-cpu-llcc-lat/devfreq/soc:qcom,cpu6-cpu-llcc-lat/mem_latency/ratio_ceil 400
+
+#    write /sys/devices/platform/soc/18321000.qcom,devfreq-l3/18321000.qcom,devfreq-l3:qcom,cpu6-cpu-l3-lat/devfreq/18321000.qcom,devfreq-l3:qcom,cpu6-cpu-l3-lat/governor mem_latency
+#    write /sys/devices/platform/soc/18321000.qcom,devfreq-l3/18321000.qcom,devfreq-l3:qcom,cpu6-cpu-l3-lat/devfreq/18321000.qcom,devfreq-l3:qcom,cpu6-cpu-l3-lat/polling_interval 10
+    #Gold L3 ratio ceil
+#    write /sys/devices/platform/soc/18321000.qcom,devfreq-l3/18321000.qcom,devfreq-l3:qcom,cpu6-cpu-l3-lat/devfreq/18321000.qcom,devfreq-l3:qcom,cpu6-cpu-l3-lat/mem_latency/ratio_ceil 4000
+
+#    write /sys/devices/platform/soc/18321000.qcom,devfreq-l3/18321000.qcom,devfreq-l3:qcom,cpu7-cpu-l3-lat/devfreq/18321000.qcom,devfreq-l3:qcom,cpu7-cpu-l3-lat/governor mem_latency
+#    write /sys/devices/platform/soc/18321000.qcom,devfreq-l3/18321000.qcom,devfreq-l3:qcom,cpu7-cpu-l3-lat/devfreq/18321000.qcom,devfreq-l3:qcom,cpu7-cpu-l3-lat/polling_interval 10
+    #Prime L3 ratio ceil
+#    write /sys/devices/platform/soc/18321000.qcom,devfreq-l3/18321000.qcom,devfreq-l3:qcom,cpu7-cpu-l3-lat/devfreq/18321000.qcom,devfreq-l3:qcom,cpu7-cpu-l3-lat/mem_latency/ratio_ceil 4000
+
+#    write /sys/devices/platform/soc/soc:qcom,cpu6-llcc-ddr-lat/devfreq/soc:qcom,cpu6-llcc-ddr-lat/governor mem_latency
+#    write /sys/devices/platform/soc/soc:qcom,cpu6-llcc-ddr-lat/devfreq/soc:qcom,cpu6-llcc-ddr-lat/polling_interval 10
+#    write /sys/devices/platform/soc/soc:qcom,cpu6-llcc-ddr-lat/devfreq/soc:qcom,cpu6-llcc-ddr-lat/mem_latency/ratio_ceil 400
+
+    #Enable compute governor for gold latfloor
+#    write /sys/devices/platform/soc/soc:qcom,cpu0-cpu-ddr-latfloor/devfreq/soc:qcom,cpu0-cpu-ddr-latfloor/governor compute
+#    write /sys/devices/platform/soc/soc:qcom,cpu0-cpu-ddr-latfloor/devfreq/soc:qcom,cpu0-cpu-ddr-latfloor/polling_interval 10
+
+#    write /sys/devices/platform/soc/soc:qcom,cpu6-cpu-ddr-latfloor/devfreq/soc:qcom,cpu6-cpu-ddr-latfloor/governor compute
+#    write /sys/devices/platform/soc/soc:qcom,cpu6-cpu-ddr-latfloor/devfreq/soc:qcom,cpu6-cpu-ddr-latfloor/polling_interval 10
+
+#    write /sys/devices/platform/soc/soc:qcom,cpu7-cpu-ddr-latfloor/devfreq/soc:qcom,cpu7-cpu-ddr-latfloor/governor compute
+#    write /sys/devices/platform/soc/soc:qcom,cpu7-cpu-ddr-latfloor/devfreq/soc:qcom,cpu7-cpu-ddr-latfloor/polling_interval 10
+
+    #Enable cdspl3 governor for L3 cdsp nodes
+#    write /sys/devices/platform/soc/18321000.qcom,devfreq-l3/18321000.qcom,devfreq-l3:qcom,cdsp-cdsp-l3-lat/devfreq/18321000.qcom,devfreq-l3:qcom,cdsp-cdsp-l3-lat/governor cdspl3
+
+    # Enable powersaving
+#    write /sys/module/lpm_levels/parameters/sleep_disabled 0
+
+    # Enable UFS powersaving
+#    write /dev/sys/block/bootdevice/clkgate_enable 1
+
+    # Enable idle state listener
+#    write /sys/class/drm/card0/device/idle_encoder_mask 1
+#    write /sys/class/drm/card0/device/idle_timeout_ms 100
+
+    #Enable PowerHAL hint processing
+    setprop vendor.powerhal.init 1
+
+on boot
+    # Disable console_suspend to get better logging for kernel crashes
+#    write /sys/module/printk/parameters/console_suspend N
+
+# If UART is on, enable console_suspend on boot_complete to save power
+on property:sys.boot_completed=1 && property:init.svc.console=running
+#    write /sys/module/printk/parameters/console_suspend Y
diff --git a/core/rootdir/cells/vendor/hw/init.sm7250.rc b/core/rootdir/cells/vendor/hw/init.sm7250.rc
new file mode 100644
index 0000000..76ea81b
--- /dev/null
+++ b/core/rootdir/cells/vendor/hw/init.sm7250.rc
@@ -0,0 +1,832 @@
+#
+# Copyright (C) 2018 The Android Open-Source Project
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#      http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+#
+
+import /cells/vendor/hw/init.${ro.boot.hardware.platform}.usb.rc
+import /cells/vendor/hw/init.${ro.boot.hardware.platform}.diag.rc
+import /cells/vendor/hw/init.${ro.boot.hardware.platform}.logging.rc
+import /cells/vendor/hw/init.${ro.boot.hardware.platform}.mpssrfs.rc
+import /cells/vendor/hw/init.${ro.boot.hardware.platform}.power.rc
+
+service vendor.charger /system/bin/charger
+    class charger
+    seclabel u:r:charger:s0
+    user system
+    group system wakelock input
+    capabilities SYS_BOOT
+    file /dev/kmsg w
+    file /sys/fs/pstore/console-ramoops-0 r
+    file /sys/fs/pstore/console-ramoops r
+    file /proc/last_kmsg r
+
+on early-init
+    mount debugfs debugfs /sys/kernel/debug
+    chmod 0755 /sys/kernel/debug
+    mount_all /cells/fstab.persist --early
+
+    # configure governor settings
+#    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor schedutil
+#    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/up_rate_limit_us 500
+#    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/down_rate_limit_us 20000
+
+    # configure governor settings for big cluster
+#    write /sys/devices/system/cpu/cpu6/cpufreq/scaling_governor schedutil
+#    write /sys/devices/system/cpu/cpu6/cpufreq/schedutil/up_rate_limit_us 500
+#    write /sys/devices/system/cpu/cpu6/cpufreq/schedutil/down_rate_limit_us 20000
+
+    # configure governor settings for big big CPU
+#    write /sys/devices/system/cpu/cpu7/cpufreq/scaling_governor schedutil
+#    write /sys/devices/system/cpu/cpu7/cpufreq/schedutil/up_rate_limit_us 500
+#    write /sys/devices/system/cpu/cpu7/cpufreq/schedutil/down_rate_limit_us 20000
+
+# Disable VDSO on JAWS boards.
+on early-init && property:ro.revision="DEV1.0"
+#    write /sys/module/vdso/parameters/enable_32 0
+
+# Skip init trigger for charger mode
+on early-init && property:ro.boot.mode=charger
+    setprop vendor.skip.init 1
+    # Loading kernel modules in background
+    start charger_insmod_sh
+
+on init && property:vendor.skip.init=0
+    # Boot time cpuset and stune
+#    write /dev/cpuset/top-app/cpus 0-7
+#    write /dev/cpuset/foreground/cpus 0-7
+#    write /dev/cpuset/background/cpus 0-5
+#    write /dev/cpuset/system-background/cpus 0-5
+#    write /dev/cpuset/restricted/cpus 2-5
+#    write /dev/stune/foreground/schedtune.prefer_idle 1
+#    write /dev/stune/foreground/schedtune.prefer_high_cap 1
+#    write /dev/stune/foreground/schedtune.boost 100
+#    write /dev/stune/schedtune.prefer_idle 1
+#    write /dev/stune/schedtune.prefer_high_cap 1
+#    write /dev/stune/schedtune.boost 100
+#    write /dev/stune/top-app/schedtune.prefer_idle 1
+#    write /dev/stune/top-app/schedtune.prefer_high_cap 1
+#    write /dev/stune/top-app/schedtune.boost 100
+
+    # Boot time fs tuning
+#    write /sys/block/sda/queue/iostats 0
+#    write /sys/block/sda/queue/scheduler cfq
+#    write /sys/block/sda/queue/iosched/slice_idle 0
+#    write /sys/block/sda/queue/nr_requests 256
+
+    # Disable powersaving
+#    write /sys/module/lpm_levels/parameters/sleep_disabled 1
+
+    wait /dev/block/platform/${ro.boot.boot_devices}
+    symlink /dev/block/platform/${ro.boot.boot_devices} /dev/block/bootdevice
+
+    # to access UFS/eMMC sysfs directly
+    symlink /sys/devices/platform/${ro.boot.boot_devices} /dev/sys/block/bootdevice
+
+    # Disable UFS powersaving
+#    write /dev/sys/block/bootdevice/clkgate_enable 0
+
+    # start qseecomd early as we mount system/ vendor/ early
+    # vold needs keymaster that needs qseecomd
+    start vendor.qseecomd
+    start keymaster-4-0
+
+    # start vendor.citadeld
+    # start vendor.keymaster-4-1-citadel
+
+    # Loading kernel modules in background
+    start insmod_sh
+
+    # bring back all cores
+#    write /sys/devices/system/cpu/cpu0/online 1
+#    write /sys/devices/system/cpu/cpu1/online 1
+#    write /sys/devices/system/cpu/cpu2/online 1
+#    write /sys/devices/system/cpu/cpu3/online 1
+#    write /sys/devices/system/cpu/cpu4/online 1
+#    write /sys/devices/system/cpu/cpu5/online 1
+#    write /sys/devices/system/cpu/cpu6/online 1
+#    write /sys/devices/system/cpu/cpu7/online 1
+
+    # ZRAM setup
+#    write /sys/block/zram0/comp_algorithm lz4
+#    write /proc/sys/vm/page-cluster 0
+
+    # Some user code relies on ro.boot.hardware.revision
+    setprop ro.boot.hardware.revision ${ro.revision}
+
+    mkdir /dev/cpuset/camera-daemon-dedicated
+#    write /dev/cpuset/camera-daemon-dedicated/cpus 0-7
+#    write /dev/cpuset/camera-daemon-dedicated/mems 0
+    chown system system /dev/cpuset/camera-daemon-dedicated
+    chown system system /dev/cpuset/camera-daemon-dedicated/tasks
+    chmod 0664 /dev/cpuset/camera-daemon-dedicated/tasks
+
+    # set default schedTune value for camera-daemon
+#    write /dev/stune/camera-daemon/schedtune.prefer_idle 1
+#    write /dev/stune/camera-daemon/schedtune.boost 0
+
+    # Allow PAI targeting per hardware SKU
+    setprop ro.oem.key1 ${ro.boot.hardware.sku}
+
+    # Property used by vintf for sku specific manifests
+    # Property used by NFC for sku specific configurations
+    setprop ro.boot.product.hardware.sku ${ro.boot.hardware.sku}
+
+    # Battery Defender
+    chown system system /sys/devices/platform/soc/soc:google,charger/charge_stop_level
+    chown system system /sys/devices/platform/soc/soc:google,charger/charge_start_level
+    chown system system /sys/devices/platform/soc/soc:google,charger/bd_drainto_soc
+    chown system system /sys/devices/platform/soc/soc:google,charger/bd_recharge_soc
+    chown system system /sys/devices/platform/soc/soc:google,charger/bd_recharge_voltage
+    chown system system /sys/devices/platform/soc/soc:google,charger/bd_resume_abs_temp
+    chown system system /sys/devices/platform/soc/soc:google,charger/bd_resume_soc
+    chown system system /sys/devices/platform/soc/soc:google,charger/bd_resume_temp
+    chown system system /sys/devices/platform/soc/soc:google,charger/bd_resume_time
+    chown system system /sys/devices/platform/soc/soc:google,charger/bd_trigger_temp
+    chown system system /sys/devices/platform/soc/soc:google,charger/bd_trigger_time
+    chown system system /sys/devices/platform/soc/soc:google,charger/bd_trigger_voltage
+    chown system system /sys/devices/platform/soc/soc:google,charger/bd_temp_enable
+    chown system system /sys/devices/platform/soc/soc:google,charger/bd_temp_dry_run
+    chown system system /sys/devices/platform/soc/soc:google,charger/bd_clear
+    chown system system /sys/devices/platform/soc/soc:google,battery/power_supply/battery/aacr_state
+    chown system system /sys/devices/platform/soc/soc:google,battery/power_supply/battery/aacr_cycle_max
+    chown system system /sys/devices/platform/soc/soc:google,battery/power_supply/battery/aacr_cycle_grace
+    chown system system /sys/devices/platform/soc/soc:google,battery/power_supply/battery/bd_trickle_enable
+    chown system system /sys/devices/platform/soc/soc:google,battery/power_supply/battery/bd_trickle_recharge_soc
+    chown system system /sys/devices/platform/soc/soc:google,battery/power_supply/battery/bd_trickle_cnt
+    chown system system /sys/devices/platform/soc/soc:google,battery/power_supply/battery/bd_trickle_dry_run
+    chown system system /sys/devices/platform/soc/soc:google,battery/power_supply/battery/bd_trickle_reset_sec
+    chown system system /sys/devices/platform/soc/soc:google,battery/power_supply/battery/bd_clear
+    chown system system /sys/devices/platform/soc/soc:google,battery/power_supply/battery/health_safety_margin
+    chown system system /sys/class/power_supply/wireless/device/mitigate_threshold
+
+    # report max frequency to unity tasks.
+#    write /proc/sys/kernel/sched_lib_name "UnityMain,libunity.so"
+#    write /proc/sys/kernel/sched_lib_mask_force 255
+
+    # Charge stats (write 0)
+    chown system system /sys/class/power_supply/battery/charge_stats
+
+    # NFC streset tool name
+    setprop persist.vendor.nfc.streset libstreset
+    setprop persist.vendor.se.streset libstreset
+
+on late-init
+    chown system system /sys/devices/virtual/thermal/tz-by-name/cellular-emergency/trip_point_0_temp
+    chown system system /sys/devices/virtual/thermal/tz-by-name/cellular-emergency/trip_point_0_hyst
+    chown system system /sys/devices/virtual/thermal/tz-by-name/soc/mode
+
+on fs
+    mount_all /cells/fstab.${ro.boot.hardware.platform} --early
+
+    mkdir /mnt/vendor/persist/audio 0770 media audio
+    mkdir /mnt/vendor/persist/data 0700 system system
+    mkdir /mnt/vendor/persist/display 0770 system graphics
+    mkdir /mnt/vendor/persist/haptics 0770 system system
+    mkdir /mnt/vendor/persist/rfs 0770 root system
+    mkdir /mnt/vendor/persist/hlos_rfs 0770 root system
+    mkdir /mnt/vendor/persist/oslo 0770 system system
+    mkdir /mnt/vendor/persist/touch 0770 system system
+    chmod 0770 /mnt/vendor/persist/rfs
+    chmod 0770 /mnt/vendor/persist/rfs/shared
+    chmod 0770 /mnt/vendor/persist/rfs/msm
+    chmod 0770 /mnt/vendor/persist/rfs/msm/adsp
+    chmod 0770 /mnt/vendor/persist/rfs/msm/mpss
+    chmod 0770 /mnt/vendor/persist/rfs/msm/slpi
+    chmod 0770 /mnt/vendor/persist/rfs/mdm
+    chmod 0770 /mnt/vendor/persist/rfs/mdm/adsp
+    chmod 0770 /mnt/vendor/persist/rfs/mdm/mpss
+    chmod 0770 /mnt/vendor/persist/rfs/mdm/slpi
+    chmod 0770 /mnt/vendor/persist/rfs/mdm/tn
+    chmod 0770 /mnt/vendor/persist/rfs/apq
+    chmod 0770 /mnt/vendor/persist/rfs/apq/gnss
+    chmod 0770 /mnt/vendor/persist/hlos_rfs
+
+    # for cycle count backup
+    mkdir /mnt/vendor/persist/battery 0700 system system
+
+    # Set up sensors-related directories and permissions
+    chmod 775 /mnt/vendor/persist/sensors
+    chmod 664 /mnt/vendor/persist/sensors/sensors_settings
+    chmod 775 /mnt/vendor/persist/sensors/registry
+    chmod 775 /mnt/vendor/persist/sensors/registry/registry
+    chmod 775 /mnt/vendor/persist/sensors/registry/factory_data
+    chmod 664 /mnt/vendor/persist/sensors/registry/factory_data/sns_fac_registry
+    chmod 664 /mnt/vendor/persist/sensors/registry/registry/sensors_registry
+
+    restorecon_recursive /mnt/vendor/persist
+
+    # Set up camera-related directories and permissions
+    # Add restorecon_recursive command to make sure the restorecon label is persist_camera_file.
+    restorecon_recursive /mnt/vendor/persist/camera
+
+on post-fs
+    # set RLIMIT_MEMLOCK to 64MB
+    setrlimit 8 67108864 67108864
+
+    # Wait qseecomd started
+    wait_for_prop vendor.sys.listeners.registered true
+
+    # load IPA FWs
+    # This must be started when vendor.sys.listeners.registered is true
+#    write /dev/ipa 1
+
+on late-fs
+    # Start services for bootanim
+    #start color_init
+    #wait_for_prop vendor.display.native_display_primaries_ready 1
+    #setprop ro.surface_flinger.display_primary_red ${vendor.display.primary_red}
+    #setprop ro.surface_flinger.display_primary_green ${vendor.display.primary_green}
+    #setprop ro.surface_flinger.display_primary_blue ${vendor.display.primary_blue}
+    #setprop ro.surface_flinger.display_primary_white ${vendor.display.primary_white}
+    # Permission for hwcomposer
+    chown system system /sys/devices/platform/soc/soc:qcom,dsi-display-primary/gamma
+    start surfaceflinger
+    start bootanim
+    start vendor.qti.hardware.display.composer
+    start vendor.qti.hardware.display.allocator
+
+    # Wait for keymaster HALs (TEE and StrongBox)
+    # exec_start wait_for_strongbox
+
+
+    # Mount RW partitions which need run fsck
+    mount_all /cells/fstab.${ro.boot.hardware.platform} --late
+
+    # Required for time_daemon
+    mkdir /mnt/vendor/persist/time 0770 system system
+    chown system system /mnt/vendor/persist/time/ats_1
+    chown system system /mnt/vendor/persist/time/ats_2
+    chown system system /mnt/vendor/persist/time/ats_3
+    chown system system /mnt/vendor/persist/time/ats_4
+    chown system system /mnt/vendor/persist/time/ats_5
+    chown system system /mnt/vendor/persist/time/ats_6
+    chown system system /mnt/vendor/persist/time/ats_7
+    chown system system /mnt/vendor/persist/time/ats_8
+    chown system system /mnt/vendor/persist/time/ats_9
+    chown system system /mnt/vendor/persist/time/ats_10
+    chown system system /mnt/vendor/persist/time/ats_11
+    chown system system /mnt/vendor/persist/time/ats_12
+    chown system system /mnt/vendor/persist/time/ats_13
+    chown system system /mnt/vendor/persist/time/ats_14
+    chown system system /mnt/vendor/persist/time/ats_15
+    chown system system /mnt/vendor/persist/time/ats_16
+
+    # Init sensor specific services
+    start init-sensors-sh
+
+    # Start the twoshay touch service
+    start twoshay
+
+    # turn off vblank irq immediately after turning off
+#    write /sys/module/drm/parameters/vblankoffdelay -1
+
+    # Write build info to kdebuginfo.
+#    write /sys/module/kdebuginfo/parameters/build_info "${ro.product.name}-${ro.build.type} ${ro.build.version.incremental}"
+
+on post-fs-data
+    mkdir /vendor/data/tombstones 0771 system system
+    mkdir /tombstones/modem 0771 system system
+    mkdir /tombstones/lpass 0771 system system
+    mkdir /tombstones/wcnss 0771 system system
+    mkdir /tombstones/dsps 0771 system system
+    mkdir /data/vendor/hbtp 0750 system system
+    mkdir /data/vendor/tloc 0700 system drmrpc
+    mkdir /data/vendor/nnhal 0700 system system
+    mkdir /data/vendor/time 0770 system system
+    mkdir /data/vendor/modem_fdr 0700 root system
+    mkdir /data/vendor/display 0770 system graphics
+    mkdir /data/vendor/camera 0770 system system
+    mkdir /data/vendor/rebootescrow 0770 hsm hsm
+    start vendor.rebootescrow-citadel
+
+on zygote-start
+    # zygote is started in common init.rc
+    # and now we can continue initialize /data/
+    mkdir /data/vendor/ipa 0770 radio radio
+    chown radio radio /data/vendor/ipa
+
+    # Create the directories used by the Wireless subsystem
+    mkdir /data/vendor/wifi 0771 wifi wifi
+    mkdir /data/vendor/wifi/wpa 0770 wifi wifi
+    mkdir /data/vendor/wifi/wpa/sockets 0770 wifi wifi
+
+    # Create the directories used by CnE subsystem
+    mkdir /data/vendor/connectivity 0771 radio radio
+    chown radio radio /data/vendor/connectivity
+
+    # Create directory for radio
+    mkdir /data/vendor/radio 0773 system radio
+    mkdir /data/vendor/modem_stat 0771 system radio
+    write /data/vendor/modem_stat/debug.txt ""
+    chown system radio /data/vendor/modem_stat/debug.txt
+    chmod 0664 /data/vendor/modem_stat/debug.txt
+
+    # Mark the copy complete flag to not completed
+    write /data/vendor/radio/copy_complete 0
+    chown radio radio /data/vendor/radio/copy_complete
+    chmod 0660 /data/vendor/radio/copy_complete
+
+    # File flags for prebuilt ril db file
+    write /data/vendor/radio/prebuilt_db_support 1
+    chown radio radio /data/vendor/radio/prebuilt_db_support
+    chmod 0400 /data/vendor/radio/prebuilt_db_support
+    write /data/vendor/radio/db_check_done 0
+    chown radio radio /data/vendor/radio/db_check_done
+    chmod 0660 /data/vendor/radio/db_check_done
+
+    # Create directories for Location services
+    mkdir /data/vendor/location 0770 gps gps
+    mkdir /data/vendor/location/mq 0770 gps gps
+    mkdir /data/vendor/location/xtwifi 0770 gps gps
+    mkdir /dev/socket/location 0770 gps gps
+    mkdir /dev/socket/location/mq 0770 gps gps
+    mkdir /dev/socket/location/xtra 0770 gps gps
+
+    #Create directories for wifihal services
+    mkdir /dev/socket/wifihal 0770 wifi wifi
+    chmod 2770 /dev/socket/wifihal
+
+on early-boot
+    # Change owner for sensors-related directories
+    chown root system /mnt/vendor/persist/sensors/registry
+    chown root system /mnt/vendor/persist/sensors/registry/registry
+    chown system root /mnt/vendor/persist/sensors/sensors_settings
+    chown root root /mnt/vendor/persist/sensors/registry/registry/sensors_settings
+
+    # Set up sensors-related data directories and permissions
+    mkdir /data/vendor/sensors 0770
+    chown system system /data/vendor/sensors
+    mkdir /data/vendor/sensors/log 0770
+    chown system system /data/vendor/sensors/log
+
+    # Change owner for sensors factory calibrated registries directory
+    chown system system /mnt/vendor/persist/sensors/registry/factory_data
+    chown system system /mnt/vendor/persist/sensors/registry/factory_data/sns_fac_registry
+    restorecon_recursive /mnt/vendor/persist/sensors/registry/factory_data
+
+    # Restore SeLinux Context for preventing temp.json with
+    # incorrect security context
+    restorecon /mnt/vendor/persist/sensors/registry/temp.json
+
+    chmod 770 /mnt/vendor/persist/audio
+    chmod 660 /mnt/vendor/persist/audio/audio.cal
+    chown media audio /mnt/vendor/persist/audio
+    chown audioserver audio /mnt/vendor/persist/audio/audio.cal
+
+    # Set up haptics-related directories and permissions
+    chmod 770 /mnt/vendor/persist/haptics
+    chmod 440 /mnt/vendor/persist/haptics/drv2624.cal
+    chown system system /mnt/vendor/persist/haptics
+    chown system system /mnt/vendor/persist/haptics/drv2624.cal
+
+    # Set up oslo-related directories and permissions
+    chmod 770 /mnt/vendor/persist/oslo
+    chmod 660 /mnt/vendor/persist/oslo/oslo.cal
+    chown system system /mnt/vendor/persist/oslo
+    chown system system /mnt/vendor/persist/oslo/oslo.cal
+
+    # Set up touch directories and permissions
+    chmod 770 /mnt/vendor/persist/touch
+    chown system system /mnt/vendor/persist/touch
+
+    # Permission for lights driver
+    chown system system /sys/class/backlight/panel0-backlight/brightness
+    chown system system /sys/class/backlight/panel0-backlight/vr_mode
+    chown system system /sys/class/backlight/panel0-backlight/hbm_mode
+    chown system system /sys/class/backlight/panel0-backlight/als_table
+    chown system system /sys/devices/platform/soc/soc:qcom,dsi-display-primary/te2_table
+
+    # Wait for insmod_sh to finish all modules
+    wait_for_prop vendor.all.modules.ready 1
+
+    # Update dm-verity state and set partition.*.verified properties
+    verity_update_state
+
+    # Wait for insmod_sh to finish all boot devices
+    wait_for_prop vendor.all.devices.ready 1
+
+    # Permission for Vibrator
+    chown system system /sys/class/leds/vibrator/device/mode
+    chown system system /sys/class/leds/vibrator/device/od_clamp
+    chown system system /sys/class/leds/vibrator/device/rtp_input
+    chown system system /sys/class/leds/vibrator/device/scale
+    chown system system /sys/class/leds/vibrator/device/set_sequencer
+    chown system system /sys/class/leds/vibrator/device/autocal_result
+    chown system system /sys/class/leds/vibrator/device/ctrl_loop
+    chown system system /sys/class/leds/vibrator/device/ol_lra_period
+    chown system system /sys/class/leds/vibrator/device/autocal
+    chown system system /sys/class/leds/vibrator/device/lp_trigger_effect
+    chown system system /sys/class/leds/vibrator/device/lra_wave_shape
+#    write /sys/class/leds/vibrator/trigger transient
+
+    # Permission for rainbow sensor
+    chown system system /sys/devices/platform/soc/994000.i2c/i2c-3/3-0020/rainbow_enable
+    chmod 0660 /sys/devices/platform/soc/994000.i2c/i2c-3/3-0020/rainbow_enable
+    chown system system /sys/devices/platform/soc/994000.i2c/i2c-3/3-0020/rainbow_read_byte
+    chmod 0660 /sys/devices/platform/soc/994000.i2c/i2c-3/3-0020/rainbow_read_byte
+    chown system system /sys/devices/platform/soc/994000.i2c/i2c-3/3-0020/rainbow_write_byte
+    chmod 0660 /sys/devices/platform/soc/994000.i2c/i2c-3/3-0020/rainbow_write_byte
+    chown system system /dev/vd6281
+    chmod 0660 /dev/vd6281
+    chown system system /mnt/vendor/persist/camera/rals_fac_test
+    chmod 0660 /mnt/vendor/persist/camera/rals_fac_test
+
+    # FG cycle count read from dumpstate + backup restore from health HAL (and pixelstats)
+    chown system system /sys/class/power_supply/maxfg/cycle_counts_bins
+
+    # Permission for battery eeprom
+    chown system system /sys/devices/platform/soc/98c000.i2c/i2c-1/1-0050/1-00500/nvmem
+    chmod 0640 /sys/devices/platform/soc/98c000.i2c/i2c-1/1-0050/1-00500/nvmem
+    chown system system /dev/battery_history
+    chmod 0644 /dev/battery_history
+
+    # Permission for Pixelstats
+    chown system system /sys/class/misc/msm_cirrus_playback/resistance_left_right
+    chown system system /dev/sys/block/bootdevice/slowio_read_cnt
+    chown system system /dev/sys/block/bootdevice/slowio_write_cnt
+    chown system system /dev/sys/block/bootdevice/slowio_unmap_cnt
+    chown system system /dev/sys/block/bootdevice/slowio_sync_cnt
+
+    # Permission for Health Storage HAL
+    chown system system /dev/sys/block/bootdevice/manual_gc
+
+    # Permissions for reading display native color gamut
+    chown system graphics /mnt/vendor/persist/display/native_gamut.csv
+
+on boot
+    # This location is used by QCRIL to host UNIX domain
+    # socket files used for internal IPC within QCRIL
+    # modules
+    mkdir /dev/socket/qmux_radio 0770 radio radio
+    chmod 2770 /dev/socket/qmux_radio
+
+    setprop wifi.interface wlan0
+    setprop wifi.aware.interface wifi-aware0
+
+    chown system system /sys/kernel/hbtp/display_pwr
+
+    start init-modem-sh
+
+    start rfs_access
+
+    # default country code
+    setprop ro.boot.wificountrycode 00
+
+    # WLAN debug access
+    chown system system /d/icnss/stats
+
+service init-radio-sh /vendor/bin/init.radio.sh
+    class late_start
+    user radio
+    group root radio
+    oneshot
+
+service init-modem-sh /vendor/bin/init.modem.sh
+    class core
+    user radio
+    group root radio
+    oneshot
+
+on property:init.svc.vendor.charger=running
+    stop vendor.qseecomd
+    stop keymaster-4-0
+
+    setprop sys.usb.configfs 1
+    setprop vendor.setup.power 1
+
+    # keep one little and one big without big+
+#    write /sys/devices/system/cpu/cpu1/online 0
+#    write /sys/devices/system/cpu/cpu2/online 0
+#    write /sys/devices/system/cpu/cpu3/online 0
+#    write /sys/devices/system/cpu/cpu4/online 0
+#    write /sys/devices/system/cpu/cpu5/online 0
+#    write /sys/devices/system/cpu/cpu7/online 0
+
+on property:sys.boot_completed=1
+    setprop vendor.setup.power 1
+
+    # Runtime fs tuning
+#    write /sys/block/sda/queue/nr_requests 128
+#    write /sys/block/sda/queue/iostats 1
+
+    # Block layer tuning: discard chunk size up to 128MB
+    # Otherwise, contiguous discards can be merged
+#    write /sys/block/sda/queue/discard_max_bytes 134217728
+
+    # Back to default VM settings
+#    write /proc/sys/vm/dirty_expire_centisecs 3000
+#    write /proc/sys/vm/dirty_background_ratio 10
+
+    # Enable ZRAM on boot_complete
+    swapon_all /cells/fstab.${ro.boot.hardware.platform}
+#    write /proc/sys/vm/swappiness 100
+
+    # Setup runtime cpusets
+#    write /dev/cpuset/top-app/cpus 0-7
+#    write /dev/cpuset/foreground/cpus 0-5,7
+#    write /dev/cpuset/background/cpus 4-5
+#    write /dev/cpuset/system-background/cpus 2-5
+#    write /dev/cpuset/restricted/cpus 2-5
+
+    # Setup runtime schedTune
+#    write /dev/stune/foreground/schedtune.prefer_idle 1
+#    write /dev/stune/foreground/schedtune.prefer_high_cap 0
+#    write /dev/stune/foreground/schedtune.boost 0
+#    write /dev/stune/schedtune.prefer_idle 0
+#    write /dev/stune/schedtune.prefer_high_cap 0
+#    write /dev/stune/schedtune.boost 0
+#    write /dev/stune/top-app/schedtune.prefer_idle 1
+#    write /dev/stune/top-app/schedtune.prefer_high_cap 0
+#    write /dev/stune/top-app/schedtune.boost 10
+
+    # Setup runtime blkio
+    # value for group_idle is us
+#    write /dev/blkio/blkio.weight 1000
+#    write /dev/blkio/background/blkio.weight 200
+#    write /dev/blkio/blkio.group_idle 2000
+#    write /dev/blkio/background/blkio.group_idle 0
+
+    # HardwareInfo needs to be able to read display info
+    chmod 444 /sys/devices/platform/soc/soc:qcom,dsi-display-primary/panel_info/panel0/serial_number
+    chmod 444 /sys/devices/platform/soc/soc:qcom,dsi-display-primary/panel_info/panel0/panel_vendor_name
+    chmod 444 /sys/devices/platform/soc/soc:qcom,dsi-display-primary/panel_info/panel0/panel_extinfo
+
+    # Maxim FG dump for dumpstate
+    chown system system /sys/kernel/debug/regmap/1-0036/registers
+    chown system system /sys/kernel/debug/regmap/1-000b/registers
+    chown system system /sys/kernel/debug/google_battery/cycle_count_bins
+    chown system system /sys/kernel/debug/google_battery/ssoc_gdf
+    chown system system /sys/kernel/debug/google_battery/ssoc_rls
+    chown system system /sys/kernel/debug/google_battery/ssoc_uic
+    chown system system /sys/kernel/debug/google_battery/ssoc_uicurve
+    chown system system /sys/kernel/debug/google_charger/pps_op_ua
+    chown system system /sys/kernel/debug/google_charger/pps_out_uv
+
+    # Permission for wireless charging
+    chown system system /sys/class/power_supply/wireless/capacity
+    chmod 0660 /sys/class/power_supply/wireless/capacity
+    chown system system /sys/devices/platform/soc/98c000.i2c/i2c-1/1-003b/rtx
+    chmod 0660 /sys/devices/platform/soc/98c000.i2c/i2c-1/1-003b/rtx
+
+    chown system system /sys/devices/platform/soc/98c000.i2c/i2c-1/1-003b/rxdata
+    chown system system /sys/devices/platform/soc/98c000.i2c/i2c-1/1-003b/txdata
+    chown system system /sys/devices/platform/soc/98c000.i2c/i2c-1/1-003b/rxlen
+    chown system system /sys/devices/platform/soc/98c000.i2c/i2c-1/1-003b/txlen
+    chown system system /sys/devices/platform/soc/98c000.i2c/i2c-1/1-003b/ccreset
+    chown system system /sys/devices/platform/soc/98c000.i2c/i2c-1/1-003b/status
+    chown system system /sys/devices/platform/soc/98c000.i2c/i2c-1/1-003b/version
+
+    # Permission for bootloader logs
+    chown root log /proc/bldrlog
+    chmod 0444 /proc/bldrlog
+
+on property:persist.vendor.hvdcp_opti.start=1
+    chown root system /sys/class/power_supply/bms/soh
+    chown root system /sys/class/power_supply/bms/esr_actual
+    chown root system /sys/class/power_supply/bms/esr_nominal
+
+service vendor.per_mgr /vendor/bin/pm-service
+    user system
+    group system
+    ioprio rt 4
+
+service per_proxy /vendor/bin/pm-proxy
+    class core
+    user system
+    group system
+    disabled
+
+on property:init.svc.vendor.per_mgr=running
+    start per_proxy
+
+# Start per_mgr daemon to boot modem as esim reset is done or not needed
+on property:persist.vendor.modem.esim.reset=done
+    start vendor.per_mgr
+
+on property:persist.vendor.modem.esim.reset=noneed
+    start vendor.per_mgr
+
+# Force to start per_mgr daemon as boot completed
+on property:sys.boot_completed=1
+    start vendor.per_mgr
+
+on property:sys.shutdown.requested=*
+    stop per_proxy
+
+service vendor.qseecomd /vendor/bin/qseecomd
+    class core
+    user root
+    group root
+
+service init-sensors-sh /vendor/bin/init.sensors.sh
+    class main
+    user root
+    group root system
+    disabled
+    oneshot
+
+#service vendor.adsprpcd /vendor/bin/adsprpcd
+#   class main
+#   user system
+#   group media
+
+#service vendor.adsprpcd_audiopd /vendor/bin/adsprpcd audiopd
+#   class main
+#   user media
+#   group media
+
+#service vendor.cdsprpcd /vendor/bin/cdsprpcd
+#   class main
+#   user system
+#   group system
+
+#service wait_for_strongbox /vendor/bin/hw/wait_for_strongbox
+#    user root
+#    group root system
+#    priority -20
+#    ioprio rt 0
+
+#service vendor.qrtr-ns /vendor/bin/qrtr-ns -f
+#   class core
+#   user vendor_qrtr
+#   group vendor_qrtr
+#   capabilities NET_BIND_SERVICE
+
+service irsc_util /vendor/bin/irsc_util "/vendor/etc/sec_config"
+   class core
+   user root
+   oneshot
+
+service modem_svc /vendor/bin/modem_svc -q
+   class core
+   user root
+   group system
+   capabilities NET_BIND_SERVICE
+
+service vendor.ss_ramdump /vendor/bin/subsystem_ramdump
+    class main
+    user root
+    group system
+    disabled
+
+service vendor.ssr_setup /vendor/bin/ssr_setup
+    oneshot
+    disabled
+
+on property:persist.vendor.sys.ssr.restart_level=*
+    start vendor.ssr_setup
+
+on post-fs-data && property:persist.vendor.sys.ssr.enable_ramdumps=1 && property:vendor.skip.init=0
+#    write /sys/module/subsystem_restart/parameters/enable_ramdumps 1
+    mkdir /data/vendor/wifidump 771 root system
+    mkdir /data/vendor/ramdump 771 root system
+    mkdir /data/vendor/ssrdump 771 root system
+    mkdir /data/vendor/ssrlog  775 root system
+    start vendor.ss_ramdump
+
+on property:persist.vendor.sys.ssr.enable_ramdumps=0
+#    write /sys/module/subsystem_restart/parameters/enable_ramdumps 0
+
+on property:init.svc.vendor.qti.hardware.display.composer=stopped
+    stop ppd
+
+on property:init.svc.vendor.qti.hardware.display.composer=running
+    start ppd
+
+# Start daemon after boot completed
+on property:sys.boot_completed=1
+    start vendor.ssgtzd
+
+# Used 'disabled' flag, so daemon won't be started until explicit start
+service vendor.ssgtzd /vendor/bin/ssgtzd
+    class late_start
+    user system
+    group system
+    disabled
+    socket ssgtzd stream 0660 system inet
+
+# charger driver exposes now finer grain control, map demo mode to those properties
+# NOTE: demo mode can only be exit wiping data (which reset the persist properties)
+on property:sys.retaildemo.enabled=1
+    setprop persist.vendor.charge.stop.level 35
+    setprop persist.vendor.charge.start.level 30
+
+# Test Harness Mode default battery profile. Restricted but not too restricted.
+on  property:persist.sys.test_harness=1 && property:persist.vendor.testing_battery_profile=0
+    setprop persist.vendor.charge.stop.level 70
+    setprop persist.vendor.charge.start.level 35
+    setprop vendor.battery.defender.disable 1
+
+# Extremely restricted battery profile.
+on  property:persist.sys.test_harness=1 && property:persist.vendor.testing_battery_profile=1
+    setprop persist.vendor.charge.stop.level 50
+    setprop persist.vendor.charge.start.level 35
+    setprop vendor.battery.defender.disable 1
+
+# Normal behavior (as if the device was a regular device)
+on  property:persist.sys.test_harness=1 && property:persist.vendor.testing_battery_profile=2
+    setprop persist.vendor.charge.stop.level 100
+    setprop persist.vendor.charge.start.level 0
+
+# Unrestricted, allows charging to 100%
+on  property:persist.sys.test_harness=1 && property:persist.vendor.testing_battery_profile=3
+    setprop persist.vendor.charge.stop.level 100
+    setprop persist.vendor.charge.start.level 0
+    setprop vendor.battery.defender.disable 1
+
+service insmod_sh /vendor/bin/init.insmod.sh /vendor/etc/init.insmod.${ro.hardware}.cfg
+    class main
+    user root
+    group root system
+    disabled
+    oneshot
+
+service charger_insmod_sh /vendor/bin/init.insmod.sh /vendor/etc/init.insmod.charger.cfg
+    class main
+    user root
+    group root system
+    disabled
+    oneshot
+
+service vendor.msm_irqbalance /vendor/bin/msm_irqbalance -f /vendor/etc/msm_irqbalance.conf
+    socket msm_irqbalance seqpacket 660 root system
+    class core
+    user root
+    group root
+    writepid /dev/cpuset/system-background/tasks
+
+service pd_mapper /vendor/bin/pd-mapper
+     class core
+     user system
+     group system
+     capabilities NET_BIND_SERVICE
+
+#service cnss-daemon /vendor/bin/cnss-daemon -n -l
+#   class late_start
+#   user system
+#   group system inet wifi
+
+service loc_launcher /vendor/bin/loc_launcher
+    class late_start
+    user gps
+    group gps
+
+# Allow access to touch
+on property:vendor.all.modules.ready=1
+    chown system input /dev/touch_offload
+    chmod 660 /dev/touch_offload
+
+# Conditionally enable the twoshay touch service
+on property:persist.vendor.enable_twoshay=1
+    enable twoshay
+
+# bugreport is triggered by holding down volume down, volume up and power
+service bugreport /system/bin/dumpstate -d -p -z
+    class main
+    disabled
+    oneshot
+    keycodes 114 115 116
+
+# DSDS feature
+# Set to Dual-sim mode based on CDT setting
+on property:ro.boot.hardware.dsds=1
+    setprop persist.radio.multisim.config dsds
+
+# Restart 1st qcrild after SIM config changed
+#on property:vendor.radio.sim_num.switch=1to2 && property:persist.radio.multisim.config=dsds
+#    restart vendor.qcrild
+
+#on property:vendor.radio.sim_num.switch=2to1 && property:persist.radio.multisim.config=
+#    restart vendor.qcrild
+
+# Enable 2nd qcrild when the property set to dsds
+#on property:persist.radio.multisim.config=dsds
+#    start vendor.qcrild2
+
+# Stop 2nd qcrild when the property set to empty string
+#on property:persist.radio.multisim.config=
+#    stop vendor.qcrild2
+
+# For Japan radio builds, always enforce camera shutter sound
+# Since this property is read by the audio server in system service,
+# it should be written by the system init.
+on property:ro.boot.hardware.radio.subtype=1
+    setprop audio.camerasound.force true
+# BUG FIX: b/163674593
+on property:ro.boot.hardware.sku=G5NZ6
+    setprop audio.camerasound.force true
+
+on property:persist.sys.device_provisioned=1
+    setprop dalvik.vm.dex2oat-cpu-set 0,1,2,3,4,5,7
+    setprop dalvik.vm.dex2oat-threads 6
diff --git a/core/rootdir/cells/vendor/hw/init.sm7250.usb.rc b/core/rootdir/cells/vendor/hw/init.sm7250.usb.rc
new file mode 100644
index 0000000..5b76799
--- /dev/null
+++ b/core/rootdir/cells/vendor/hw/init.sm7250.usb.rc
@@ -0,0 +1,112 @@
+#
+# Copyright (C) 2020 The Android Open-Source Project
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#      http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+#
+
+on post-fs-data
+    mkdir /config/usb_gadget/g1 0770
+    mkdir /config/usb_gadget/g1/strings/0x409 0770
+    write /config/usb_gadget/g1/bcdUSB 0x0200
+    write /config/usb_gadget/g1/idVendor 0x18d1
+    write /config/usb_gadget/g1/bcdDevice 0x0440
+    write /config/usb_gadget/g1/strings/0x409/serialnumber ${ro.serialno}
+    write /config/usb_gadget/g1/strings/0x409/manufacturer ${ro.product.manufacturer}
+    write /config/usb_gadget/g1/strings/0x409/product ${ro.product.model}
+    mkdir /config/usb_gadget/g1/functions/accessory.gs2
+    mkdir /config/usb_gadget/g1/functions/audio_source.gs3
+    mkdir /config/usb_gadget/g1/functions/midi.gs5
+    mkdir /config/usb_gadget/g1/functions/ffs.adb
+    mkdir /config/usb_gadget/g1/functions/ffs.mtp
+    mkdir /config/usb_gadget/g1/functions/ffs.ptp
+    mkdir /config/usb_gadget/g1/functions/diag.diag
+    mkdir /config/usb_gadget/g1/functions/diag.diag_mdm
+    mkdir /config/usb_gadget/g1/functions/cser.dun.0
+    mkdir /config/usb_gadget/g1/functions/cser.nmea.1
+    mkdir /config/usb_gadget/g1/functions/gsi.rmnet
+    mkdir /config/usb_gadget/g1/functions/gsi.rndis
+    mkdir /config/usb_gadget/g1/functions/gsi.dpl
+    mkdir /config/usb_gadget/g1/functions/qdss.qdss
+    mkdir /config/usb_gadget/g1/functions/qdss.qdss_mdm
+    mkdir /config/usb_gadget/g1/configs/b.1 0770
+    write /config/usb_gadget/g1/os_desc/b_vendor_code 0x1
+    write /config/usb_gadget/g1/os_desc/qw_sign "MSFT100"
+    mkdir /dev/usb-ffs 0775 shell shell
+    mkdir /dev/usb-ffs/adb 0770 shell shell
+#    mount functionfs adb /dev/usb-ffs/adb rmode=0770,fmode=0660,uid=2000,gid=2000,no_disconnect=1
+    mkdir /dev/usb-ffs/mtp 0770 mtp mtp
+    mkdir /dev/usb-ffs/ptp 0770 mtp mtp
+#    mount functionfs mtp /dev/usb-ffs/mtp rmode=0770,fmode=0660,uid=1024,gid=1024,no_disconnect=1
+#    mount functionfs ptp /dev/usb-ffs/ptp rmode=0770,fmode=0660,uid=1024,gid=1024,no_disconnect=1
+    setprop sys.usb.mtp.device_type 3
+    setprop sys.usb.mtp.batchcancel true
+    setprop sys.usb.controller "a600000.dwc3"
+    symlink /config/usb_gadget/g1/configs/b.1 /config/usb_gadget/g1/os_desc/b.1
+    write /sys/module/libcomposite/parameters/disable_l1_for_hs "y"
+    write /config/usb_gadget/g1/functions/gsi.rndis/rndis_class_id 1
+    # change /config/usb_gadget permission
+    start init-gadgethal-sh
+
+on property:init.svc.console=running
+    write /sys/class/power_supply/usb/moisture_detection_enabled 0
+
+on property:vendor.usb.contaminantdisable=true
+    write /sys/class/power_supply/usb/moisture_detection_enabled 0
+
+on property:init.svc.vendor.charger=running
+    write /sys/class/typec/port0/port_type sink
+
+on boot
+    setprop sys.usb.configfs 2
+    write /sys/module/qpnp_pdphy/drivers/platform:qpnp-pdphy/c440000.qcom,spmi:qcom,pm7250b@2:qcom,usb-pdphy@1700/usbpd0/pdo "5V3A"
+
+on property:sys.usb.config=none && property:sys.usb.configfs=1
+    rm /config/usb_gadget/g1/configs/b.1/f1
+    rm /config/usb_gadget/g1/configs/b.1/f2
+    rm /config/usb_gadget/g1/configs/b.1/f3
+    rm /config/usb_gadget/g1/configs/b.1/f4
+    rm /config/usb_gadget/g1/configs/b.1/f5
+    rm /config/usb_gadget/g1/configs/b.1/f6
+    rm /config/usb_gadget/g1/configs/b.1/f7
+    rm /config/usb_gadget/g1/configs/b.1/f8
+    rm /config/usb_gadget/g1/configs/b.1/f9
+
+on charger
+    mkdir /config/usb_gadget/g1 0770
+    mkdir /config/usb_gadget/g1/strings/0x409 0770
+    write /config/usb_gadget/g1/bcdUSB 0x0200
+    write /config/usb_gadget/g1/idVendor 0x18d1
+    write /config/usb_gadget/g1/bcdDevice 0x0440
+    write /config/usb_gadget/g1/strings/0x409/serialnumber ${ro.serialno}
+    write /config/usb_gadget/g1/strings/0x409/manufacturer Google
+    write /config/usb_gadget/g1/strings/0x409/product Pixel
+    mkdir /config/usb_gadget/g1/functions/midi.gs5
+    mkdir /config/usb_gadget/g1/configs/b.1 0770
+    mkdir /config/usb_gadget/g1/configs/b.1/strings/0x409 0770
+    symlink /config/usb_gadget/g1/configs/b.1 /config/usb_gadget/g1/os_desc/b.1
+    setprop sys.usb.controller "a600000.dwc3"
+
+on property:ro.bootmode=charger
+    setprop sys.usb.config midi
+
+on property:sys.usb.config=midi && property:sys.usb.configfs=1
+    write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "midi"
+    rm /config/usb_gadget/g1/configs/b.1/f1
+    rm /config/usb_gadget/g1/configs/b.1/f2
+    rm /config/usb_gadget/g1/configs/b.1/f3
+    rm /config/usb_gadget/g1/configs/b.1/f4
+    write /config/usb_gadget/g1/idVendor 0x18d1
+    write /config/usb_gadget/g1/idProduct 0x4eea
+    symlink /config/usb_gadget/g1/functions/midi.gs5 /config/usb_gadget/g1/configs/b.1/f1
+    write /config/usb_gadget/g1/UDC ${sys.usb.controller}
+    setprop sys.usb.state ${sys.usb.config}
diff --git a/core/rootdir/cells/vendor/ims_rtp_daemon.rc b/core/rootdir/cells/vendor/ims_rtp_daemon.rc
new file mode 100644
index 0000000..f2fdc43
--- /dev/null
+++ b/core/rootdir/cells/vendor/ims_rtp_daemon.rc
@@ -0,0 +1,13 @@
+# Copyright (c) 2019 Qualcomm Technologies, Inc.
+# All Rights Reserved.
+# Confidential and Proprietary - Qualcomm Technologies, Inc.
+#
+
+# imsdatadaemon starts with root and UID will be downgraded to RADIO.
+#service vendor.ims_rtp_daemon /vendor/bin/ims_rtp_daemon
+#    class main
+#    user radio
+#    group radio inet log
+
+#on property:vendor.ims.DATA_DAEMON_STATUS=1
+#    restart vendor.ims_rtp_daemon
diff --git a/core/rootdir/cells/vendor/imsdatadaemon.rc b/core/rootdir/cells/vendor/imsdatadaemon.rc
new file mode 100644
index 0000000..5a2f814
--- /dev/null
+++ b/core/rootdir/cells/vendor/imsdatadaemon.rc
@@ -0,0 +1,15 @@
+# Copyright (c) 2019 Qualcomm Technologies, Inc.
+# All Rights Reserved.
+# Confidential and Proprietary - Qualcomm Technologies, Inc.
+#
+
+# imsdatadaemon starts with root and UID will be downgraded to RADIO.
+#service vendor.imsdatadaemon /vendor/bin/imsdatadaemon
+#    class main
+#    user radio
+#    socket ims_datad stream 0660 system radio
+#    group radio wifi inet log
+#    disabled
+
+#on property:vendor.ims.QMI_DAEMON_STATUS=1
+#    start vendor.imsdatadaemon
diff --git a/core/rootdir/cells/vendor/imsqmidaemon.rc b/core/rootdir/cells/vendor/imsqmidaemon.rc
new file mode 100644
index 0000000..2b47133
--- /dev/null
+++ b/core/rootdir/cells/vendor/imsqmidaemon.rc
@@ -0,0 +1,10 @@
+# Copyright (c) 2019 Qualcomm Technologies, Inc.
+# All Rights Reserved.
+# Confidential and Proprietary - Qualcomm Technologies, Inc.
+#
+
+#service vendor.imsqmidaemon /vendor/bin/imsqmidaemon
+#    class main
+#    user radio
+#    socket ims_qmid stream 0660 system radio
+#    group radio log
diff --git a/core/rootdir/cells/vendor/imsrcsd.rc b/core/rootdir/cells/vendor/imsrcsd.rc
new file mode 100644
index 0000000..fa77901
--- /dev/null
+++ b/core/rootdir/cells/vendor/imsrcsd.rc
@@ -0,0 +1,8 @@
+# Copyright (c) 2019 Qualcomm Technologies, Inc.
+# All Rights Reserved.
+# Confidential and Proprietary - Qualcomm Technologies, Inc.
+#
+#service vendor.imsrcsservice /vendor/bin/imsrcsd
+#    class main
+#    user radio
+#    group radio log inet wakelock
diff --git a/core/rootdir/cells/vendor/init-ramdump.rc b/core/rootdir/cells/vendor/init-ramdump.rc
new file mode 100644
index 0000000..7da9b09
--- /dev/null
+++ b/core/rootdir/cells/vendor/init-ramdump.rc
@@ -0,0 +1,16 @@
+on boot
+    # Prepare mountpoint for ramdumpfs.
+    mkdir /data/vendor/ramdump 0761 root system
+    restorecon /data/vendor/ramdump
+    mkdir /mnt/vendor/ramdump 0750 root system
+    restorecon /mnt/vendor/ramdump
+    start vendor.ramdump_auto
+
+service vendor.ramdump_auto /vendor/bin/ramdump -a
+    disabled
+    oneshot
+    ioprio idle 0
+    writepid /dev/blkio/background/tasks
+
+on property:ro.boot.ramdump=detected
+    setprop debug.ramdump "detected"
diff --git a/core/rootdir/cells/vendor/init-ramoops.rc b/core/rootdir/cells/vendor/init-ramoops.rc
new file mode 100644
index 0000000..9c0b7f0
--- /dev/null
+++ b/core/rootdir/cells/vendor/init-ramoops.rc
@@ -0,0 +1,29 @@
+on property:sys.user.0.ce_available=true
+    mkdir /data/vendor_ce/0/ramoops
+    restorecon_recursive /data/vendor_ce/0/ramoops
+    start vendor.ramoops_sh
+
+on property:vendor.ramoops.decrypted=true
+    mount pstore pstore /sys/fs/pstore
+    chown system log /sys/fs/pstore
+    chown system log /sys/fs/pstore/console-ramoops
+    chmod 0440 /sys/fs/pstore/console-ramoops
+    chown system log /sys/fs/pstore/console-ramoops-0
+    chmod 0440 /sys/fs/pstore/console-ramoops-0
+    chown system log /sys/fs/pstore/pmsg-ramoops-0
+    chmod 0440 /sys/fs/pstore/pmsg-ramoops-0
+
+on boot
+    # Encrypted ramoops
+    umount /sys/fs/pstore
+    chmod 770 /dev/access-ramoops
+    chown system system /dev/access-ramoops
+    chmod 770 /dev/access-metadata
+    chown system system /dev/access-metadata
+
+service vendor.ramoops_sh /vendor/bin/init.ramoops.sh
+    class main
+    user root
+    group root system
+    disabled
+    oneshot
diff --git a/core/rootdir/cells/vendor/init.pixel.rc b/core/rootdir/cells/vendor/init.pixel.rc
new file mode 100644
index 0000000..25b14fe
--- /dev/null
+++ b/core/rootdir/cells/vendor/init.pixel.rc
@@ -0,0 +1,26 @@
+# Write the dark theme magic to /misc partition.
+service vendor.theme_set /vendor/bin/misc_writer --set-dark-theme
+    disabled
+    oneshot
+
+# Set dark boot flag when the device is provisioned.
+on property:persist.sys.device_provisioned=1
+    start vendor.theme_set
+
+# Set or clear the warm reset flag upon the change of system property. The flag itself is set
+on init && property:ro.boot.slot_successful=no
+    write /sys/module/msm_poweroff/parameters/warm_reset 1
+
+# by writing a sysfs file; and the file will be read by kernel.
+on property:ota.warm_reset=1
+    write /sys/module/msm_poweroff/parameters/warm_reset 1
+
+on property:ota.warm_reset=0
+    write /sys/module/msm_poweroff/parameters/warm_reset 0
+
+on init
+    copy_per_line /dev/cpuctl/tasks /dev/cpuctl/system/tasks
+
+# Migrate tasks again in case kernel threads are created during boot
+on property:sys.boot_completed=1
+    copy_per_line /dev/cpuctl/tasks /dev/cpuctl/system/tasks
diff --git a/core/rootdir/cells/vendor/init.sm7250.ipa.rc b/core/rootdir/cells/vendor/init.sm7250.ipa.rc
new file mode 100644
index 0000000..a690c0d
--- /dev/null
+++ b/core/rootdir/cells/vendor/init.sm7250.ipa.rc
@@ -0,0 +1,19 @@
+#
+# Copyright (C) 2018 The Android Open-Source Project
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#      http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+#
+
+on boot
+    # Enable RmNet IPA3 TX timeout detection
+    write /d/ipawwan/debug 1
diff --git a/core/rootdir/cells/vendor/init.sm7250.wlc.rc b/core/rootdir/cells/vendor/init.sm7250.wlc.rc
new file mode 100644
index 0000000..6ff9e97
--- /dev/null
+++ b/core/rootdir/cells/vendor/init.sm7250.wlc.rc
@@ -0,0 +1,24 @@
+#
+# Copyright (C) 2018 The Android Open-Source Project
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#      http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+#
+
+on property:sys.boot_completed=1 && property:persist.vendor.limit.wlc.current=1
+#    write /sys/class/power_supply/dc/current_max 75000
+
+on property:sys.boot_completed=1 && property:persist.vendor.limit.wlc.current=0
+#    write /sys/class/power_supply/dc/current_max 1100000
+
+on property:vendor.disable.wlc=1
+#    write /sys/class/power_supply/wireless/online 0
diff --git a/core/rootdir/cells/vendor/init.time_daemon.rc b/core/rootdir/cells/vendor/init.time_daemon.rc
new file mode 100644
index 0000000..7d81585
--- /dev/null
+++ b/core/rootdir/cells/vendor/init.time_daemon.rc
@@ -0,0 +1,14 @@
+#
+# Copyright (c) 2019 Qualcomm Technologies, Inc.
+# All Rights Reserved.
+# Confidential and Proprietary - Qualcomm Technologies, Inc.
+#
+
+on post-fs-data && property:ro.crypto.state=encrypted && property:ro.crypto.type=file
+    start time_daemon
+
+service time_daemon /vendor/bin/time_daemon
+    class main
+    user system
+    group system
+    capabilities SYS_TIME
diff --git a/core/rootdir/cells/vendor/init.vendor.sensors.rc b/core/rootdir/cells/vendor/init.vendor.sensors.rc
new file mode 100644
index 0000000..24d4863
--- /dev/null
+++ b/core/rootdir/cells/vendor/init.vendor.sensors.rc
@@ -0,0 +1,52 @@
+# Copyright (c) 2019 Qualcomm Technologies, Inc.
+# All Rights Reserved.
+# Confidential and Proprietary - Qualcomm Technologies, Inc.
+#
+# Copyright (c) 2009-2012, 2014-2019, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are met:
+#     # Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     # Redistributions in binary form must reproduce the above copyright
+#       notice, this list of conditions and the following disclaimer in the
+#       documentation and/or other materials provided with the distribution.
+#     # Neither the name of The Linux Foundation nor
+#       the names of its contributors may be used to endorse or promote
+#       products derived from this software without specific prior written
+#       permission.
+#
+# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
+# AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
+# IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
+# NON-INFRINGEMENT ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
+# CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
+# EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
+# PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;
+# OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
+# OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
+# ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+#
+
+on early-boot
+
+    write /sys/kernel/boot_slpi/boot 1
+
+    chown system system /mnt/vendor/persist/sensors
+    chown system system /mnt/vendor/persist/sensors/sns.reg
+    chown system system /mnt/vendor/persist/sensors/sensors_list.txt
+    chown system system /mnt/vendor/persist/sensors/registry
+    chown system system /mnt/vendor/persist/sensors/registry/registry
+    chown system system /mnt/vendor/persist/sensors/registry/registry/sensors_registry
+    chown system system /mnt/vendor/persist/sensors/sensors_settings
+    chown system system /mnt/vendor/persist/sensors/registry/sns_reg_config
+    chown system system /mnt/vendor/persist/sensors/registry/sns_reg_version
+    chown system system /mnt/vendor/persist/sensors/registry/config
+    chmod 0664 /mnt/vendor/persist/sensors/sensors_settings
+    chown system system /sys/kernel/boot_adsp/ssr
+
+on post-fs-data && property:ro.build.type=userdebug
+    #sensors log dir
+    mkdir /data/vendor/sensors 0777 system system
+    mkdir /data/vendor/sensors/scripts 0777 system system
diff --git a/core/rootdir/cells/vendor/init_citadel.rc b/core/rootdir/cells/vendor/init_citadel.rc
new file mode 100644
index 0000000..a8149ab
--- /dev/null
+++ b/core/rootdir/cells/vendor/init_citadel.rc
@@ -0,0 +1,10 @@
+# Needs to have citadeld running
+on property:init.svc.vendor.citadeld=running
+    start vendor.init_citadel
+
+service vendor.init_citadel /vendor/bin/hw/init_citadel
+    oneshot
+    disabled
+    user hsm
+    group hsm
+    ioprio idle 0
diff --git a/core/rootdir/cells/vendor/init_dp.rc b/core/rootdir/cells/vendor/init_dp.rc
new file mode 100644
index 0000000..f3753c8
--- /dev/null
+++ b/core/rootdir/cells/vendor/init_dp.rc
@@ -0,0 +1,8 @@
+on property:sys.boot_completed=1
+    start vendor.init_dp
+
+service vendor.init_dp /vendor/bin/hw/init_dp
+    oneshot
+    disabled
+    user root
+    group root
diff --git a/core/rootdir/cells/vendor/ipacm.rc b/core/rootdir/cells/vendor/ipacm.rc
new file mode 100644
index 0000000..c1c876b
--- /dev/null
+++ b/core/rootdir/cells/vendor/ipacm.rc
@@ -0,0 +1,34 @@
+# Copyright (c) 2019, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#   * Redistributions of source code must retain the above copyright
+#     notice, this list of conditions and the following disclaimer.
+#   * Redistributions in binary form must reproduce the above
+#     copyright notice, this list of conditions and the following
+#     disclaimer in the documentation and/or other materials provided
+#     with the distribution.
+#   * Neither the name of The Linux Foundation nor the names of its
+#     contributors may be used to endorse or promote products derived
+#     from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+service vendor.ipacm /system/vendor/bin/ipacm
+    class main
+    user radio
+    group radio inet
+
+on post-fs
+    start vendor.ipacm
diff --git a/core/rootdir/cells/vendor/netmgrd.rc b/core/rootdir/cells/vendor/netmgrd.rc
new file mode 100644
index 0000000..1fe38e4
--- /dev/null
+++ b/core/rootdir/cells/vendor/netmgrd.rc
@@ -0,0 +1,77 @@
+# Copyright (c) 2019-2021 Qualcomm Technologies, Inc.
+# All Rights Reserved.
+# Confidential and Proprietary - Qualcomm Technologies, Inc.
+#
+
+on boot
+    #Create NETMGR daemon socket area
+    mkdir /dev/socket/netmgr 0750 radio radio
+
+    #Assign TCP buffer thresholds to be ceiling value of technology maximums
+    #Increased technology maximums should be reflected here.
+    write /proc/sys/net/core/rmem_max  8388608
+    write /proc/sys/net/core/wmem_max  8388608
+
+    #Load rmnet_core driver
+    exec u:r:vendor_modprobe:s0 -- /vendor/bin/modprobe -a -d /vendor/lib/modules rmnet_ctl
+    exec u:r:vendor_modprobe:s0 -- /vendor/bin/modprobe -a -d /vendor/lib/modules rmnet_core
+    exec u:r:vendor_modprobe:s0 -- /vendor/bin/modprobe -a -d /vendor/lib/modules/5.4-gki rmnet_ctl
+    exec u:r:vendor_modprobe:s0 -- /vendor/bin/modprobe -a -d /vendor/lib/modules/5.4-gki rmnet_core
+
+# msm specific files that need to be created on /data
+on post-fs-data
+    #Create NETMGR daemon log dir
+    mkdir /data/vendor/netmgr 0771 radio radio
+    chmod 0771 /data/vendor/netmgr
+
+    # Create netmgr recovery folder
+    mkdir /data/vendor/netmgr/recovery 0700 radio radio
+    chmod 0770 /data/vendor/netmgr/recovery
+    write /data/vendor/netmgr/recovery/recovery_info ""
+    chown radio radio /data/vendor/netmgr/recovery/recovery_info
+
+# Manage netmgrd based on value of property
+on property:persist.vendor.data.mode=disabled
+    stop vendor.netmgrd
+
+service vendor.netmgrd /system/vendor/bin/netmgrd
+    class main
+
+on property:ro.vendor.use_data_netmgrd=false
+    # netmgr not supported on specific target
+    stop vendor.netmgrd
+
+on property:ro.baseband=apq
+    stop vendor.netmgrd
+
+on property:persist.vendor.data.shs_ko_load=1
+    exec u:r:vendor_modprobe:s0 -- /vendor/bin/modprobe -a -d /vendor/lib/modules rmnet_shs
+    exec u:r:vendor_modprobe:s0 -- /vendor/bin/modprobe -a -d /vendor/lib/modules/5.4-gki rmnet_shs
+
+on property:persist.vendor.data.shs_ko_load=0
+    exec u:r:vendor_modprobe:s0 -- /vendor/bin/modprobe -r -d /vendor/lib/modules rmnet_shs
+    exec u:r:vendor_modprobe:s0 -- /vendor/bin/modprobe -r -d /vendor/lib/modules/5.4-gki rmnet_shs
+
+on property:persist.vendor.data.perf_ko_load=3
+    exec u:r:vendor_modprobe:s0 -- /vendor/bin/modprobe -d /vendor/lib/modules rmnet_perf rmnet_perf_ingress_deag=N
+    exec u:r:vendor_modprobe:s0 -- /vendor/bin/modprobe -d /vendor/lib/modules/5.4-gki rmnet_perf rmnet_perf_ingress_deag=N
+
+on property:persist.vendor.data.perf_ko_load=2
+    exec u:r:vendor_modprobe:s0 -- /vendor/bin/modprobe -d /vendor/lib/modules rmnet_perf rmnet_perf_opt_mode="udp"
+    exec u:r:vendor_modprobe:s0 -- /vendor/bin/modprobe -d /vendor/lib/modules/5.4-gki rmnet_perf rmnet_perf_opt_mode="udp"
+
+on property:persist.vendor.data.perf_ko_load=1
+    exec u:r:vendor_modprobe:s0 -- /vendor/bin/modprobe -a -d /vendor/lib/modules rmnet_perf
+    exec u:r:vendor_modprobe:s0 -- /vendor/bin/modprobe -a -d /vendor/lib/modules/5.4-gki rmnet_perf
+
+on property:persist.vendor.data.perf_ko_load=0
+    exec u:r:vendor_modprobe:s0 -- /vendor/bin/modprobe -r -d /vendor/lib/modules rmnet_perf
+    exec u:r:vendor_modprobe:s0 -- /vendor/bin/modprobe -r -d /vendor/lib/modules/5.4-gki rmnet_perf
+
+on property:persist.vendor.data.offload_ko_load=1
+    exec u:r:vendor_modprobe:s0 -- /vendor/bin/modprobe -a -d /vendor/lib/modules rmnet_offload
+    exec u:r:vendor_modprobe:s0 -- /vendor/bin/modprobe -a -d /vendor/lib/modules/5.4-gki rmnet_offload
+
+on property:persist.vendor.data.offload_ko_load=0
+    exec u:r:vendor_modprobe:s0 -- /vendor/bin/modprobe -r -d /vendor/lib/modules rmnet_offload
+    exec u:r:vendor_modprobe:s0 -- /vendor/bin/modprobe -r -d /vendor/lib/modules/5.4-gki rmnet_offload
diff --git a/core/rootdir/cells/vendor/pixel-mm-logd.rc b/core/rootdir/cells/vendor/pixel-mm-logd.rc
new file mode 100644
index 0000000..40bcbe4
--- /dev/null
+++ b/core/rootdir/cells/vendor/pixel-mm-logd.rc
@@ -0,0 +1,19 @@
+on property:persist.vendor.log.mm=1
+    mkdir /data/vendor/mm 0700 root system
+    mkdir /data/vendor/mm/vmstat 0700 root system
+    mkdir /data/vendor/mm/stat 0700 root system
+    mkdir /data/vendor/mm/kswapd 0700 root system
+    mkdir /data/vendor/mm/kcompactd 0700 root system
+    start vendor.mm.logd
+
+on property:persist.vendor.log.mm=0
+    stop vendor.mm.logd
+
+on property:persist.vendor.log.mm=1 && property:persist.vendor.log.mm.interval=*
+    restart vendor.mm.logd
+
+service vendor.mm.logd /vendor/bin/mm_logd ${persist.vendor.log.mm.interval:-60}
+    class main
+    user root
+    group root system
+    disabled
diff --git a/core/rootdir/cells/vendor/pixel-mm.rc b/core/rootdir/cells/vendor/pixel-mm.rc
new file mode 100644
index 0000000..03fc1b2
--- /dev/null
+++ b/core/rootdir/cells/vendor/pixel-mm.rc
@@ -0,0 +1,49 @@
+#
+# Copyright (C) 2020 The Android Open-Source Project
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#      http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+#
+on property:sys.boot_completed=1
+    # Create mm_event trace point.
+    # Currently, only mm_event is using this trace instance.
+    # If others want to put more,it should get hard review from pixel-perf-team.
+    mkdir /sys/kernel/tracing/instances/pixel-trace 0755 system system
+    chown system system /sys/kernel/tracing/instances/pixel-trace/trace
+    chmod 0660 /sys/kernel/tracing/instances/pixel-trace/trace
+    chown system system /sys/kernel/tracing/instances/pixel-trace/tracing_on
+    chmod 0660 /sys/kernel/tracing/instances/pixel-trace/tracing_on
+#   write /sys/kernel/tracing/instances/pixel-trace/buffer_size_kb 64
+#   write /sys/kernel/tracing/instances/pixel-trace/events/mm_event/enable 1
+#   write /sys/kernel/tracing/instances/pixel-trace/events/f2fs/f2fs_iostat/enable 1
+#   write /sys/kernel/tracing/instances/pixel-trace/events/ufs/ufs_stats/enable 1
+#   write /sys/kernel/tracing/instances/pixel-trace/events/ufs_pixel/ufs_stats/enable 1
+    chmod 444 /sys/kernel/debug/page_owner
+
+# turns off tracing right before bugreporting to keep more traces
+on property:init.svc.dumpstatez=running
+#   write /sys/kernel/tracing/instances/pixel-trace/tracing_on 0
+
+on property:init.svc.dumpstatez=stopped
+#   write /sys/kernel/tracing/instances/pixel-trace/tracing_on 1
+
+on property:init.svc.bugreport=running
+#   write /sys/kernel/tracing/instances/pixel-trace/tracing_on 0
+
+on property:init.svc.bugreport=stopped
+#   write /sys/kernel/tracing/instances/pixel-trace/tracing_on 1
+
+on property:init.svc.bugreportd=running
+#   write /sys/kernel/tracing/instances/pixel-trace/tracing_on 0
+
+on property:init.svc.bugreportd=stopped
+#   write /sys/kernel/tracing/instances/pixel-trace/tracing_on 1
diff --git a/core/rootdir/cells/vendor/pixel-thermal-logd.rc b/core/rootdir/cells/vendor/pixel-thermal-logd.rc
new file mode 100644
index 0000000..1362c73
--- /dev/null
+++ b/core/rootdir/cells/vendor/pixel-thermal-logd.rc
@@ -0,0 +1,136 @@
+on property:persist.vendor.log.thermal=1
+    start vendor.thermal.logd
+
+on property:persist.vendor.log.thermal=0
+    stop vendor.thermal.logd
+
+on property:persist.vendor.log.thermal=1 && property:persist.vendor.log.thermal.interval=*
+    restart vendor.thermal.logd
+
+service vendor.thermal.logd /vendor/bin/thermal_logd ${persist.vendor.log.thermal.interval:-5}
+    class main
+    user root
+    group root system
+    disabled
+
+# Switch thermal protection for Pixels
+on property:persist.vendor.disable.thermal.control=*
+    setprop vendor.disable.thermal.control ${persist.vendor.disable.thermal.control}
+
+on property:persist.vendor.disable.usb.overheat.mitigation=*
+    setprop vendor.disable.usb.overheat.mitigation.control ${persist.vendor.disable.usb.overheat.mitigation}
+
+on property:persist.vendor.disable.thermal.tj.control=*
+    setprop vendor.disable.thermal.tj.control ${persist.vendor.disable.thermal.tj.control}
+
+on property:persist.vendor.disable.bcl.control=*
+    setprop vendor.disable.bcl.control ${persist.vendor.disable.bcl.control}
+
+on property:vendor.disable.thermal.control=1 && property:vendor.thermal.link_ready=1
+    # common
+    stop vendor.thermal-engine
+    restart vendor.thermal-hal-2-0
+    # sdm845
+    write /dev/thermal/tz-by-name/quiet-therm-adc/mode disabled
+    write /dev/thermal/tz-by-name/quiet-therm-monitor/mode disabled
+    write /dev/thermal/tz-by-name/fps-therm-adc/mode disabled
+    write /dev/thermal/tz-by-name/fps-therm-monitor/mode disabled
+    # sdm670
+    write /dev/thermal/tz-by-name/mb-therm-adc/mode disabled
+    write /dev/thermal/tz-by-name/mb-therm-monitor/mode disabled
+    # sm8150
+    write /dev/thermal/tz-by-name/sdm-therm/mode disabled
+    write /dev/thermal/tz-by-name/sdm-therm-monitor/mode disabled
+    # sm7150
+    write /dev/thermal/tz-by-name/skin-therm-adc/mode disabled
+    write /dev/thermal/tz-by-name/skin-therm-monitor/mode disabled
+    # sm7250
+    write /dev/thermal/tz-by-name/skin-therm/emul_temp 25000
+    write /dev/thermal/tz-by-name/skin-therm/mode disabled
+    write /dev/thermal/tz-by-name/skin-therm-cpu/emul_temp 25000
+    write /dev/thermal/tz-by-name/skin-therm-cpu/mode disabled
+    write /dev/thermal/tz-by-name/skin-therm-monitor/emul_temp 25000
+    write /dev/thermal/tz-by-name/skin-therm-monitor/mode disabled
+    write /dev/thermal/tz-by-name/panel-audio-therm/emul_temp 25000
+    write /dev/thermal/tz-by-name/panel-audio-therm/mode disabled
+    write /dev/thermal/tz-by-name/cellular-emergency/emul_temp 25000
+    write /dev/thermal/tz-by-name/cellular-emergency/mode disabled
+    write /dev/thermal/tz-by-name/sdm-therm/emul_temp 25000
+    write /dev/thermal/tz-by-name/sdm-therm/mode disabled
+    write /dev/thermal/tz-by-name/charger-therm/emul_temp 25000
+    write /dev/thermal/tz-by-name/charger-therm/mode disabled
+    # P21
+    write /dev/thermal/tz-by-name/disp_therm/mode disabled
+
+on property:vendor.disable.thermal.control=0 && property:vendor.thermal.link_ready=1
+    # common
+    start vendor.thermal-engine
+    restart vendor.thermal-hal-2-0
+    # sdm845
+    write /dev/thermal/tz-by-name/quiet-therm-adc/mode enabled
+    write /dev/thermal/tz-by-name/quiet-therm-monitor/mode enabled
+    write /dev/thermal/tz-by-name/fps-therm-adc/mode enabled
+    write /dev/thermal/tz-by-name/fps-therm-monitor/mode enabled
+    # sdm670
+    write /dev/thermal/tz-by-name/mb-therm-adc/mode enabled
+    write /dev/thermal/tz-by-name/mb-therm-monitor/mode enabled
+    # sm8150
+    write /dev/thermal/tz-by-name/sdm-therm/mode enabled
+    write /dev/thermal/tz-by-name/sdm-therm-monitor/mode enabled
+    # sm7150
+    write /dev/thermal/tz-by-name/skin-therm-adc/mode enabled
+    write /dev/thermal/tz-by-name/skin-therm-monitor/mode enabled
+    # sm7250
+    write /dev/thermal/tz-by-name/skin-therm/emul_temp 0
+    write /dev/thermal/tz-by-name/skin-therm/mode enabled
+    write /dev/thermal/tz-by-name/skin-therm-cpu/emul_temp 0
+    write /dev/thermal/tz-by-name/skin-therm-cpu/mode enabled
+    write /dev/thermal/tz-by-name/skin-therm-monitor/emul_temp 0
+    write /dev/thermal/tz-by-name/skin-therm-monitor/mode enabled
+    write /dev/thermal/tz-by-name/panel-audio-therm/emul_temp 0
+    write /dev/thermal/tz-by-name/panel-audio-therm/mode enabled
+    write /dev/thermal/tz-by-name/cellular-emergency/emul_temp 0
+    write /dev/thermal/tz-by-name/cellular-emergency/mode enabled
+    write /dev/thermal/tz-by-name/sdm-therm/emul_temp 0
+    write /dev/thermal/tz-by-name/sdm-therm/mode enabled
+    write /dev/thermal/tz-by-name/charger-therm/emul_temp 0
+    write /dev/thermal/tz-by-name/charger-therm/mode enabled
+    # P21
+    write /dev/thermal/tz-by-name/disp_therm/mode enabled
+
+# Switch Tj thermal protection
+on property:vendor.disable.thermal.tj.control=1
+    # P21
+    write /dev/thermal/tz-by-name/BIG/mode disabled
+    write /dev/thermal/tz-by-name/MID/mode disabled
+    write /dev/thermal/tz-by-name/LITTLE/mode disabled
+    write /dev/thermal/tz-by-name/G3D/mode disabled
+    write /dev/thermal/tz-by-name/ISP/mode disabled
+    write /dev/thermal/tz-by-name/TPU/mode disabled
+    write /sys/kernel/debug/gs101-thermal/emul_call 1
+
+on property:vendor.disable.thermal.tj.control=0
+    # P21
+    write /dev/thermal/tz-by-name/BIG/mode enabled
+    write /dev/thermal/tz-by-name/MID/mode enabled
+    write /dev/thermal/tz-by-name/LITTLE/mode enabled
+    write /dev/thermal/tz-by-name/G3D/mode enabled
+    write /dev/thermal/tz-by-name/ISP/mode enabled
+    write /dev/thermal/tz-by-name/TPU/mode enabled
+    write /sys/kernel/debug/gs101-thermal/emul_call 0
+
+# Toggle BCL control
+on property:vendor.disable.bcl.control=1
+    write /dev/thermal/tz-by-name/soc/mode disabled
+
+on property:vendor.disable.bcl.control=0
+    write /dev/thermal/tz-by-name/soc/mode enabled
+
+# Switch USB port overheat protection
+on property:vendor.disable.usb.overheat.mitigation.control=1
+    write /sys/module/overheat_mitigation/parameters/enable 0
+    write /dev/thermal/tz-by-name/usb_pwr_therm2/emul_temp 25000
+
+on property:vendor.disable.usb.overheat.mitigation.control=0
+    write /sys/module/overheat_mitigation/parameters/enable 1
+    write /dev/thermal/tz-by-name/usb_pwr_therm2/emul_temp 0
diff --git a/core/rootdir/cells/vendor/pixel-thermal-symlinks.rc b/core/rootdir/cells/vendor/pixel-thermal-symlinks.rc
new file mode 100644
index 0000000..a1f6509
--- /dev/null
+++ b/core/rootdir/cells/vendor/pixel-thermal-symlinks.rc
@@ -0,0 +1,11 @@
+on early-boot
+    mkdir /dev/thermal 0750 system system
+    mkdir /dev/thermal/tz-by-name 0750 system system
+    mkdir /dev/thermal/cdev-by-name 0750 system system
+    start vendor.thermal.symlinks
+
+service vendor.thermal.symlinks /vendor/bin/thermal_symlinks
+    class hal
+    user system
+    group system
+    oneshot
diff --git a/core/rootdir/cells/vendor/pixelstats-vendor.redbull.rc b/core/rootdir/cells/vendor/pixelstats-vendor.redbull.rc
new file mode 100644
index 0000000..fdf8f79
--- /dev/null
+++ b/core/rootdir/cells/vendor/pixelstats-vendor.redbull.rc
@@ -0,0 +1,4 @@
+service vendor.pixelstats_vendor /vendor/bin/pixelstats-vendor
+    class hal
+    user system
+    group system context_hub readproc
diff --git a/core/rootdir/cells/vendor/port-bridge.rc b/core/rootdir/cells/vendor/port-bridge.rc
new file mode 100644
index 0000000..a22e40a
--- /dev/null
+++ b/core/rootdir/cells/vendor/port-bridge.rc
@@ -0,0 +1,20 @@
+# Copyright (c) 2019 Qualcomm Technologies, Inc.
+# All Rights Reserved.
+# Confidential and Proprietary - Qualcomm Technologies, Inc.
+#
+
+on boot
+    #Create PORT-BRIDGE daemon socket area
+    mkdir /dev/socket/port-bridge 0750 radio radio
+
+# msm specific files that need to be created on /data
+on post-fs-data
+    #Create port-bridge log dir
+    mkdir /data/vendor/port_bridge 0770 radio radio
+    chmod 0770 /data/vendor/port_bridge
+
+service vendor.port-bridge /system/vendor/bin/port-bridge
+    class main
+    user radio
+    group radio system inet
+    oneshot
diff --git a/core/rootdir/cells/vendor/poweropt-service.rc b/core/rootdir/cells/vendor/poweropt-service.rc
new file mode 100644
index 0000000..d181655
--- /dev/null
+++ b/core/rootdir/cells/vendor/poweropt-service.rc
@@ -0,0 +1,17 @@
+#  @file    poweropt-servce.rc
+#  @brief   Definition to enable poweropt
+#
+#  DESCRIPTION
+#  ---------------------------------------------------------------------------
+#       Copyright (c) 2020 Qualcomm Technologies, Inc.
+#       All Rights Reserved.
+#       Confidential and Proprietary - Qualcomm Technologies, Inc.
+#  ---------------------------------------------------------------------------
+on post-fs-data && property:ro.crypto.state=encrypted && property:ro.crypto.type=file
+    start poweropt-service
+
+service poweropt-service /vendor/bin/poweropt-service
+    class main
+    user root
+    group system
+
diff --git a/core/rootdir/cells/vendor/qcrild.rc b/core/rootdir/cells/vendor/qcrild.rc
new file mode 100644
index 0000000..2268dcf
--- /dev/null
+++ b/core/rootdir/cells/vendor/qcrild.rc
@@ -0,0 +1,20 @@
+#service vendor.qcrild /vendor/bin/hw/qcrild
+#    class main
+#    user radio
+#    group radio cache inet misc audio log readproc wakelock oem_2901
+#    capabilities BLOCK_SUSPEND NET_ADMIN NET_RAW
+#
+#service vendor.qcrild2 /vendor/bin/hw/qcrild -c 2
+#    class main
+#    user radio
+#    disabled
+#    group radio cache inet misc audio log readproc wakelock oem_2901
+#    capabilities BLOCK_SUSPEND NET_ADMIN NET_RAW
+#
+#service vendor.qcrild3 /vendor/bin/hw/qcrild -c 3
+#    class main
+#    user radio
+#    disabled
+#    group radio cache inet misc audio log readproc wakelock oem_2901
+#    capabilities BLOCK_SUSPEND NET_ADMIN NET_RAW
+#
\ No newline at end of file
diff --git a/core/rootdir/cells/vendor/rebootescrow-citadel.rc b/core/rootdir/cells/vendor/rebootescrow-citadel.rc
new file mode 100644
index 0000000..7e82c98
--- /dev/null
+++ b/core/rootdir/cells/vendor/rebootescrow-citadel.rc
@@ -0,0 +1,7 @@
+#service vendor.rebootescrow-citadel /vendor/bin/hw/android.hardware.rebootescrow-service.citadel
+#    interface aidl android.hardware.rebootescrow.IRebootEscrow/default
+#    disabled
+#    class hal
+#    user hsm
+#    group hsm
+#
diff --git a/core/rootdir/cells/vendor/rlsservice.rc b/core/rootdir/cells/vendor/rlsservice.rc
new file mode 100644
index 0000000..042cc38
--- /dev/null
+++ b/core/rootdir/cells/vendor/rlsservice.rc
@@ -0,0 +1,7 @@
+service rlsservice /vendor/bin/rlsservice
+    class hal
+    user system
+    group system
+    writepid /dev/cpuset/system-background/tasks
+    capabilities SYS_NICE
+    rlimit rtprio 10 10
diff --git a/core/rootdir/cells/vendor/shsusrd.rc b/core/rootdir/cells/vendor/shsusrd.rc
new file mode 100644
index 0000000..25beb7d
--- /dev/null
+++ b/core/rootdir/cells/vendor/shsusrd.rc
@@ -0,0 +1,40 @@
+# Copyright (c) 2019-2020 Qualcomm Technologies, Inc.
+# All Rights Reserved.
+# Confidential and Proprietary - Qualcomm Technologies, Inc.
+#
+
+on boot
+    # Create netmgr recovery folder
+    write /data/vendor/shsusr/shsusr_log.txt ""
+    chown radio radio /data/vendor/shsusr/shsusr_log.txt
+
+# msm specific files that need to be created on /data
+on post-fs-data
+    #Create SHSUSR daemon log dir
+    mkdir /data/vendor/shsusr 0770 radio radio
+    chmod 0770 /data/vendor/shsusr
+
+service vendor.shsusrd /system/vendor/bin/shsusrd 0x002819000
+    class main
+    user radio
+    group radio
+    disabled
+
+on property:persist.vendor.data.shsusr_load=1
+    start vendor.shsusrd
+
+on property:persist.vendor.data.shsusr_load=0
+    stop vendor.shsusrd
+
+on property:persist.vendor.data.shsusr_ipa=02
+    write /sys/class/net/rmnet_ipa0/queues/rx-0/rps_cpus "02"
+
+on property:persist.vendor.data.shsusr_ipa=10
+    write /sys/class/net/rmnet_ipa0/queues/rx-0/rps_cpus "10"
+
+on property:persist.vendor.data.shsusr_ipa=20
+    write /sys/class/net/rmnet_ipa0/queues/rx-0/rps_cpus "20"
+
+on property:persist.vendor.data.shsusr_ipa=40
+    write /sys/class/net/rmnet_ipa0/queues/rx-0/rps_cpus "40"
+
diff --git a/core/rootdir/cells/vendor/ssgtzd.rc b/core/rootdir/cells/vendor/ssgtzd.rc
new file mode 100644
index 0000000..1db24c7
--- /dev/null
+++ b/core/rootdir/cells/vendor/ssgtzd.rc
@@ -0,0 +1,21 @@
+# Copyright (c) 2019 Qualcomm Technologies, Inc.
+# All Rights Reserved.
+# Confidential and Proprietary - Qualcomm Technologies, Inc.
+
+
+# Create the directories used by qwes
+on post-fs-data
+    mkdir /data/vendor/qwes 0755 system system
+
+# Start daemon after boot completed
+on property:sys.boot_completed=1
+    start vendor.ssgtzd
+
+# Used 'disabled' flag, so daemon won't be started until explicit start
+service vendor.ssgtzd /vendor/bin/ssgtzd
+    class late_start
+    user system
+    group system
+    disabled
+    socket ssgtzd stream 0660 system inet
+    socket qwes_ipc stream 0660 system inet
diff --git a/core/rootdir/cells/vendor/twoshay.rc b/core/rootdir/cells/vendor/twoshay.rc
new file mode 100644
index 0000000..5040c7b
--- /dev/null
+++ b/core/rootdir/cells/vendor/twoshay.rc
@@ -0,0 +1,5 @@
+service twoshay /vendor/bin/twoshay -s
+    class hal
+    user root
+    group input
+    disabled
diff --git a/core/rootdir/cells/vendor/vendor.display.color@1.0-service.rc b/core/rootdir/cells/vendor/vendor.display.color@1.0-service.rc
new file mode 100644
index 0000000..435344a
--- /dev/null
+++ b/core/rootdir/cells/vendor/vendor.display.color@1.0-service.rc
@@ -0,0 +1,4 @@
+service display-color-hal-1-0 /vendor/bin/hw/vendor.display.color@1.0-service
+    class hal
+    user system
+    group system
diff --git a/core/rootdir/cells/vendor/vendor.google.wifi_ext@1.0-service.rc b/core/rootdir/cells/vendor/vendor.google.wifi_ext@1.0-service.rc
new file mode 100644
index 0000000..3ba21f7
--- /dev/null
+++ b/core/rootdir/cells/vendor/vendor.google.wifi_ext@1.0-service.rc
@@ -0,0 +1,9 @@
+service vendor.wifi_hal_legacy /vendor/bin/hw/vendor.google.wifi_ext@1.0-service-vendor
+    class hal
+    capabilities NET_ADMIN NET_RAW
+    user wifi
+    group wifi gps system
+
+on post-fs-data
+    mkdir /data/vendor/firmware 0770 system system
+    mkdir /data/vendor/firmware/wifi 0750 wifi wifi
diff --git a/core/rootdir/cells/vendor/vendor.qti.adsprpc-service.rc b/core/rootdir/cells/vendor/vendor.qti.adsprpc-service.rc
new file mode 100644
index 0000000..e06b3fd
--- /dev/null
+++ b/core/rootdir/cells/vendor/vendor.qti.adsprpc-service.rc
@@ -0,0 +1,42 @@
+# Copyright (c) 2019 Qualcomm Technologies, Inc.
+# All Rights Reserved.
+# Confidential and Proprietary - Qualcomm Technologies, Inc.
+#
+#
+# Copyright (c) 2018-2019, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#    * Redistributions of source code must retain the above copyright
+#      notice, this list of conditions and the following disclaimer.
+#    * Redistributions in binary form must reproduce the above
+#      copyright notice, this list of conditions and the following
+#      disclaimer in the documentation and/or other materials provided
+#      with the distribution.
+#    * Neither the name of The Linux Foundation nor the names of its
+#      contributors may be used to endorse or promote products derived
+#      from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+#
+
+#service vendor.adsprpcd /vendor/bin/adsprpcd
+#   class main
+#   user system
+#   group media
+
+#service vendor.adsprpcd_audiopd /vendor/bin/adsprpcd audiopd
+#   class main
+#   user media
+#   group media
diff --git a/core/rootdir/cells/vendor/vendor.qti.cdsprpc-service.rc b/core/rootdir/cells/vendor/vendor.qti.cdsprpc-service.rc
new file mode 100644
index 0000000..577e1c4
--- /dev/null
+++ b/core/rootdir/cells/vendor/vendor.qti.cdsprpc-service.rc
@@ -0,0 +1,40 @@
+# Copyright (c) 2019 Qualcomm Technologies, Inc.
+# All Rights Reserved.
+# Confidential and Proprietary - Qualcomm Technologies, Inc.
+#
+#
+# Copyright (c) 2018-2019, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#    * Redistributions of source code must retain the above copyright
+#      notice, this list of conditions and the following disclaimer.
+#    * Redistributions in binary form must reproduce the above
+#      copyright notice, this list of conditions and the following
+#      disclaimer in the documentation and/or other materials provided
+#      with the distribution.
+#    * Neither the name of The Linux Foundation nor the names of its
+#      contributors may be used to endorse or promote products derived
+#      from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+#
+
+#service vendor.cdsprpcd /vendor/bin/cdsprpcd
+#   class main
+#   user system
+#   group system
+
+#on property:vendor.fastrpc.disable.cdsprpcd.daemon=1
+#   stop vendor.cdsprpcd
diff --git a/core/rootdir/cells/vendor/vendor.qti.hardware.charger_monitor@1.0-service.rc b/core/rootdir/cells/vendor/vendor.qti.hardware.charger_monitor@1.0-service.rc
new file mode 100644
index 0000000..064f345
--- /dev/null
+++ b/core/rootdir/cells/vendor/vendor.qti.hardware.charger_monitor@1.0-service.rc
@@ -0,0 +1,43 @@
+# Copyright (c) 2019-2020, Qualcomm Technologies, Inc.
+# All Rights Reserved.
+# Confidential and Proprietary - Qualcomm Technologies, Inc.
+#
+# Copyright (c) 2013-2018, The Linux Foundation. All rights reserved.
+#
+
+service vendor.hvdcp_opti /vendor/bin/hvdcp_opti
+    class main
+    user root
+    group system wakelock
+    capabilities BLOCK_SUSPEND WAKE_ALARM
+    disabled
+
+service vendor.qti-chg-policy-sh /vendor/bin/init.qti.chg_policy.sh
+    class core
+    user root
+    oneshot
+    disabled
+
+on boot
+    enable vendor.qti-chg-policy-sh
+    start vendor.qti-chg-policy-sh
+
+on charger
+    chown radio wakelock /sys/power/wake_lock
+    chmod 0660 /sys/power/wake_lock
+    chown radio wakelock /sys/power/wake_unlock
+    chmod 0660 /sys/power/wake_unlock
+    mkdir /mnt/vendor/persist/hvdcp_opti 0770 root system
+    mount_all /vendor/etc/charger_fstab.qti --early
+    enable vendor.qti-chg-policy-sh
+    start vendor.qti-chg-policy-sh
+
+on property:persist.vendor.hvdcp_opti.start=2
+    rmdir /mnt/vendor/persist/hvdcp_opti
+    setprop persist.vendor.hvdcp_opti.start 0
+
+on property:persist.vendor.hvdcp_opti.start=1
+    mkdir /mnt/vendor/persist/hvdcp_opti 0770 root system
+    enable vendor.hvdcp_opti
+    start vendor.hvdcp_opti
+    setprop persist.vendor.hvdcp_opti.start 0
diff --git a/core/rootdir/cells/vendor/vendor.qti.hardware.cryptfshw@1.0-service-qti.rc b/core/rootdir/cells/vendor/vendor.qti.hardware.cryptfshw@1.0-service-qti.rc
new file mode 100644
index 0000000..2b75386
--- /dev/null
+++ b/core/rootdir/cells/vendor/vendor.qti.hardware.cryptfshw@1.0-service-qti.rc
@@ -0,0 +1,4 @@
+service cryptfshw-1-0 /vendor/bin/hw/vendor.qti.hardware.cryptfshw@1.0-service-qti
+    class early_hal
+    user system
+    group system
diff --git a/core/rootdir/cells/vendor/vendor.qti.hardware.display.allocator-service.rc b/core/rootdir/cells/vendor/vendor.qti.hardware.display.allocator-service.rc
new file mode 100644
index 0000000..ca2c7b9
--- /dev/null
+++ b/core/rootdir/cells/vendor/vendor.qti.hardware.display.allocator-service.rc
@@ -0,0 +1,6 @@
+service vendor.qti.hardware.display.allocator /vendor/bin/hw/vendor.qti.hardware.display.allocator-service
+    class hal animation
+    user system
+    group graphics drmrpc
+    capabilities SYS_NICE
+    onrestart restart surfaceflinger
diff --git a/core/rootdir/cells/vendor/vendor.qti.hardware.display.composer-service.rc b/core/rootdir/cells/vendor/vendor.qti.hardware.display.composer-service.rc
new file mode 100644
index 0000000..96e080d
--- /dev/null
+++ b/core/rootdir/cells/vendor/vendor.qti.hardware.display.composer-service.rc
@@ -0,0 +1,8 @@
+service vendor.qti.hardware.display.composer /vendor/bin/hw/vendor.qti.hardware.display.composer-service
+    class hal animation
+    user system
+    group graphics drmrpc
+    capabilities SYS_NICE
+    onrestart restart surfaceflinger
+    socket pps stream 0660 system system
+    writepid /dev/cpuset/system-background/tasks
diff --git a/core/rootdir/cells/vendor/vendor.qti.hardware.dsp@1.0-service.rc b/core/rootdir/cells/vendor/vendor.qti.hardware.dsp@1.0-service.rc
new file mode 100644
index 0000000..fd75575
--- /dev/null
+++ b/core/rootdir/cells/vendor/vendor.qti.hardware.dsp@1.0-service.rc
@@ -0,0 +1,13 @@
+# Copyright (c) 2020 Qualcomm Technologies, Inc.
+# All Rights Reserved.
+# Confidential and Proprietary - Qualcomm Technologies, Inc.
+
+service vendor.dspservice /vendor/bin/dspservice
+	class hal
+	user system
+	group system wakelock oem_2908
+	capabilities BLOCK_SUSPEND
+	interface vendor.qti.hardware.dsp@1.0::IDspService dspservice
+
+	# uncomment below to disable service at boot
+	# disabled
\ No newline at end of file
diff --git a/core/rootdir/cells/vendor/vendor.qti.hardware.qseecom@1.0-service.rc b/core/rootdir/cells/vendor/vendor.qti.hardware.qseecom@1.0-service.rc
new file mode 100644
index 0000000..bae6658
--- /dev/null
+++ b/core/rootdir/cells/vendor/vendor.qti.hardware.qseecom@1.0-service.rc
@@ -0,0 +1,14 @@
+#
+# Copyright (c) 2019 Qualcomm Technologies, Inc.
+# All Rights Reserved.
+# Confidential and Proprietary - Qualcomm Technologies, Inc.
+#
+#
+
+on init
+    start qseecom-service
+
+service qseecom-service /vendor/bin/hw/vendor.qti.hardware.qseecom@1.0-service
+    class hal
+    user system
+    group system drmrpc
diff --git a/core/rootdir/cells/vendor/vendor.qti.hardware.qteeconnector@1.0-service.rc b/core/rootdir/cells/vendor/vendor.qti.hardware.qteeconnector@1.0-service.rc
new file mode 100644
index 0000000..a71b98d
--- /dev/null
+++ b/core/rootdir/cells/vendor/vendor.qti.hardware.qteeconnector@1.0-service.rc
@@ -0,0 +1,4 @@
+service qteeconnector-hal-1-0 /vendor/bin/hw/vendor.qti.hardware.qteeconnector@1.0-service
+    class hal
+    user system
+    group system
diff --git a/core/rootdir/cells/vendor/vendor.qti.hardware.tui_comm@1.0-service-qti.rc b/core/rootdir/cells/vendor/vendor.qti.hardware.tui_comm@1.0-service-qti.rc
new file mode 100644
index 0000000..80317b4
--- /dev/null
+++ b/core/rootdir/cells/vendor/vendor.qti.hardware.tui_comm@1.0-service-qti.rc
@@ -0,0 +1,4 @@
+service tui_comm-1-0 /vendor/bin/hw/vendor.qti.hardware.tui_comm@1.0-service-qti
+    class hal
+    user system
+    group system drmrpc 
diff --git a/core/rootdir/cells/vendor/vendor.qti.media.c2@1.0-service.rc b/core/rootdir/cells/vendor/vendor.qti.media.c2@1.0-service.rc
new file mode 100644
index 0000000..2f29a12
--- /dev/null
+++ b/core/rootdir/cells/vendor/vendor.qti.media.c2@1.0-service.rc
@@ -0,0 +1,7 @@
+service vendor-qti-media-c2-hal-1-0 /vendor/bin/hw/vendor.qti.media.c2@1.0-service
+    class hal
+    user mediacodec
+    group mediadrm camera drmrpc system
+    ioprio rt 4
+    writepid /dev/cpuset/foreground/tasks
+
diff --git a/core/rootdir/cells/vendor/vendor.qti.qspmhal@1.0-service.rc b/core/rootdir/cells/vendor/vendor.qti.qspmhal@1.0-service.rc
new file mode 100644
index 0000000..c63999b
--- /dev/null
+++ b/core/rootdir/cells/vendor/vendor.qti.qspmhal@1.0-service.rc
@@ -0,0 +1,15 @@
+#==============================================================================
+#       vendor.qti.qspmhal@1.0-service.rc
+#
+#  Copyright (c) 2019 Qualcomm Technologies, Inc.
+#  All Rights Reserved.
+#  Confidential and Proprietary - Qualcomm Technologies, Inc.
+#===============================================================================
+service qspmhal /vendor/bin/vendor.qti.qspmhal@1.0-service
+    class hal
+    user system
+    group system
+
+on post-fs-data
+    #Create QSPM-hal deamon related dirs
+    mkdir /data/vendor/gaming 0770 root system
diff --git a/core/rootdir/cells/vendor/vendor.qti.rmt_storage.rc b/core/rootdir/cells/vendor/vendor.qti.rmt_storage.rc
new file mode 100644
index 0000000..74b9d65
--- /dev/null
+++ b/core/rootdir/cells/vendor/vendor.qti.rmt_storage.rc
@@ -0,0 +1,12 @@
+#
+# Copyright (c) 2019 Qualcomm Technologies, Inc.
+# All Rights Reserved.
+# Confidential and Proprietary - Qualcomm Technologies, Inc.
+#
+
+service vendor.rmt_storage /vendor/bin/rmt_storage
+    class core
+    user root
+    group system wakelock
+    shutdown critical
+    ioprio rt 0
diff --git a/core/rootdir/cells/vendor/vendor.qti.tftp.rc b/core/rootdir/cells/vendor/vendor.qti.tftp.rc
new file mode 100644
index 0000000..fccb1c7
--- /dev/null
+++ b/core/rootdir/cells/vendor/vendor.qti.tftp.rc
@@ -0,0 +1,13 @@
+#
+# Copyright (c) 2019 Qualcomm Technologies, Inc.
+# All Rights Reserved.
+# Confidential and Proprietary - Qualcomm Technologies, Inc.
+#
+
+# Create pddump directory
+on post-fs-data
+	mkdir /data/vendor/pddump 0770 oem_2903 oem_2903
+
+service vendor.tftp_server /vendor/bin/tftp_server
+   class core
+   user root
\ No newline at end of file
diff --git a/core/rootdir/cells/vendor/vendor.sensors.qti.rc b/core/rootdir/cells/vendor/vendor.sensors.qti.rc
new file mode 100644
index 0000000..bc8c95a
--- /dev/null
+++ b/core/rootdir/cells/vendor/vendor.sensors.qti.rc
@@ -0,0 +1,40 @@
+# Copyright (c) 2019 Qualcomm Technologies, Inc.
+# All Rights Reserved.
+# Confidential and Proprietary - Qualcomm Technologies, Inc.
+#
+# Copyright (c) 2009-2012, 2014-2019, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are met:
+#     # Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     # Redistributions in binary form must reproduce the above copyright
+#       notice, this list of conditions and the following disclaimer in the
+#       documentation and/or other materials provided with the distribution.
+#     # Neither the name of The Linux Foundation nor
+#       the names of its contributors may be used to endorse or promote
+#       products derived from this software without specific prior written
+#       permission.
+#
+# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
+# AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
+# IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
+# NON-INFRINGEMENT ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
+# CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
+# EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
+# PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;
+# OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
+# OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
+# ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+#
+
+service vendor.sensors.qti /vendor/bin/sensors.qti
+    class core
+    user system
+    group system
+
+service vendor-sensor-sh /vendor/bin/init.qcom.sensors.sh
+    class late_start
+    user root
+    oneshot
diff --git a/core/rootdir/cells/vendor/vendor.sensors.sscrpcd.rc b/core/rootdir/cells/vendor/vendor.sensors.sscrpcd.rc
new file mode 100644
index 0000000..b347ebd
--- /dev/null
+++ b/core/rootdir/cells/vendor/vendor.sensors.sscrpcd.rc
@@ -0,0 +1,38 @@
+## Copyright (c) 2019 Qualcomm Technologies, Inc.
+## All Rights Reserved.
+## Confidential and Proprietary - Qualcomm Technologies, Inc.
+##
+## Copyright (c) 2009-2012, 2014-2019, The Linux Foundation. All rights reserved.
+##
+## Redistribution and use in source and binary forms, with or without
+## modification, are permitted provided that the following conditions are met:
+##     # Redistributions of source code must retain the above copyright
+##       notice, this list of conditions and the following disclaimer.
+##     # Redistributions in binary form must reproduce the above copyright
+##       notice, this list of conditions and the following disclaimer in the
+##       documentation and/or other materials provided with the distribution.
+##     # Neither the name of The Linux Foundation nor
+##       the names of its contributors may be used to endorse or promote
+##       products derived from this software without specific prior written
+##       permission.
+##
+## THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
+## AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
+## IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
+## NON-INFRINGEMENT ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
+## CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
+## EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
+## PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;
+## OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+## WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
+## OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
+## ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+##
+#
+#service vendor.sensors /vendor/bin/sscrpcd sensorspd
+#    class main
+#    user system
+#    group system wakelock
+#    capabilities BLOCK_SUSPEND
+#    shutdown critical
+#
\ No newline at end of file
diff --git a/core/rootdir/cells/vendor/vendor_flash_recovery.rc b/core/rootdir/cells/vendor/vendor_flash_recovery.rc
new file mode 100644
index 0000000..37a7c2b
--- /dev/null
+++ b/core/rootdir/cells/vendor/vendor_flash_recovery.rc
@@ -0,0 +1,3 @@
+service vendor_flash_recovery /vendor/bin/install-recovery.sh
+    class main
+    oneshot
diff --git a/core/rootdir/cells/vendor/vndservicemanager.rc b/core/rootdir/cells/vendor/vndservicemanager.rc
new file mode 100644
index 0000000..756f6c3
--- /dev/null
+++ b/core/rootdir/cells/vendor/vndservicemanager.rc
@@ -0,0 +1,9 @@
+service vndservicemanager /vendor/bin/vndservicemanager /dev/vndbinder
+    class core
+    user system
+    group system readproc
+    writepid /dev/cpuset/system-background/tasks
+    onrestart class_restart main
+    onrestart class_restart hal
+    onrestart class_restart early_hal
+    shutdown critical
diff --git a/core/rootdir/init.rc b/core/rootdir/init.rc
index 5116c0f..d28c730 100644
--- a/core/rootdir/init.rc
+++ b/core/rootdir/init.rc
@@ -66,6 +66,11 @@ on early-init
 
     start ueventd
 
+    setprop ro.boot.vm 0
+    setprop persist.sys.exit 0
+    setprop persist.logd.logpersistd logcatd
+    setprop persist.sys.sdcardfs force_on
+
     # Run apexd-bootstrap so that APEXes that provide critical libraries
     # become available. Note that this is executed as exec_start to ensure that
     # the libraries are available to the processes started after this statement.
@@ -452,6 +457,7 @@ on init
     start servicemanager
     start hwservicemanager
     start vndservicemanager
+    start cellsservice
 
 # Healthd can trigger a full boot from charger mode by signaling this
 # property when the power button is held.
@@ -1269,3 +1275,15 @@ on userspace-reboot-resume
 
 on property:sys.boot_completed=1 && property:sys.init.userspace_reboot.in_progress=1
   setprop sys.init.userspace_reboot.in_progress ""
+
+service celld /system/bin/celld -c /data/cells -s /data/cells_sd -F -r
+    class main
+    user root
+    group root
+    seclabel  u:r:init:s0
+
+service cellsservice /system/bin/cellsservice
+    class main
+    user root
+    group root
+    seclabel  u:r:init:s0
diff --git a/libhidl/transport/ServiceManagement.cpp b/libhidl/transport/ServiceManagement.cpp
index c638279..019aaa8 100644
--- a/libhidl/transport/ServiceManagement.cpp
+++ b/libhidl/transport/ServiceManagement.cpp
@@ -37,6 +37,7 @@
 #include <hidl/ServiceManagement.h>
 #include <hidl/Status.h>
 #include <utils/SystemClock.h>
+#include <utils/CallStack.h>
 
 #include <android-base/file.h>
 #include <android-base/logging.h>
@@ -69,6 +70,43 @@ static constexpr bool kIsRecovery = true;
 static constexpr bool kIsRecovery = false;
 #endif
 
+static bool getinithidlservice(const char* descriptor)
+{
+    static const char* inithidlservice[]={
+        "android.hardware.bluetooth",
+        "android.hardware.nfc",
+        "android.hardware.oemlock",
+        "android.hardware.weaver",
+        "android.hardware.authsecret",
+        "android.hardware.sensors",
+        "android.hardware.biometrics.face",
+        "vendor.qti.data.factory",
+        "android.hardware.gatekeeper",
+        "android.hardware.keymaster",
+        "android.hardware.biometrics.fingerprint",
+        "android.hardware.thermal",
+        "android.hardware.input.classifier",
+        "android.hardware.audio",
+        "android.hardware.soundtrigger",
+        "android.hardware.secure_element",
+        "android.frameworks.sensorservice",
+        NULL
+    };
+
+    std::string prop = android::base::GetProperty("ro.boot.vm", "1");
+    if (prop == "0") {
+        return false;
+    }
+
+    for(int i =0;  inithidlservice[i] != NULL;  i++){
+        if(strncmp(descriptor, inithidlservice[i], strlen( inithidlservice[i])) == 0){
+            ALOGD("getinithidlservice %s", descriptor);
+            return true;
+        }
+    }
+    return false;
+}
+
 static void waitForHwServiceManager() {
     // TODO(b/31559095): need bionic host so that we can use 'prop_info' returned
     // from WaitForProperty
@@ -236,6 +274,23 @@ sp<IServiceManager1_2> defaultServiceManager1_2() {
     return gDefaultServiceManager;
 }
 
+static sp<IServiceManager1_2> initdefaultServiceManager() {
+    using android::hidl::manager::V1_2::BnHwServiceManager;
+    using android::hidl::manager::V1_2::BpHwServiceManager;
+
+    static std::mutex& gDefaultServiceManagerLock = *new std::mutex;
+    static sp<IServiceManager1_2>& gDefaultServiceManager = *new sp<IServiceManager1_2>;
+
+    {
+        std::lock_guard<std::mutex> _l(gDefaultServiceManagerLock);
+        gDefaultServiceManager =
+            fromBinder<IServiceManager1_2, BpHwServiceManager, BnHwServiceManager>(
+                ProcessState::self()->getMgrContextObject(0));
+    }
+
+    return gDefaultServiceManager;
+}
+
 static std::vector<std::string> findFiles(const std::string& path, const std::string& prefix,
                                           const std::string& suffix) {
     std::unique_ptr<DIR, decltype(&closedir)> dir(opendir(path.c_str()), closedir);
@@ -562,6 +617,10 @@ sp<IServiceManager1_1> getPassthroughServiceManager1_1() {
 std::vector<std::string> getAllHalInstanceNames(const std::string& descriptor) {
     std::vector<std::string> ret;
     auto sm = defaultServiceManager1_2();
+    bool getinithidl = getinithidlservice(descriptor.c_str());
+    if(getinithidl) {
+        sm = initdefaultServiceManager();
+    }
     sm->listManifestByInterface(descriptor, [&](const auto& instances) {
         ret.reserve(instances.size());
         for (const auto& i : instances) {
@@ -699,6 +758,9 @@ struct Waiter : IServiceNotification {
 
 void waitForHwService(
         const std::string &interface, const std::string &instanceName) {
+    bool getinithidl = getinithidlservice(interface.c_str());
+    if(getinithidl) return;
+
     sp<Waiter> waiter = new Waiter(interface, instanceName, defaultServiceManager1_1());
     waiter->wait(false /* timeout */);
     waiter->done();
@@ -746,7 +808,11 @@ sp<::android::hidl::base::V1_0::IBase> getRawServiceInternal(const std::string&
     if (kIsRecovery) {
         transport = Transport::PASSTHROUGH;
     } else {
-        sm = defaultServiceManager1_1();
+        if(getinithidlservice(descriptor.c_str())){
+            sm = initdefaultServiceManager();
+        }else{
+            sm = defaultServiceManager1_1();
+        }
         if (sm == nullptr) {
             ALOGE("getService: defaultServiceManager() is null");
             return nullptr;
@@ -757,6 +823,9 @@ sp<::android::hidl::base::V1_0::IBase> getRawServiceInternal(const std::string&
         if (!transportRet.isOk()) {
             ALOGE("getService: defaultServiceManager()->getTransport returns %s",
                   transportRet.description().c_str());
+            //android::CallStack stack;
+            //stack.update();
+            //stack.log("jianglin");
             return nullptr;
         }
         transport = transportRet;
diff --git a/libhwbinder/ProcessState.cpp b/libhwbinder/ProcessState.cpp
index dbd6c87..e3f007b 100644
--- a/libhwbinder/ProcessState.cpp
+++ b/libhwbinder/ProcessState.cpp
@@ -41,6 +41,7 @@
 #define DEFAULT_BINDER_VM_SIZE ((1 * 1024 * 1024) - sysconf(_SC_PAGE_SIZE) * 2)
 #define DEFAULT_MAX_BINDER_THREADS 0
 #define DEFAULT_ENABLE_ONEWAY_SPAM_DETECTION 1
+#define INIT_SYSTEM_CONTEXT_MGR_HANDLE 100000000
 
 // -------------------------------------------------------------------------
 
@@ -117,6 +118,15 @@ sp<IBinder> ProcessState::getContextObject(const sp<IBinder>& /*caller*/)
     return getStrongProxyForHandle(0);
 }
 
+sp<IBinder> ProcessState::getMgrContextObject(int index)
+{
+    sp<IBinder> result;
+    if(index < 0 || index >= CELLS_MAX_CONTEXT)
+        return result;
+
+    return getStrongProxyForHandle(INIT_SYSTEM_CONTEXT_MGR_HANDLE + index);
+}
+
 void ProcessState::becomeContextManager()
 {
     AutoMutex _l(mLock);
@@ -205,6 +215,10 @@ void ProcessState::setCallRestriction(CallRestriction restriction) {
 
 ProcessState::handle_entry* ProcessState::lookupHandleLocked(int32_t handle)
 {
+    if(handle >= INIT_SYSTEM_CONTEXT_MGR_HANDLE){
+        return &mSystemContextMgrHandle[handle - INIT_SYSTEM_CONTEXT_MGR_HANDLE];
+    }
+
     const size_t N=mHandleToObject.size();
     if (N <= (size_t)handle) {
         handle_entry e;
@@ -417,6 +431,12 @@ ProcessState::ProcessState(size_t mmapSize)
         }
     }
 
+    for(int i=0; i < CELLS_MAX_CONTEXT; i++)
+    {
+        mSystemContextMgrHandle[i].binder = nullptr;
+        mSystemContextMgrHandle[i].refs = nullptr;
+    }
+
 #ifdef __ANDROID__
     LOG_ALWAYS_FATAL_IF(mDriverFD < 0, "Binder driver could not be opened. Terminating.");
 #endif
diff --git a/libhwbinder/include/hwbinder/IBinder.h b/libhwbinder/include/hwbinder/IBinder.h
index b5593fe..156eba6 100644
--- a/libhwbinder/include/hwbinder/IBinder.h
+++ b/libhwbinder/include/hwbinder/IBinder.h
@@ -23,6 +23,10 @@
 #include <utils/RefBase.h>
 #include <utils/String16.h>
 
+#ifndef CELLS_MAX_CONTEXT
+#define CELLS_MAX_CONTEXT 6
+#endif
+
 // WARNING: this code is part of libhwbinder, a fork of libbinder. Generally,
 // this means that it is only relevant to HIDL. Any AIDL- or libbinder-specific
 // code should not try to use these things.
diff --git a/libhwbinder/include/hwbinder/ProcessState.h b/libhwbinder/include/hwbinder/ProcessState.h
index 56ac846..c60d3b3 100644
--- a/libhwbinder/include/hwbinder/ProcessState.h
+++ b/libhwbinder/include/hwbinder/ProcessState.h
@@ -47,6 +47,7 @@ public:
 
             void                startThreadPool();
 
+            sp<IBinder>         getMgrContextObject(int index);
             sp<IBinder>         getContextObject(const sp<IBinder>& /*caller*/);
                                 // only call once, without creating a pool
             void                becomeContextManager();
@@ -116,6 +117,7 @@ private:
     mutable Mutex               mLock;  // protects everything below.
 
             Vector<handle_entry>mHandleToObject;
+            handle_entry        mSystemContextMgrHandle[CELLS_MAX_CONTEXT];
 
             String8             mRootDir;
             bool                mThreadPoolStarted;
diff --git a/netd/server/RouteController.cpp b/netd/server/RouteController.cpp
index ba305e6..e34953b 100644
--- a/netd/server/RouteController.cpp
+++ b/netd/server/RouteController.cpp
@@ -34,6 +34,7 @@
 #include "OffloadUtils.h"
 
 #include <android-base/file.h>
+#include <android-base/properties.h>
 #include <android-base/stringprintf.h>
 #include <android-base/strings.h>
 #include "log/log.h"
@@ -1148,6 +1149,8 @@ int RouteController::flushRoutes(const char* interface) {
 }
 
 int RouteController::Init(unsigned localNetId) {
+    if(android::base::GetProperty("ro.boot.vm", "0") == std::string("1"))
+        return 0;
     if (int ret = flushRules()) {
         return ret;
     }
diff --git a/netd/server/TrafficController.cpp b/netd/server/TrafficController.cpp
index 1f678cb..bdec8f8 100644
--- a/netd/server/TrafficController.cpp
+++ b/netd/server/TrafficController.cpp
@@ -38,6 +38,7 @@
 #include <android-base/stringprintf.h>
 #include <android-base/strings.h>
 #include <android-base/unique_fd.h>
+#include <android-base/properties.h>
 #include <netdutils/StatusOr.h>
 
 #include <netdutils/Misc.h>
@@ -226,6 +227,15 @@ static Status initPrograms() {
          return statusFromErrno(ret, "Failed to find cgroup v2 root");
     }
 
+    {
+        std::string vmname = android::base::GetProperty("ro.boot.vm.name","");
+        if(vmname != "" && cg2_path.find("/sys/fs/cgroup") == 0){
+            std::string newsubstr = "/sys/fs/cgroup/" + vmname;
+            cg2_path.replace(0, strlen("/sys/fs/cgroup"), newsubstr);
+        }
+        ALOGD("initPrograms cg2_path: %s", cg2_path.c_str());
+    }
+
     unique_fd cg_fd(open(cg2_path.c_str(), O_DIRECTORY | O_RDONLY | O_CLOEXEC));
     if (cg_fd == -1) {
         int ret = errno;
diff --git a/sepolicy/prebuilts/api/26.0/private/file_contexts b/sepolicy/prebuilts/api/26.0/private/file_contexts
index 4485b95..9140062 100644
--- a/sepolicy/prebuilts/api/26.0/private/file_contexts
+++ b/sepolicy/prebuilts/api/26.0/private/file_contexts
@@ -12,6 +12,7 @@
 /selinux_version    u:object_r:rootfs:s0
 /ueventd\..*        u:object_r:rootfs:s0
 /verity_key         u:object_r:rootfs:s0
+/cells(/.*)?                u:object_r:rootfs:s0
 
 # Executables
 /charger            u:object_r:rootfs:s0
diff --git a/sepolicy/prebuilts/api/27.0/private/file_contexts b/sepolicy/prebuilts/api/27.0/private/file_contexts
index 5369758..32aa36d 100644
--- a/sepolicy/prebuilts/api/27.0/private/file_contexts
+++ b/sepolicy/prebuilts/api/27.0/private/file_contexts
@@ -12,6 +12,7 @@
 /selinux_version    u:object_r:rootfs:s0
 /ueventd\..*        u:object_r:rootfs:s0
 /verity_key         u:object_r:rootfs:s0
+/cells(/.*)?                u:object_r:rootfs:s0
 
 # Executables
 /charger            u:object_r:rootfs:s0
diff --git a/sepolicy/prebuilts/api/28.0/private/file_contexts b/sepolicy/prebuilts/api/28.0/private/file_contexts
index 564e45c..765c0e5 100644
--- a/sepolicy/prebuilts/api/28.0/private/file_contexts
+++ b/sepolicy/prebuilts/api/28.0/private/file_contexts
@@ -12,6 +12,7 @@
 /selinux_version    u:object_r:rootfs:s0
 /ueventd\..*        u:object_r:rootfs:s0
 /verity_key         u:object_r:rootfs:s0
+/cells(/.*)?                u:object_r:rootfs:s0
 
 # Executables
 /charger            u:object_r:rootfs:s0
diff --git a/sepolicy/prebuilts/api/29.0/private/file_contexts b/sepolicy/prebuilts/api/29.0/private/file_contexts
index 530bd45..cecb65c 100644
--- a/sepolicy/prebuilts/api/29.0/private/file_contexts
+++ b/sepolicy/prebuilts/api/29.0/private/file_contexts
@@ -12,6 +12,7 @@
 /selinux_version    u:object_r:rootfs:s0
 /ueventd\..*        u:object_r:rootfs:s0
 /verity_key         u:object_r:rootfs:s0
+/cells(/.*)?                u:object_r:rootfs:s0
 
 # Executables
 /init               u:object_r:init_exec:s0
diff --git a/sepolicy/prebuilts/api/30.0/private/file_contexts b/sepolicy/prebuilts/api/30.0/private/file_contexts
index 71a72b4..4bd4881 100644
--- a/sepolicy/prebuilts/api/30.0/private/file_contexts
+++ b/sepolicy/prebuilts/api/30.0/private/file_contexts
@@ -12,6 +12,7 @@
 /selinux_version    u:object_r:rootfs:s0
 /ueventd\..*        u:object_r:rootfs:s0
 /verity_key         u:object_r:rootfs:s0
+/cells(/.*)?                u:object_r:rootfs:s0
 
 # Executables
 /init               u:object_r:init_exec:s0
diff --git a/sepolicy/prebuilts/api/31.0/private/file_contexts b/sepolicy/prebuilts/api/31.0/private/file_contexts
index 351cd7c..cd97f22 100644
--- a/sepolicy/prebuilts/api/31.0/private/file_contexts
+++ b/sepolicy/prebuilts/api/31.0/private/file_contexts
@@ -12,6 +12,7 @@
 /selinux_version    u:object_r:rootfs:s0
 /ueventd\..*        u:object_r:rootfs:s0
 /verity_key         u:object_r:rootfs:s0
+/cells(/.*)?                u:object_r:rootfs:s0
 
 # Executables
 /init               u:object_r:init_exec:s0
diff --git a/sepolicy/prebuilts/api/32.0/private/file_contexts b/sepolicy/prebuilts/api/32.0/private/file_contexts
index 0330d88..a420c17 100644
--- a/sepolicy/prebuilts/api/32.0/private/file_contexts
+++ b/sepolicy/prebuilts/api/32.0/private/file_contexts
@@ -12,6 +12,7 @@
 /selinux_version    u:object_r:rootfs:s0
 /ueventd\..*        u:object_r:rootfs:s0
 /verity_key         u:object_r:rootfs:s0
+/cells(/.*)?                u:object_r:rootfs:s0
 
 # Executables
 /init               u:object_r:init_exec:s0
diff --git a/sepolicy/private/file_contexts b/sepolicy/private/file_contexts
index 0330d88..a420c17 100644
--- a/sepolicy/private/file_contexts
+++ b/sepolicy/private/file_contexts
@@ -12,6 +12,7 @@
 /selinux_version    u:object_r:rootfs:s0
 /ueventd\..*        u:object_r:rootfs:s0
 /verity_key         u:object_r:rootfs:s0
+/cells(/.*)?                u:object_r:rootfs:s0
 
 # Executables
 /init               u:object_r:init_exec:s0
diff --git a/update_engine/common/cpu_limiter.cc b/update_engine/common/cpu_limiter.cc
index 5f1ae6f..9f65f5b 100644
--- a/update_engine/common/cpu_limiter.cc
+++ b/update_engine/common/cpu_limiter.cc
@@ -22,6 +22,7 @@
 #include <base/logging.h>
 #include <base/strings/string_number_conversions.h>
 #include <base/time/time.h>
+#include <android-base/properties.h>
 
 #include "update_engine/common/utils.h"
 
@@ -69,12 +70,25 @@ bool CPULimiter::SetCpuShares(CpuShares shares) {
 
   std::string string_shares = base::NumberToString(static_cast<int>(shares));
   LOG(INFO) << "Setting cgroup cpu shares to  " << string_shares;
-  if (!utils::WriteFile(
-          kCGroupSharesPath, string_shares.c_str(), string_shares.size())) {
-    LOG(ERROR) << "Failed to change cgroup cpu shares to " << string_shares
-               << " using " << kCGroupSharesPath;
-    return false;
+
+  std::string vmname = android::base::GetProperty("ro.boot.vm.name","");
+  if(vmname != ""){
+    std::string sCGroupSharesPath = "/sys/fs/cgroup/" + vmname +"/cpu/update-engine/cpu.shares";
+    if (!utils::WriteFile(
+            sCGroupSharesPath.c_str(), string_shares.c_str(), string_shares.size())) {
+      LOG(ERROR) << "Failed to change cgroup cpu shares to " << string_shares
+                << " using " << sCGroupSharesPath.c_str();
+      return false;
+    }
+  }else{
+    if (!utils::WriteFile(
+            kCGroupSharesPath, string_shares.c_str(), string_shares.size())) {
+      LOG(ERROR) << "Failed to change cgroup cpu shares to " << string_shares
+                << " using " << kCGroupSharesPath;
+      return false;
+    }
   }
+
   shares_ = shares;
   LOG(INFO) << "CPU shares = " << static_cast<int>(shares_);
   return true;
-- 
2.31.1

